import{R as Rt,a8 as Fi,a9 as An,d as T,_ as ce,aa as Gn,ab as Ui,ac as Vn,ae as qi,ag as Bi,F as Hi,ah as de,ai as Gi,aj as zn,ad as Kn,ak as Vi,al as tt,am as Gt,af as zi,p as dt,j as Ki,C as Yi,w as Ji,A as le,e as Vt,an as Zi,m as ut,W as ct,X as Yn,k as Jn}from"./authFunctions.a8864b2c.js";import{i as $e,j as xe,k as Be}from"./scheduler.e3945ab3.js";import{d as Xi}from"./index.ed992b75.js";import{B as Qi}from"./baseSolanaAdapter.esm.3a89e1a7.js";var Ur={exports:{}},zt={exports:{}},V={ArrayIsArray(e){return Array.isArray(e)},ArrayPrototypeIncludes(e,t){return e.includes(t)},ArrayPrototypeIndexOf(e,t){return e.indexOf(t)},ArrayPrototypeJoin(e,t){return e.join(t)},ArrayPrototypeMap(e,t){return e.map(t)},ArrayPrototypePop(e,t){return e.pop(t)},ArrayPrototypePush(e,t){return e.push(t)},ArrayPrototypeSlice(e,t,n){return e.slice(t,n)},Error,FunctionPrototypeCall(e,t,...n){return e.call(t,...n)},FunctionPrototypeSymbolHasInstance(e,t){return Function.prototype[Symbol.hasInstance].call(e,t)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(e,t){return Object.defineProperties(e,t)},ObjectDefineProperty(e,t,n){return Object.defineProperty(e,t,n)},ObjectGetOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)},ObjectKeys(e){return Object.keys(e)},ObjectSetPrototypeOf(e,t){return Object.setPrototypeOf(e,t)},Promise,PromisePrototypeCatch(e,t){return e.catch(t)},PromisePrototypeThen(e,t,n){return e.then(t,n)},PromiseReject(e){return Promise.reject(e)},ReflectApply:Reflect.apply,RegExpPrototypeTest(e,t){return e.test(t)},SafeSet:Set,String,StringPrototypeSlice(e,t,n){return e.slice(t,n)},StringPrototypeToLowerCase(e){return e.toLowerCase()},StringPrototypeToUpperCase(e){return e.toUpperCase()},StringPrototypeTrim(e){return e.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(e,t,n){return e.set(t,n)},Uint8Array},qr={exports:{}};(function(e){const t=$e,n=Object.getPrototypeOf(async function(){}).constructor,r=globalThis.Blob||t.Blob,i=typeof r<"u"?function(c){return c instanceof r}:function(c){return!1};class s extends Error{constructor(c){if(!Array.isArray(c))throw new TypeError(`Expected input to be an Array, got ${typeof c}`);let h="";for(let d=0;d<c.length;d++)h+=`    ${c[d].stack}
`;super(h),this.name="AggregateError",this.errors=c}}e.exports={AggregateError:s,kEmptyObject:Object.freeze({}),once(l){let c=!1;return function(...h){c||(c=!0,l.apply(this,h))}},createDeferredPromise:function(){let l,c;return{promise:new Promise((d,p)=>{l=d,c=p}),resolve:l,reject:c}},promisify(l){return new Promise((c,h)=>{l((d,...p)=>d?h(d):c(...p))})},debuglog(){return function(){}},format(l,...c){return l.replace(/%([sdifj])/g,function(...[h,d]){const p=c.shift();return d==="f"?p.toFixed(6):d==="j"?JSON.stringify(p):d==="s"&&typeof p=="object"?`${p.constructor!==Object?p.constructor.name:""} {}`.trim():p.toString()})},inspect(l){switch(typeof l){case"string":if(l.includes("'"))if(l.includes('"')){if(!l.includes("`")&&!l.includes("${"))return`\`${l}\``}else return`"${l}"`;return`'${l}'`;case"number":return isNaN(l)?"NaN":Object.is(l,-0)?String(l):l;case"bigint":return`${String(l)}n`;case"boolean":case"undefined":return String(l);case"object":return"{}"}},types:{isAsyncFunction(l){return l instanceof n},isArrayBufferView(l){return ArrayBuffer.isView(l)}},isBlob:i},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(qr);var Ee=qr.exports,In={};const{format:eo,inspect:mt,AggregateError:to}=Ee,no=globalThis.AggregateError||to,ro=Symbol("kIsNodeError"),io=["string","function","number","object","Function","Object","boolean","bigint","symbol"],oo=/^([A-Z][a-z0-9]*)+$/,so="__node_internal_",At={};function De(e,t){if(!e)throw new At.ERR_INTERNAL_ASSERTION(t)}function Zn(e){let t="",n=e.length;const r=e[0]==="-"?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function ao(e,t,n){if(typeof t=="function")return De(t.length<=n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${t.length}).`),t(...n);const r=(t.match(/%[dfijoOs]/g)||[]).length;return De(r===n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${r}).`),n.length===0?t:eo(t,...n)}function Z(e,t,n){n||(n=Error);class r extends n{constructor(...s){super(ao(e,t,s))}toString(){return`${this.name} [${e}]: ${this.message}`}}Object.defineProperties(r.prototype,{name:{value:n.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${e}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),r.prototype.code=e,r.prototype[ro]=!0,At[e]=r}function Xn(e){const t=so+e.name;return Object.defineProperty(e,"name",{value:t}),e}function lo(e,t){if(e&&t&&e!==t){if(Array.isArray(t.errors))return t.errors.push(e),t;const n=new no([t,e],t.message);return n.code=t.code,n}return e||t}let uo=class extends Error{constructor(t="The operation was aborted",n=void 0){if(n!==void 0&&typeof n!="object")throw new At.ERR_INVALID_ARG_TYPE("options","Object",n);super(t,n),this.code="ABORT_ERR",this.name="AbortError"}};Z("ERR_ASSERTION","%s",Error);Z("ERR_INVALID_ARG_TYPE",(e,t,n)=>{De(typeof e=="string","'name' must be a string"),Array.isArray(t)||(t=[t]);let r="The ";e.endsWith(" argument")?r+=`${e} `:r+=`"${e}" ${e.includes(".")?"property":"argument"} `,r+="must be ";const i=[],s=[],l=[];for(const h of t)De(typeof h=="string","All expected entries have to be of type string"),io.includes(h)?i.push(h.toLowerCase()):oo.test(h)?s.push(h):(De(h!=="object",'The value "object" should be written as "Object"'),l.push(h));if(s.length>0){const h=i.indexOf("object");h!==-1&&(i.splice(i,h,1),s.push("Object"))}if(i.length>0){switch(i.length){case 1:r+=`of type ${i[0]}`;break;case 2:r+=`one of type ${i[0]} or ${i[1]}`;break;default:{const h=i.pop();r+=`one of type ${i.join(", ")}, or ${h}`}}(s.length>0||l.length>0)&&(r+=" or ")}if(s.length>0){switch(s.length){case 1:r+=`an instance of ${s[0]}`;break;case 2:r+=`an instance of ${s[0]} or ${s[1]}`;break;default:{const h=s.pop();r+=`an instance of ${s.join(", ")}, or ${h}`}}l.length>0&&(r+=" or ")}switch(l.length){case 0:break;case 1:l[0].toLowerCase()!==l[0]&&(r+="an "),r+=`${l[0]}`;break;case 2:r+=`one of ${l[0]} or ${l[1]}`;break;default:{const h=l.pop();r+=`one of ${l.join(", ")}, or ${h}`}}if(n==null)r+=`. Received ${n}`;else if(typeof n=="function"&&n.name)r+=`. Received function ${n.name}`;else if(typeof n=="object"){var c;if((c=n.constructor)!==null&&c!==void 0&&c.name)r+=`. Received an instance of ${n.constructor.name}`;else{const h=mt(n,{depth:-1});r+=`. Received ${h}`}}else{let h=mt(n,{colors:!1});h.length>25&&(h=`${h.slice(0,25)}...`),r+=`. Received type ${typeof n} (${h})`}return r},TypeError);Z("ERR_INVALID_ARG_VALUE",(e,t,n="is invalid")=>{let r=mt(t);return r.length>128&&(r=r.slice(0,128)+"..."),`The ${e.includes(".")?"property":"argument"} '${e}' ${n}. Received ${r}`},TypeError);Z("ERR_INVALID_RETURN_VALUE",(e,t,n)=>{var r;const i=n!=null&&(r=n.constructor)!==null&&r!==void 0&&r.name?`instance of ${n.constructor.name}`:`type ${typeof n}`;return`Expected ${e} to be returned from the "${t}" function but got ${i}.`},TypeError);Z("ERR_MISSING_ARGS",(...e)=>{De(e.length>0,"At least one arg needs to be specified");let t;const n=e.length;switch(e=(Array.isArray(e)?e:[e]).map(r=>`"${r}"`).join(" or "),n){case 1:t+=`The ${e[0]} argument`;break;case 2:t+=`The ${e[0]} and ${e[1]} arguments`;break;default:{const r=e.pop();t+=`The ${e.join(", ")}, and ${r} arguments`}break}return`${t} must be specified`},TypeError);Z("ERR_OUT_OF_RANGE",(e,t,n)=>{De(t,'Missing "range" argument');let r;return Number.isInteger(n)&&Math.abs(n)>2**32?r=Zn(String(n)):typeof n=="bigint"?(r=String(n),(n>2n**32n||n<-(2n**32n))&&(r=Zn(r)),r+="n"):r=mt(n),`The value of "${e}" is out of range. It must be ${t}. Received ${r}`},RangeError);Z("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);Z("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);Z("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);Z("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);Z("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);Z("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Z("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);Z("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);Z("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);Z("ERR_STREAM_WRITE_AFTER_END","write after end",Error);Z("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var ne={AbortError:uo,aggregateTwoErrors:Xn(lo),hideStackFrames:Xn,codes:At};const{ArrayIsArray:Tn,ArrayPrototypeIncludes:Br,ArrayPrototypeJoin:Hr,ArrayPrototypeMap:co,NumberIsInteger:vn,NumberIsNaN:fo,NumberMAX_SAFE_INTEGER:ho,NumberMIN_SAFE_INTEGER:po,NumberParseInt:go,ObjectPrototypeHasOwnProperty:bo,RegExpPrototypeExec:Gr,String:_o,StringPrototypeToUpperCase:wo,StringPrototypeTrim:yo}=V,{hideStackFrames:oe,codes:{ERR_SOCKET_BAD_PORT:mo,ERR_INVALID_ARG_TYPE:ee,ERR_INVALID_ARG_VALUE:ze,ERR_OUT_OF_RANGE:ke,ERR_UNKNOWN_SIGNAL:Qn}}=ne,{normalizeEncoding:So}=Ee,{isAsyncFunction:Eo,isArrayBufferView:Ro}=Ee.types,er={};function Ao(e){return e===(e|0)}function Io(e){return e===e>>>0}const To=/^[0-7]+$/,vo="must be a 32-bit unsigned integer or an octal string";function Po(e,t,n){if(typeof e>"u"&&(e=n),typeof e=="string"){if(Gr(To,e)===null)throw new ze(t,e,vo);e=go(e,8)}return Vr(e,t),e}const Co=oe((e,t,n=po,r=ho)=>{if(typeof e!="number")throw new ee(t,"number",e);if(!vn(e))throw new ke(t,"an integer",e);if(e<n||e>r)throw new ke(t,`>= ${n} && <= ${r}`,e)}),Oo=oe((e,t,n=-2147483648,r=2147483647)=>{if(typeof e!="number")throw new ee(t,"number",e);if(!vn(e))throw new ke(t,"an integer",e);if(e<n||e>r)throw new ke(t,`>= ${n} && <= ${r}`,e)}),Vr=oe((e,t,n=!1)=>{if(typeof e!="number")throw new ee(t,"number",e);if(!vn(e))throw new ke(t,"an integer",e);const r=n?1:0,i=4294967295;if(e<r||e>i)throw new ke(t,`>= ${r} && <= ${i}`,e)});function Pn(e,t){if(typeof e!="string")throw new ee(t,"string",e)}function No(e,t,n=void 0,r){if(typeof e!="number")throw new ee(t,"number",e);if(n!=null&&e<n||r!=null&&e>r||(n!=null||r!=null)&&fo(e))throw new ke(t,`${n!=null?`>= ${n}`:""}${n!=null&&r!=null?" && ":""}${r!=null?`<= ${r}`:""}`,e)}const Lo=oe((e,t,n)=>{if(!Br(n,e)){const i="must be one of: "+Hr(co(n,s=>typeof s=="string"?`'${s}'`:_o(s)),", ");throw new ze(t,e,i)}});function zr(e,t){if(typeof e!="boolean")throw new ee(t,"boolean",e)}function Kt(e,t,n){return e==null||!bo(e,t)?n:e[t]}const Mo=oe((e,t,n=null)=>{const r=Kt(n,"allowArray",!1),i=Kt(n,"allowFunction",!1);if(!Kt(n,"nullable",!1)&&e===null||!r&&Tn(e)||typeof e!="object"&&(!i||typeof e!="function"))throw new ee(t,"Object",e)}),Do=oe((e,t)=>{if(e!=null&&typeof e!="object"&&typeof e!="function")throw new ee(t,"a dictionary",e)}),Cn=oe((e,t,n=0)=>{if(!Tn(e))throw new ee(t,"Array",e);if(e.length<n){const r=`must be longer than ${n}`;throw new ze(t,e,r)}});function ko(e,t){Cn(e,t);for(let n=0;n<e.length;n++)Pn(e[n],`${t}[${n}]`)}function $o(e,t){Cn(e,t);for(let n=0;n<e.length;n++)zr(e[n],`${t}[${n}]`)}function xo(e,t="signal"){if(Pn(e,t),er[e]===void 0)throw er[wo(e)]!==void 0?new Qn(e+" (signals must use all capital letters)"):new Qn(e)}const Wo=oe((e,t="buffer")=>{if(!Ro(e))throw new ee(t,["Buffer","TypedArray","DataView"],e)});function jo(e,t){const n=So(t),r=e.length;if(n==="hex"&&r%2!==0)throw new ze("encoding",t,`is invalid for data of length ${r}`)}function Fo(e,t="Port",n=!0){if(typeof e!="number"&&typeof e!="string"||typeof e=="string"&&yo(e).length===0||+e!==+e>>>0||e>65535||e===0&&!n)throw new mo(t,e,n);return e|0}const Uo=oe((e,t)=>{if(e!==void 0&&(e===null||typeof e!="object"||!("aborted"in e)))throw new ee(t,"AbortSignal",e)}),qo=oe((e,t)=>{if(typeof e!="function")throw new ee(t,"Function",e)}),Bo=oe((e,t)=>{if(typeof e!="function"||Eo(e))throw new ee(t,"Function",e)}),Ho=oe((e,t)=>{if(e!==void 0)throw new ee(t,"undefined",e)});function Go(e,t,n){if(!Br(n,e))throw new ee(t,`('${Hr(n,"|")}')`,e)}const Vo=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function tr(e,t){if(typeof e>"u"||!Gr(Vo,e))throw new ze(t,e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function zo(e){if(typeof e=="string")return tr(e,"hints"),e;if(Tn(e)){const t=e.length;let n="";if(t===0)return n;for(let r=0;r<t;r++){const i=e[r];tr(i,"hints"),n+=i,r!==t-1&&(n+=", ")}return n}throw new ze("hints",e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var It={isInt32:Ao,isUint32:Io,parseFileMode:Po,validateArray:Cn,validateStringArray:ko,validateBooleanArray:$o,validateBoolean:zr,validateBuffer:Wo,validateDictionary:Do,validateEncoding:jo,validateFunction:qo,validateInt32:Oo,validateInteger:Co,validateNumber:No,validateObject:Mo,validateOneOf:Lo,validatePlainFunction:Bo,validatePort:Fo,validateSignalName:xo,validateString:Pn,validateUint32:Vr,validateUndefined:Ho,validateUnion:Go,validateAbortSignal:Uo,validateLinkHeaderValue:zo},On={exports:{}};const{Symbol:Tt,SymbolAsyncIterator:nr,SymbolIterator:rr,SymbolFor:Kr}=V,Yr=Tt("kDestroyed"),Jr=Tt("kIsErrored"),hn=Tt("kIsReadable"),Zr=Tt("kIsDisturbed"),Ko=Kr("nodejs.webstream.isClosedPromise"),Yo=Kr("nodejs.webstream.controllerErrorFunction");function vt(e,t=!1){var n;return!!(e&&typeof e.pipe=="function"&&typeof e.on=="function"&&(!t||typeof e.pause=="function"&&typeof e.resume=="function")&&(!e._writableState||((n=e._readableState)===null||n===void 0?void 0:n.readable)!==!1)&&(!e._writableState||e._readableState))}function Pt(e){var t;return!!(e&&typeof e.write=="function"&&typeof e.on=="function"&&(!e._readableState||((t=e._writableState)===null||t===void 0?void 0:t.writable)!==!1))}function Jo(e){return!!(e&&typeof e.pipe=="function"&&e._readableState&&typeof e.on=="function"&&typeof e.write=="function")}function pe(e){return e&&(e._readableState||e._writableState||typeof e.write=="function"&&typeof e.on=="function"||typeof e.pipe=="function"&&typeof e.on=="function")}function Xr(e){return!!(e&&!pe(e)&&typeof e.pipeThrough=="function"&&typeof e.getReader=="function"&&typeof e.cancel=="function")}function Qr(e){return!!(e&&!pe(e)&&typeof e.getWriter=="function"&&typeof e.abort=="function")}function ei(e){return!!(e&&!pe(e)&&typeof e.readable=="object"&&typeof e.writable=="object")}function Zo(e){return Xr(e)||Qr(e)||ei(e)}function Xo(e,t){return e==null?!1:t===!0?typeof e[nr]=="function":t===!1?typeof e[rr]=="function":typeof e[nr]=="function"||typeof e[rr]=="function"}function Ct(e){if(!pe(e))return null;const t=e._writableState,n=e._readableState,r=t||n;return!!(e.destroyed||e[Yr]||r!=null&&r.destroyed)}function ti(e){if(!Pt(e))return null;if(e.writableEnded===!0)return!0;const t=e._writableState;return t!=null&&t.errored?!1:typeof(t==null?void 0:t.ended)!="boolean"?null:t.ended}function Qo(e,t){if(!Pt(e))return null;if(e.writableFinished===!0)return!0;const n=e._writableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.finished)!="boolean"?null:!!(n.finished||t===!1&&n.ended===!0&&n.length===0)}function es(e){if(!vt(e))return null;if(e.readableEnded===!0)return!0;const t=e._readableState;return!t||t.errored?!1:typeof(t==null?void 0:t.ended)!="boolean"?null:t.ended}function ni(e,t){if(!vt(e))return null;const n=e._readableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.endEmitted)!="boolean"?null:!!(n.endEmitted||t===!1&&n.ended===!0&&n.length===0)}function ri(e){return e&&e[hn]!=null?e[hn]:typeof(e==null?void 0:e.readable)!="boolean"?null:Ct(e)?!1:vt(e)&&e.readable&&!ni(e)}function ii(e){return typeof(e==null?void 0:e.writable)!="boolean"?null:Ct(e)?!1:Pt(e)&&e.writable&&!ti(e)}function ts(e,t){return pe(e)?Ct(e)?!0:!((t==null?void 0:t.readable)!==!1&&ri(e)||(t==null?void 0:t.writable)!==!1&&ii(e)):null}function ns(e){var t,n;return pe(e)?e.writableErrored?e.writableErrored:(t=(n=e._writableState)===null||n===void 0?void 0:n.errored)!==null&&t!==void 0?t:null:null}function rs(e){var t,n;return pe(e)?e.readableErrored?e.readableErrored:(t=(n=e._readableState)===null||n===void 0?void 0:n.errored)!==null&&t!==void 0?t:null:null}function is(e){if(!pe(e))return null;if(typeof e.closed=="boolean")return e.closed;const t=e._writableState,n=e._readableState;return typeof(t==null?void 0:t.closed)=="boolean"||typeof(n==null?void 0:n.closed)=="boolean"?(t==null?void 0:t.closed)||(n==null?void 0:n.closed):typeof e._closed=="boolean"&&oi(e)?e._closed:null}function oi(e){return typeof e._closed=="boolean"&&typeof e._defaultKeepAlive=="boolean"&&typeof e._removedConnection=="boolean"&&typeof e._removedContLen=="boolean"}function si(e){return typeof e._sent100=="boolean"&&oi(e)}function os(e){var t;return typeof e._consuming=="boolean"&&typeof e._dumped=="boolean"&&((t=e.req)===null||t===void 0?void 0:t.upgradeOrConnect)===void 0}function ss(e){if(!pe(e))return null;const t=e._writableState,n=e._readableState,r=t||n;return!r&&si(e)||!!(r&&r.autoDestroy&&r.emitClose&&r.closed===!1)}function as(e){var t;return!!(e&&((t=e[Zr])!==null&&t!==void 0?t:e.readableDidRead||e.readableAborted))}function ls(e){var t,n,r,i,s,l,c,h,d,p;return!!(e&&((t=(n=(r=(i=(s=(l=e[Jr])!==null&&l!==void 0?l:e.readableErrored)!==null&&s!==void 0?s:e.writableErrored)!==null&&i!==void 0?i:(c=e._readableState)===null||c===void 0?void 0:c.errorEmitted)!==null&&r!==void 0?r:(h=e._writableState)===null||h===void 0?void 0:h.errorEmitted)!==null&&n!==void 0?n:(d=e._readableState)===null||d===void 0?void 0:d.errored)!==null&&t!==void 0?t:!((p=e._writableState)===null||p===void 0)&&p.errored))}var Re={kDestroyed:Yr,isDisturbed:as,kIsDisturbed:Zr,isErrored:ls,kIsErrored:Jr,isReadable:ri,kIsReadable:hn,kIsClosedPromise:Ko,kControllerErrorFunction:Yo,isClosed:is,isDestroyed:Ct,isDuplexNodeStream:Jo,isFinished:ts,isIterable:Xo,isReadableNodeStream:vt,isReadableStream:Xr,isReadableEnded:es,isReadableFinished:ni,isReadableErrored:rs,isNodeStream:pe,isWebStream:Zo,isWritable:ii,isWritableNodeStream:Pt,isWritableStream:Qr,isWritableEnded:ti,isWritableFinished:Qo,isWritableErrored:ns,isServerRequest:os,isServerResponse:si,willEmitClose:ss,isTransformStream:ei};const Ie=xe,{AbortError:ai,codes:ds}=ne,{ERR_INVALID_ARG_TYPE:us,ERR_STREAM_PREMATURE_CLOSE:ir}=ds,{kEmptyObject:pn,once:gn}=Ee,{validateAbortSignal:cs,validateFunction:fs,validateObject:hs,validateBoolean:ps}=It,{Promise:gs,PromisePrototypeThen:bs}=V,{isClosed:_s,isReadable:or,isReadableNodeStream:Yt,isReadableStream:ws,isReadableFinished:sr,isReadableErrored:ar,isWritable:lr,isWritableNodeStream:dr,isWritableStream:ys,isWritableFinished:ur,isWritableErrored:cr,isNodeStream:ms,willEmitClose:Ss,kIsClosedPromise:Es}=Re;function Rs(e){return e.setHeader&&typeof e.abort=="function"}const bn=()=>{};function li(e,t,n){var r,i;if(arguments.length===2?(n=t,t=pn):t==null?t=pn:hs(t,"options"),fs(n,"callback"),cs(t.signal,"options.signal"),n=gn(n),ws(e)||ys(e))return As(e,t,n);if(!ms(e))throw new us("stream",["ReadableStream","WritableStream","Stream"],e);const s=(r=t.readable)!==null&&r!==void 0?r:Yt(e),l=(i=t.writable)!==null&&i!==void 0?i:dr(e),c=e._writableState,h=e._readableState,d=()=>{e.writable||_()};let p=Ss(e)&&Yt(e)===s&&dr(e)===l,m=ur(e,!1);const _=()=>{m=!0,e.destroyed&&(p=!1),!(p&&(!e.readable||s))&&(!s||b)&&n.call(e)};let b=sr(e,!1);const g=()=>{b=!0,e.destroyed&&(p=!1),!(p&&(!e.writable||l))&&(!l||m)&&n.call(e)},M=D=>{n.call(e,D)};let O=_s(e);const I=()=>{O=!0;const D=cr(e)||ar(e);if(D&&typeof D!="boolean")return n.call(e,D);if(s&&!b&&Yt(e,!0)&&!sr(e,!1))return n.call(e,new ir);if(l&&!m&&!ur(e,!1))return n.call(e,new ir);n.call(e)},y=()=>{O=!0;const D=cr(e)||ar(e);if(D&&typeof D!="boolean")return n.call(e,D);n.call(e)},N=()=>{e.req.on("finish",_)};Rs(e)?(e.on("complete",_),p||e.on("abort",I),e.req?N():e.on("request",N)):l&&!c&&(e.on("end",d),e.on("close",d)),!p&&typeof e.aborted=="boolean"&&e.on("aborted",I),e.on("end",g),e.on("finish",_),t.error!==!1&&e.on("error",M),e.on("close",I),O?Ie.nextTick(I):c!=null&&c.errorEmitted||h!=null&&h.errorEmitted?p||Ie.nextTick(y):(!s&&(!p||or(e))&&(m||lr(e)===!1)||!l&&(!p||lr(e))&&(b||or(e)===!1)||h&&e.req&&e.aborted)&&Ie.nextTick(y);const B=()=>{n=bn,e.removeListener("aborted",I),e.removeListener("complete",_),e.removeListener("abort",I),e.removeListener("request",N),e.req&&e.req.removeListener("finish",_),e.removeListener("end",d),e.removeListener("close",d),e.removeListener("finish",_),e.removeListener("end",g),e.removeListener("error",M),e.removeListener("close",I)};if(t.signal&&!O){const D=()=>{const z=n;B(),z.call(e,new ai(void 0,{cause:t.signal.reason}))};if(t.signal.aborted)Ie.nextTick(D);else{const z=n;n=gn((...H)=>{t.signal.removeEventListener("abort",D),z.apply(e,H)}),t.signal.addEventListener("abort",D)}}return B}function As(e,t,n){let r=!1,i=bn;if(t.signal)if(i=()=>{r=!0,n.call(e,new ai(void 0,{cause:t.signal.reason}))},t.signal.aborted)Ie.nextTick(i);else{const l=n;n=gn((...c)=>{t.signal.removeEventListener("abort",i),l.apply(e,c)}),t.signal.addEventListener("abort",i)}const s=(...l)=>{r||Ie.nextTick(()=>n.apply(e,l))};return bs(e[Es].promise,s,s),bn}function Is(e,t){var n;let r=!1;return t===null&&(t=pn),(n=t)!==null&&n!==void 0&&n.cleanup&&(ps(t.cleanup,"cleanup"),r=t.cleanup),new gs((i,s)=>{const l=li(e,t,c=>{r&&l(),c?s(c):i()})})}On.exports=li;On.exports.finished=Is;var Pe=On.exports;const fe=xe,{aggregateTwoErrors:Ts,codes:{ERR_MULTIPLE_CALLBACK:vs},AbortError:Ps}=ne,{Symbol:di}=V,{kDestroyed:Cs,isDestroyed:Os,isFinished:Ns,isServerRequest:Ls}=Re,ui=di("kDestroy"),_n=di("kConstruct");function ci(e,t,n){e&&(e.stack,t&&!t.errored&&(t.errored=e),n&&!n.errored&&(n.errored=e))}function Ms(e,t){const n=this._readableState,r=this._writableState,i=r||n;return r!=null&&r.destroyed||n!=null&&n.destroyed?(typeof t=="function"&&t(),this):(ci(e,r,n),r&&(r.destroyed=!0),n&&(n.destroyed=!0),i.constructed?fr(this,e,t):this.once(ui,function(s){fr(this,Ts(s,e),t)}),this)}function fr(e,t,n){let r=!1;function i(s){if(r)return;r=!0;const l=e._readableState,c=e._writableState;ci(s,c,l),c&&(c.closed=!0),l&&(l.closed=!0),typeof n=="function"&&n(s),s?fe.nextTick(Ds,e,s):fe.nextTick(fi,e)}try{e._destroy(t||null,i)}catch(s){i(s)}}function Ds(e,t){wn(e,t),fi(e)}function fi(e){const t=e._readableState,n=e._writableState;n&&(n.closeEmitted=!0),t&&(t.closeEmitted=!0),(n!=null&&n.emitClose||t!=null&&t.emitClose)&&e.emit("close")}function wn(e,t){const n=e._readableState,r=e._writableState;r!=null&&r.errorEmitted||n!=null&&n.errorEmitted||(r&&(r.errorEmitted=!0),n&&(n.errorEmitted=!0),e.emit("error",t))}function ks(){const e=this._readableState,t=this._writableState;e&&(e.constructed=!0,e.closed=!1,e.closeEmitted=!1,e.destroyed=!1,e.errored=null,e.errorEmitted=!1,e.reading=!1,e.ended=e.readable===!1,e.endEmitted=e.readable===!1),t&&(t.constructed=!0,t.destroyed=!1,t.closed=!1,t.closeEmitted=!1,t.errored=null,t.errorEmitted=!1,t.finalCalled=!1,t.prefinished=!1,t.ended=t.writable===!1,t.ending=t.writable===!1,t.finished=t.writable===!1)}function yn(e,t,n){const r=e._readableState,i=e._writableState;if(i!=null&&i.destroyed||r!=null&&r.destroyed)return this;r!=null&&r.autoDestroy||i!=null&&i.autoDestroy?e.destroy(t):t&&(t.stack,i&&!i.errored&&(i.errored=t),r&&!r.errored&&(r.errored=t),n?fe.nextTick(wn,e,t):wn(e,t))}function $s(e,t){if(typeof e._construct!="function")return;const n=e._readableState,r=e._writableState;n&&(n.constructed=!1),r&&(r.constructed=!1),e.once(_n,t),!(e.listenerCount(_n)>1)&&fe.nextTick(xs,e)}function xs(e){let t=!1;function n(r){if(t){yn(e,r??new vs);return}t=!0;const i=e._readableState,s=e._writableState,l=s||i;i&&(i.constructed=!0),s&&(s.constructed=!0),l.destroyed?e.emit(ui,r):r?yn(e,r,!0):fe.nextTick(Ws,e)}try{e._construct(r=>{fe.nextTick(n,r)})}catch(r){fe.nextTick(n,r)}}function Ws(e){e.emit(_n)}function hr(e){return(e==null?void 0:e.setHeader)&&typeof e.abort=="function"}function hi(e){e.emit("close")}function js(e,t){e.emit("error",t),fe.nextTick(hi,e)}function Fs(e,t){!e||Os(e)||(!t&&!Ns(e)&&(t=new Ps),Ls(e)?(e.socket=null,e.destroy(t)):hr(e)?e.abort():hr(e.req)?e.req.abort():typeof e.destroy=="function"?e.destroy(t):typeof e.close=="function"?e.close():t?fe.nextTick(js,e,t):fe.nextTick(hi,e),e.destroyed||(e[Cs]=!0))}var Ke={construct:$s,destroyer:Fs,destroy:Ms,undestroy:ks,errorOrDestroy:yn};const{ArrayIsArray:Us,ObjectSetPrototypeOf:pi}=V,{EventEmitter:Ot}=Rt;function Nt(e){Ot.call(this,e)}pi(Nt.prototype,Ot.prototype);pi(Nt,Ot);Nt.prototype.pipe=function(e,t){const n=this;function r(p){e.writable&&e.write(p)===!1&&n.pause&&n.pause()}n.on("data",r);function i(){n.readable&&n.resume&&n.resume()}e.on("drain",i),!e._isStdio&&(!t||t.end!==!1)&&(n.on("end",l),n.on("close",c));let s=!1;function l(){s||(s=!0,e.end())}function c(){s||(s=!0,typeof e.destroy=="function"&&e.destroy())}function h(p){d(),Ot.listenerCount(this,"error")===0&&this.emit("error",p)}mn(n,"error",h),mn(e,"error",h);function d(){n.removeListener("data",r),e.removeListener("drain",i),n.removeListener("end",l),n.removeListener("close",c),n.removeListener("error",h),e.removeListener("error",h),n.removeListener("end",d),n.removeListener("close",d),e.removeListener("close",d)}return n.on("end",d),n.on("close",d),e.on("close",d),e.emit("pipe",n),e};function mn(e,t,n){if(typeof e.prependListener=="function")return e.prependListener(t,n);!e._events||!e._events[t]?e.on(t,n):Us(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]}var Nn={Stream:Nt,prependListener:mn},gi={exports:{}};(function(e){const{AbortError:t,codes:n}=ne,{isNodeStream:r,isWebStream:i,kControllerErrorFunction:s}=Re,l=Pe,{ERR_INVALID_ARG_TYPE:c}=n,h=(d,p)=>{if(typeof d!="object"||!("aborted"in d))throw new c(p,"AbortSignal",d)};e.exports.addAbortSignal=function(p,m){if(h(p,"signal"),!r(m)&&!i(m))throw new c("stream",["ReadableStream","WritableStream","Stream"],m);return e.exports.addAbortSignalNoValidate(p,m)},e.exports.addAbortSignalNoValidate=function(d,p){if(typeof d!="object"||!("aborted"in d))return p;const m=r(p)?()=>{p.destroy(new t(void 0,{cause:d.reason}))}:()=>{p[s](new t(void 0,{cause:d.reason}))};return d.aborted?m():(d.addEventListener("abort",m),l(p,()=>d.removeEventListener("abort",m))),p}})(gi);var Lt=gi.exports;const{StringPrototypeSlice:pr,SymbolIterator:qs,TypedArrayPrototypeSet:ft,Uint8Array:Bs}=V,{Buffer:Jt}=$e,{inspect:Hs}=Ee;var Gs=class{constructor(){this.head=null,this.tail=null,this.length=0}push(t){const n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}unshift(t){const n={data:t,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}shift(){if(this.length===0)return;const t=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,t}clear(){this.head=this.tail=null,this.length=0}join(t){if(this.length===0)return"";let n=this.head,r=""+n.data;for(;(n=n.next)!==null;)r+=t+n.data;return r}concat(t){if(this.length===0)return Jt.alloc(0);const n=Jt.allocUnsafe(t>>>0);let r=this.head,i=0;for(;r;)ft(n,r.data,i),i+=r.data.length,r=r.next;return n}consume(t,n){const r=this.head.data;if(t<r.length){const i=r.slice(0,t);return this.head.data=r.slice(t),i}return t===r.length?this.shift():n?this._getString(t):this._getBuffer(t)}first(){return this.head.data}*[qs](){for(let t=this.head;t;t=t.next)yield t.data}_getString(t){let n="",r=this.head,i=0;do{const s=r.data;if(t>s.length)n+=s,t-=s.length;else{t===s.length?(n+=s,++i,r.next?this.head=r.next:this.head=this.tail=null):(n+=pr(s,0,t),this.head=r,r.data=pr(s,t));break}++i}while((r=r.next)!==null);return this.length-=i,n}_getBuffer(t){const n=Jt.allocUnsafe(t),r=t;let i=this.head,s=0;do{const l=i.data;if(t>l.length)ft(n,l,r-t),t-=l.length;else{t===l.length?(ft(n,l,r-t),++s,i.next?this.head=i.next:this.head=this.tail=null):(ft(n,new Bs(l.buffer,l.byteOffset,t),r-t),this.head=i,i.data=l.slice(t));break}++s}while((i=i.next)!==null);return this.length-=s,n}[Symbol.for("nodejs.util.inspect.custom")](t,n){return Hs(this,{...n,depth:0,customInspect:!1})}};const{MathFloor:Vs,NumberIsInteger:zs}=V,{ERR_INVALID_ARG_VALUE:Ks}=ne.codes;function Ys(e,t,n){return e.highWaterMark!=null?e.highWaterMark:t?e[n]:null}function bi(e){return e?16:16*1024}function Js(e,t,n,r){const i=Ys(t,r,n);if(i!=null){if(!zs(i)||i<0){const s=r?`options.${n}`:"options.highWaterMark";throw new Ks(s,i)}return Vs(i)}return bi(e.objectMode)}var Ln={getHighWaterMark:Js,getDefaultHighWaterMark:bi};const gr=xe,{PromisePrototypeThen:Zs,SymbolAsyncIterator:br,SymbolIterator:_r}=V,{Buffer:Xs}=$e,{ERR_INVALID_ARG_TYPE:Qs,ERR_STREAM_NULL_VALUES:ea}=ne.codes;function ta(e,t,n){let r;if(typeof t=="string"||t instanceof Xs)return new e({objectMode:!0,...n,read(){this.push(t),this.push(null)}});let i;if(t&&t[br])i=!0,r=t[br]();else if(t&&t[_r])i=!1,r=t[_r]();else throw new Qs("iterable",["Iterable"],t);const s=new e({objectMode:!0,highWaterMark:1,...n});let l=!1;s._read=function(){l||(l=!0,h())},s._destroy=function(d,p){Zs(c(d),()=>gr.nextTick(p,d),m=>gr.nextTick(p,m||d))};async function c(d){const p=d!=null,m=typeof r.throw=="function";if(p&&m){const{value:_,done:b}=await r.throw(d);if(await _,b)return}if(typeof r.return=="function"){const{value:_}=await r.return();await _}}async function h(){for(;;){try{const{value:d,done:p}=i?await r.next():r.next();if(p)s.push(null);else{const m=d&&typeof d.then=="function"?await d:d;if(m===null)throw l=!1,new ea;if(s.push(m))continue;l=!1}}catch(d){s.destroy(d)}break}}return s}var _i=ta,Zt,wr;function Mt(){if(wr)return Zt;wr=1;const e=xe,{ArrayPrototypeIndexOf:t,NumberIsInteger:n,NumberIsNaN:r,NumberParseInt:i,ObjectDefineProperties:s,ObjectKeys:l,ObjectSetPrototypeOf:c,Promise:h,SafeSet:d,SymbolAsyncIterator:p,Symbol:m}=V;Zt=E,E.ReadableState=se;const{EventEmitter:_}=Rt,{Stream:b,prependListener:g}=Nn,{Buffer:M}=$e,{addAbortSignal:O}=Lt,I=Pe;let y=Ee.debuglog("stream",o=>{y=o});const N=Gs,B=Ke,{getHighWaterMark:D,getDefaultHighWaterMark:z}=Ln,{aggregateTwoErrors:H,codes:{ERR_INVALID_ARG_TYPE:K,ERR_METHOD_NOT_IMPLEMENTED:q,ERR_OUT_OF_RANGE:S,ERR_STREAM_PUSH_AFTER_EOF:k,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:Y}}=ne,{validateObject:$}=It,x=m("kPaused"),{StringDecoder:L}=Fi,G=_i;c(E.prototype,b.prototype),c(E,b);const J=()=>{},{errorOrDestroy:W}=B;function se(o,a,R){typeof R!="boolean"&&(R=a instanceof me()),this.objectMode=!!(o&&o.objectMode),R&&(this.objectMode=this.objectMode||!!(o&&o.readableObjectMode)),this.highWaterMark=o?D(this,o,"readableHighWaterMark",R):z(!1),this.buffer=new N,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[x]=null,this.errorEmitted=!1,this.emitClose=!o||o.emitClose!==!1,this.autoDestroy=!o||o.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=o&&o.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,o&&o.encoding&&(this.decoder=new L(o.encoding),this.encoding=o.encoding)}function E(o){if(!(this instanceof E))return new E(o);const a=this instanceof me();this._readableState=new se(o,this,a),o&&(typeof o.read=="function"&&(this._read=o.read),typeof o.destroy=="function"&&(this._destroy=o.destroy),typeof o.construct=="function"&&(this._construct=o.construct),o.signal&&!a&&O(o.signal,this)),b.call(this,o),B.construct(this,()=>{this._readableState.needReadable&&Ae(this,this._readableState)})}E.prototype.destroy=B.destroy,E.prototype._undestroy=B.undestroy,E.prototype._destroy=function(o,a){a(o)},E.prototype[_.captureRejectionSymbol]=function(o){this.destroy(o)},E.prototype.push=function(o,a){return te(this,o,a,!1)},E.prototype.unshift=function(o,a){return te(this,o,a,!0)};function te(o,a,R,A){y("readableAddChunk",a);const v=o._readableState;let X;if(v.objectMode||(typeof a=="string"?(R=R||v.defaultEncoding,v.encoding!==R&&(A&&v.encoding?a=M.from(a,R).toString(v.encoding):(a=M.from(a,R),R=""))):a instanceof M?R="":b._isUint8Array(a)?(a=b._uint8ArrayToBuffer(a),R=""):a!=null&&(X=new K("chunk",["string","Buffer","Uint8Array"],a))),X)W(o,X);else if(a===null)v.reading=!1,Ft(o,v);else if(v.objectMode||a&&a.length>0)if(A)if(v.endEmitted)W(o,new Y);else{if(v.destroyed||v.errored)return!1;ge(o,v,a,!0)}else if(v.ended)W(o,new k);else{if(v.destroyed||v.errored)return!1;v.reading=!1,v.decoder&&!R?(a=v.decoder.write(a),v.objectMode||a.length!==0?ge(o,v,a,!1):Ae(o,v)):ge(o,v,a,!1)}else A||(v.reading=!1,Ae(o,v));return!v.ended&&(v.length<v.highWaterMark||v.length===0)}function ge(o,a,R,A){a.flowing&&a.length===0&&!a.sync&&o.listenerCount("data")>0?(a.multiAwaitDrain?a.awaitDrainWriters.clear():a.awaitDrainWriters=null,a.dataEmitted=!0,o.emit("data",R)):(a.length+=a.objectMode?1:R.length,A?a.buffer.unshift(R):a.buffer.push(R),a.needReadable&&Fe(o)),Ae(o,a)}E.prototype.isPaused=function(){const o=this._readableState;return o[x]===!0||o.flowing===!1},E.prototype.setEncoding=function(o){const a=new L(o);this._readableState.decoder=a,this._readableState.encoding=this._readableState.decoder.encoding;const R=this._readableState.buffer;let A="";for(const v of R)A+=a.write(v);return R.clear(),A!==""&&R.push(A),this._readableState.length=A.length,this};const Ye=1073741824;function Je(o){if(o>Ye)throw new S("size","<= 1GiB",o);return o--,o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,o|=o>>>16,o++,o}function Ce(o,a){return o<=0||a.length===0&&a.ended?0:a.objectMode?1:r(o)?a.flowing&&a.length?a.buffer.first().length:a.length:o<=a.length?o:a.ended?a.length:0}E.prototype.read=function(o){y("read",o),o===void 0?o=NaN:n(o)||(o=i(o,10));const a=this._readableState,R=o;if(o>a.highWaterMark&&(a.highWaterMark=Je(o)),o!==0&&(a.emittedReadable=!1),o===0&&a.needReadable&&((a.highWaterMark!==0?a.length>=a.highWaterMark:a.length>0)||a.ended))return y("read: emitReadable",a.length,a.ended),a.length===0&&a.ended?ae(this):Fe(this),null;if(o=Ce(o,a),o===0&&a.ended)return a.length===0&&ae(this),null;let A=a.needReadable;if(y("need readable",A),(a.length===0||a.length-o<a.highWaterMark)&&(A=!0,y("length less than watermark",A)),a.ended||a.reading||a.destroyed||a.errored||!a.constructed)A=!1,y("reading, ended or constructing",A);else if(A){y("do read"),a.reading=!0,a.sync=!0,a.length===0&&(a.needReadable=!0);try{this._read(a.highWaterMark)}catch(X){W(this,X)}a.sync=!1,a.reading||(o=Ce(R,a))}let v;return o>0?v=U(o,a):v=null,v===null?(a.needReadable=a.length<=a.highWaterMark,o=0):(a.length-=o,a.multiAwaitDrain?a.awaitDrainWriters.clear():a.awaitDrainWriters=null),a.length===0&&(a.ended||(a.needReadable=!0),R!==o&&a.ended&&ae(this)),v!==null&&!a.errorEmitted&&!a.closeEmitted&&(a.dataEmitted=!0,this.emit("data",v)),v};function Ft(o,a){if(y("onEofChunk"),!a.ended){if(a.decoder){const R=a.decoder.end();R&&R.length&&(a.buffer.push(R),a.length+=a.objectMode?1:R.length)}a.ended=!0,a.sync?Fe(o):(a.needReadable=!1,a.emittedReadable=!0,Ue(o))}}function Fe(o){const a=o._readableState;y("emitReadable",a.needReadable,a.emittedReadable),a.needReadable=!1,a.emittedReadable||(y("emitReadable",a.flowing),a.emittedReadable=!0,e.nextTick(Ue,o))}function Ue(o){const a=o._readableState;y("emitReadable_",a.destroyed,a.length,a.ended),!a.destroyed&&!a.errored&&(a.length||a.ended)&&(o.emit("readable"),a.emittedReadable=!1),a.needReadable=!a.flowing&&!a.ended&&a.length<=a.highWaterMark,P(o)}function Ae(o,a){!a.readingMore&&a.constructed&&(a.readingMore=!0,e.nextTick(Ut,o,a))}function Ut(o,a){for(;!a.reading&&!a.ended&&(a.length<a.highWaterMark||a.flowing&&a.length===0);){const R=a.length;if(y("maybeReadMore read 0"),o.read(0),R===a.length)break}a.readingMore=!1}E.prototype._read=function(o){throw new q("_read()")},E.prototype.pipe=function(o,a){const R=this,A=this._readableState;A.pipes.length===1&&(A.multiAwaitDrain||(A.multiAwaitDrain=!0,A.awaitDrainWriters=new d(A.awaitDrainWriters?[A.awaitDrainWriters]:[]))),A.pipes.push(o),y("pipe count=%d opts=%j",A.pipes.length,a);const X=(!a||a.end!==!1)&&o!==e.stdout&&o!==e.stderr?Un:et;A.endEmitted?e.nextTick(X):R.once("end",X),o.on("unpipe",re);function re(Ne,_e){y("onunpipe"),Ne===R&&_e&&_e.hasUnpiped===!1&&(_e.hasUnpiped=!0,ji())}function Un(){y("onend"),o.end()}let Oe,qn=!1;function ji(){y("cleanup"),o.removeListener("close",Bt),o.removeListener("finish",Ht),Oe&&o.removeListener("drain",Oe),o.removeListener("error",qt),o.removeListener("unpipe",re),R.removeListener("end",Un),R.removeListener("end",et),R.removeListener("data",Hn),qn=!0,Oe&&A.awaitDrainWriters&&(!o._writableState||o._writableState.needDrain)&&Oe()}function Bn(){qn||(A.pipes.length===1&&A.pipes[0]===o?(y("false write response, pause",0),A.awaitDrainWriters=o,A.multiAwaitDrain=!1):A.pipes.length>1&&A.pipes.includes(o)&&(y("false write response, pause",A.awaitDrainWriters.size),A.awaitDrainWriters.add(o)),R.pause()),Oe||(Oe=Ze(R,o),o.on("drain",Oe))}R.on("data",Hn);function Hn(Ne){y("ondata");const _e=o.write(Ne);y("dest.write",_e),_e===!1&&Bn()}function qt(Ne){if(y("onerror",Ne),et(),o.removeListener("error",qt),o.listenerCount("error")===0){const _e=o._writableState||o._readableState;_e&&!_e.errorEmitted?W(o,Ne):o.emit("error",Ne)}}g(o,"error",qt);function Bt(){o.removeListener("finish",Ht),et()}o.once("close",Bt);function Ht(){y("onfinish"),o.removeListener("close",Bt),et()}o.once("finish",Ht);function et(){y("unpipe"),R.unpipe(o)}return o.emit("pipe",R),o.writableNeedDrain===!0?A.flowing&&Bn():A.flowing||(y("pipe resume"),R.resume()),o};function Ze(o,a){return function(){const A=o._readableState;A.awaitDrainWriters===a?(y("pipeOnDrain",1),A.awaitDrainWriters=null):A.multiAwaitDrain&&(y("pipeOnDrain",A.awaitDrainWriters.size),A.awaitDrainWriters.delete(a)),(!A.awaitDrainWriters||A.awaitDrainWriters.size===0)&&o.listenerCount("data")&&o.resume()}}E.prototype.unpipe=function(o){const a=this._readableState,R={hasUnpiped:!1};if(a.pipes.length===0)return this;if(!o){const v=a.pipes;a.pipes=[],this.pause();for(let X=0;X<v.length;X++)v[X].emit("unpipe",this,{hasUnpiped:!1});return this}const A=t(a.pipes,o);return A===-1?this:(a.pipes.splice(A,1),a.pipes.length===0&&this.pause(),o.emit("unpipe",this,R),this)},E.prototype.on=function(o,a){const R=b.prototype.on.call(this,o,a),A=this._readableState;return o==="data"?(A.readableListening=this.listenerCount("readable")>0,A.flowing!==!1&&this.resume()):o==="readable"&&!A.endEmitted&&!A.readableListening&&(A.readableListening=A.needReadable=!0,A.flowing=!1,A.emittedReadable=!1,y("on readable",A.length,A.reading),A.length?Fe(this):A.reading||e.nextTick(u,this)),R},E.prototype.addListener=E.prototype.on,E.prototype.removeListener=function(o,a){const R=b.prototype.removeListener.call(this,o,a);return o==="readable"&&e.nextTick(Xe,this),R},E.prototype.off=E.prototype.removeListener,E.prototype.removeAllListeners=function(o){const a=b.prototype.removeAllListeners.apply(this,arguments);return(o==="readable"||o===void 0)&&e.nextTick(Xe,this),a};function Xe(o){const a=o._readableState;a.readableListening=o.listenerCount("readable")>0,a.resumeScheduled&&a[x]===!1?a.flowing=!0:o.listenerCount("data")>0?o.resume():a.readableListening||(a.flowing=null)}function u(o){y("readable nexttick read 0"),o.read(0)}E.prototype.resume=function(){const o=this._readableState;return o.flowing||(y("resume"),o.flowing=!o.readableListening,f(this,o)),o[x]=!1,this};function f(o,a){a.resumeScheduled||(a.resumeScheduled=!0,e.nextTick(w,o,a))}function w(o,a){y("resume",a.reading),a.reading||o.read(0),a.resumeScheduled=!1,o.emit("resume"),P(o),a.flowing&&!a.reading&&o.read(0)}E.prototype.pause=function(){return y("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(y("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[x]=!0,this};function P(o){const a=o._readableState;for(y("flow",a.flowing);a.flowing&&o.read()!==null;);}E.prototype.wrap=function(o){let a=!1;o.on("data",A=>{!this.push(A)&&o.pause&&(a=!0,o.pause())}),o.on("end",()=>{this.push(null)}),o.on("error",A=>{W(this,A)}),o.on("close",()=>{this.destroy()}),o.on("destroy",()=>{this.destroy()}),this._read=()=>{a&&o.resume&&(a=!1,o.resume())};const R=l(o);for(let A=1;A<R.length;A++){const v=R[A];this[v]===void 0&&typeof o[v]=="function"&&(this[v]=o[v].bind(o))}return this},E.prototype[p]=function(){return C(this)},E.prototype.iterator=function(o){return o!==void 0&&$(o,"options"),C(this,o)};function C(o,a){typeof o.read!="function"&&(o=E.wrap(o,{objectMode:!0}));const R=F(o,a);return R.stream=o,R}async function*F(o,a){let R=J;function A(re){this===o?(R(),R=J):R=re}o.on("readable",A);let v;const X=I(o,{writable:!1},re=>{v=re?H(v,re):null,R(),R=J});try{for(;;){const re=o.destroyed?null:o.read();if(re!==null)yield re;else{if(v)throw v;if(v===null)return;await new h(A)}}}catch(re){throw v=H(v,re),v}finally{(v||(a==null?void 0:a.destroyOnReturn)!==!1)&&(v===void 0||o._readableState.autoDestroy)?B.destroyer(o,null):(o.off("readable",A),X())}}s(E.prototype,{readable:{__proto__:null,get(){const o=this._readableState;return!!o&&o.readable!==!1&&!o.destroyed&&!o.errorEmitted&&!o.endEmitted},set(o){this._readableState&&(this._readableState.readable=!!o)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(o){this._readableState&&(this._readableState.flowing=o)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(o){this._readableState&&(this._readableState.destroyed=o)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),s(se.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[x]!==!1},set(o){this[x]=!!o}}}),E._fromList=U;function U(o,a){if(a.length===0)return null;let R;return a.objectMode?R=a.buffer.shift():!o||o>=a.length?(a.decoder?R=a.buffer.join(""):a.buffer.length===1?R=a.buffer.first():R=a.buffer.concat(a.length),a.buffer.clear()):R=a.buffer.consume(o,a.decoder),R}function ae(o){const a=o._readableState;y("endReadable",a.endEmitted),a.endEmitted||(a.ended=!0,e.nextTick(qe,a,o))}function qe(o,a){if(y("endReadableNT",o.endEmitted,o.length),!o.errored&&!o.closeEmitted&&!o.endEmitted&&o.length===0){if(o.endEmitted=!0,a.emit("end"),a.writable&&a.allowHalfOpen===!1)e.nextTick(Qe,a);else if(o.autoDestroy){const R=a._writableState;(!R||R.autoDestroy&&(R.finished||R.writable===!1))&&a.destroy()}}}function Qe(o){o.writable&&!o.writableEnded&&!o.destroyed&&o.end()}E.from=function(o,a){return G(E,o,a)};let be;function Fn(){return be===void 0&&(be={}),be}return E.fromWeb=function(o,a){return Fn().newStreamReadableFromReadableStream(o,a)},E.toWeb=function(o,a){return Fn().newReadableStreamFromStreamReadable(o,a)},E.wrap=function(o,a){var R,A;return new E({objectMode:(R=(A=o.readableObjectMode)!==null&&A!==void 0?A:o.objectMode)!==null&&R!==void 0?R:!0,...a,destroy(v,X){B.destroyer(o,v),X(v)}}).wrap(o)},Zt}var Xt,yr;function wi(){if(yr)return Xt;yr=1;const e=xe,{ArrayPrototypeSlice:t,Error:n,FunctionPrototypeSymbolHasInstance:r,ObjectDefineProperty:i,ObjectDefineProperties:s,ObjectSetPrototypeOf:l,StringPrototypeToLowerCase:c,Symbol:h,SymbolHasInstance:d}=V;Xt=L,L.WritableState=$;const{EventEmitter:p}=Rt,m=Nn.Stream,{Buffer:_}=$e,b=Ke,{addAbortSignal:g}=Lt,{getHighWaterMark:M,getDefaultHighWaterMark:O}=Ln,{ERR_INVALID_ARG_TYPE:I,ERR_METHOD_NOT_IMPLEMENTED:y,ERR_MULTIPLE_CALLBACK:N,ERR_STREAM_CANNOT_PIPE:B,ERR_STREAM_DESTROYED:D,ERR_STREAM_ALREADY_FINISHED:z,ERR_STREAM_NULL_VALUES:H,ERR_STREAM_WRITE_AFTER_END:K,ERR_UNKNOWN_ENCODING:q}=ne.codes,{errorOrDestroy:S}=b;l(L.prototype,m.prototype),l(L,m);function k(){}const Y=h("kOnFinished");function $(u,f,w){typeof w!="boolean"&&(w=f instanceof me()),this.objectMode=!!(u&&u.objectMode),w&&(this.objectMode=this.objectMode||!!(u&&u.writableObjectMode)),this.highWaterMark=u?M(this,u,"writableHighWaterMark",w):O(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const P=!!(u&&u.decodeStrings===!1);this.decodeStrings=!P,this.defaultEncoding=u&&u.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=E.bind(void 0,f),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,x(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!u||u.emitClose!==!1,this.autoDestroy=!u||u.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[Y]=[]}function x(u){u.buffered=[],u.bufferedIndex=0,u.allBuffers=!0,u.allNoop=!0}$.prototype.getBuffer=function(){return t(this.buffered,this.bufferedIndex)},i($.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function L(u){const f=this instanceof me();if(!f&&!r(L,this))return new L(u);this._writableState=new $(u,this,f),u&&(typeof u.write=="function"&&(this._write=u.write),typeof u.writev=="function"&&(this._writev=u.writev),typeof u.destroy=="function"&&(this._destroy=u.destroy),typeof u.final=="function"&&(this._final=u.final),typeof u.construct=="function"&&(this._construct=u.construct),u.signal&&g(u.signal,this)),m.call(this,u),b.construct(this,()=>{const w=this._writableState;w.writing||Je(this,w),Ue(this,w)})}i(L,d,{__proto__:null,value:function(u){return r(this,u)?!0:this!==L?!1:u&&u._writableState instanceof $}}),L.prototype.pipe=function(){S(this,new B)};function G(u,f,w,P){const C=u._writableState;if(typeof w=="function")P=w,w=C.defaultEncoding;else{if(!w)w=C.defaultEncoding;else if(w!=="buffer"&&!_.isEncoding(w))throw new q(w);typeof P!="function"&&(P=k)}if(f===null)throw new H;if(!C.objectMode)if(typeof f=="string")C.decodeStrings!==!1&&(f=_.from(f,w),w="buffer");else if(f instanceof _)w="buffer";else if(m._isUint8Array(f))f=m._uint8ArrayToBuffer(f),w="buffer";else throw new I("chunk",["string","Buffer","Uint8Array"],f);let F;return C.ending?F=new K:C.destroyed&&(F=new D("write")),F?(e.nextTick(P,F),S(u,F,!0),F):(C.pendingcb++,J(u,C,f,w,P))}L.prototype.write=function(u,f,w){return G(this,u,f,w)===!0},L.prototype.cork=function(){this._writableState.corked++},L.prototype.uncork=function(){const u=this._writableState;u.corked&&(u.corked--,u.writing||Je(this,u))},L.prototype.setDefaultEncoding=function(f){if(typeof f=="string"&&(f=c(f)),!_.isEncoding(f))throw new q(f);return this._writableState.defaultEncoding=f,this};function J(u,f,w,P,C){const F=f.objectMode?1:w.length;f.length+=F;const U=f.length<f.highWaterMark;return U||(f.needDrain=!0),f.writing||f.corked||f.errored||!f.constructed?(f.buffered.push({chunk:w,encoding:P,callback:C}),f.allBuffers&&P!=="buffer"&&(f.allBuffers=!1),f.allNoop&&C!==k&&(f.allNoop=!1)):(f.writelen=F,f.writecb=C,f.writing=!0,f.sync=!0,u._write(w,P,f.onwrite),f.sync=!1),U&&!f.errored&&!f.destroyed}function W(u,f,w,P,C,F,U){f.writelen=P,f.writecb=U,f.writing=!0,f.sync=!0,f.destroyed?f.onwrite(new D("write")):w?u._writev(C,f.onwrite):u._write(C,F,f.onwrite),f.sync=!1}function se(u,f,w,P){--f.pendingcb,P(w),Ye(f),S(u,w)}function E(u,f){const w=u._writableState,P=w.sync,C=w.writecb;if(typeof C!="function"){S(u,new N);return}w.writing=!1,w.writecb=null,w.length-=w.writelen,w.writelen=0,f?(f.stack,w.errored||(w.errored=f),u._readableState&&!u._readableState.errored&&(u._readableState.errored=f),P?e.nextTick(se,u,w,f,C):se(u,w,f,C)):(w.buffered.length>w.bufferedIndex&&Je(u,w),P?w.afterWriteTickInfo!==null&&w.afterWriteTickInfo.cb===C?w.afterWriteTickInfo.count++:(w.afterWriteTickInfo={count:1,cb:C,stream:u,state:w},e.nextTick(te,w.afterWriteTickInfo)):ge(u,w,1,C))}function te({stream:u,state:f,count:w,cb:P}){return f.afterWriteTickInfo=null,ge(u,f,w,P)}function ge(u,f,w,P){for(!f.ending&&!u.destroyed&&f.length===0&&f.needDrain&&(f.needDrain=!1,u.emit("drain"));w-- >0;)f.pendingcb--,P();f.destroyed&&Ye(f),Ue(u,f)}function Ye(u){if(u.writing)return;for(let C=u.bufferedIndex;C<u.buffered.length;++C){var f;const{chunk:F,callback:U}=u.buffered[C],ae=u.objectMode?1:F.length;u.length-=ae,U((f=u.errored)!==null&&f!==void 0?f:new D("write"))}const w=u[Y].splice(0);for(let C=0;C<w.length;C++){var P;w[C]((P=u.errored)!==null&&P!==void 0?P:new D("end"))}x(u)}function Je(u,f){if(f.corked||f.bufferProcessing||f.destroyed||!f.constructed)return;const{buffered:w,bufferedIndex:P,objectMode:C}=f,F=w.length-P;if(!F)return;let U=P;if(f.bufferProcessing=!0,F>1&&u._writev){f.pendingcb-=F-1;const ae=f.allNoop?k:Qe=>{for(let be=U;be<w.length;++be)w[be].callback(Qe)},qe=f.allNoop&&U===0?w:t(w,U);qe.allBuffers=f.allBuffers,W(u,f,!0,f.length,qe,"",ae),x(f)}else{do{const{chunk:ae,encoding:qe,callback:Qe}=w[U];w[U++]=null;const be=C?1:ae.length;W(u,f,!1,be,ae,qe,Qe)}while(U<w.length&&!f.writing);U===w.length?x(f):U>256?(w.splice(0,U),f.bufferedIndex=0):f.bufferedIndex=U}f.bufferProcessing=!1}L.prototype._write=function(u,f,w){if(this._writev)this._writev([{chunk:u,encoding:f}],w);else throw new y("_write()")},L.prototype._writev=null,L.prototype.end=function(u,f,w){const P=this._writableState;typeof u=="function"?(w=u,u=null,f=null):typeof f=="function"&&(w=f,f=null);let C;if(u!=null){const F=G(this,u,f);F instanceof n&&(C=F)}return P.corked&&(P.corked=1,this.uncork()),C||(!P.errored&&!P.ending?(P.ending=!0,Ue(this,P,!0),P.ended=!0):P.finished?C=new z("end"):P.destroyed&&(C=new D("end"))),typeof w=="function"&&(C||P.finished?e.nextTick(w,C):P[Y].push(w)),this};function Ce(u){return u.ending&&!u.destroyed&&u.constructed&&u.length===0&&!u.errored&&u.buffered.length===0&&!u.finished&&!u.writing&&!u.errorEmitted&&!u.closeEmitted}function Ft(u,f){let w=!1;function P(C){if(w){S(u,C??N());return}if(w=!0,f.pendingcb--,C){const F=f[Y].splice(0);for(let U=0;U<F.length;U++)F[U](C);S(u,C,f.sync)}else Ce(f)&&(f.prefinished=!0,u.emit("prefinish"),f.pendingcb++,e.nextTick(Ae,u,f))}f.sync=!0,f.pendingcb++;try{u._final(P)}catch(C){P(C)}f.sync=!1}function Fe(u,f){!f.prefinished&&!f.finalCalled&&(typeof u._final=="function"&&!f.destroyed?(f.finalCalled=!0,Ft(u,f)):(f.prefinished=!0,u.emit("prefinish")))}function Ue(u,f,w){Ce(f)&&(Fe(u,f),f.pendingcb===0&&(w?(f.pendingcb++,e.nextTick((P,C)=>{Ce(C)?Ae(P,C):C.pendingcb--},u,f)):Ce(f)&&(f.pendingcb++,Ae(u,f))))}function Ae(u,f){f.pendingcb--,f.finished=!0;const w=f[Y].splice(0);for(let P=0;P<w.length;P++)w[P]();if(u.emit("finish"),f.autoDestroy){const P=u._readableState;(!P||P.autoDestroy&&(P.endEmitted||P.readable===!1))&&u.destroy()}}s(L.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(u){this._writableState&&(this._writableState.destroyed=u)}},writable:{__proto__:null,get(){const u=this._writableState;return!!u&&u.writable!==!1&&!u.destroyed&&!u.errored&&!u.ending&&!u.ended},set(u){this._writableState&&(this._writableState.writable=!!u)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const u=this._writableState;return u?!u.destroyed&&!u.ending&&u.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Ut=b.destroy;L.prototype.destroy=function(u,f){const w=this._writableState;return!w.destroyed&&(w.bufferedIndex<w.buffered.length||w[Y].length)&&e.nextTick(Ye,w),Ut.call(this,u,f),this},L.prototype._undestroy=b.undestroy,L.prototype._destroy=function(u,f){f(u)},L.prototype[p.captureRejectionSymbol]=function(u){this.destroy(u)};let Ze;function Xe(){return Ze===void 0&&(Ze={}),Ze}return L.fromWeb=function(u,f){return Xe().newStreamWritableFromWritableStream(u,f)},L.toWeb=function(u){return Xe().newWritableStreamFromStreamWritable(u)},Xt}var Qt,mr;function na(){if(mr)return Qt;mr=1;const e=xe,t=$e,{isReadable:n,isWritable:r,isIterable:i,isNodeStream:s,isReadableNodeStream:l,isWritableNodeStream:c,isDuplexNodeStream:h}=Re,d=Pe,{AbortError:p,codes:{ERR_INVALID_ARG_TYPE:m,ERR_INVALID_RETURN_VALUE:_}}=ne,{destroyer:b}=Ke,g=me(),M=Mt(),{createDeferredPromise:O}=Ee,I=_i,y=globalThis.Blob||t.Blob,N=typeof y<"u"?function(S){return S instanceof y}:function(S){return!1},B=globalThis.AbortController||An().AbortController,{FunctionPrototypeCall:D}=V;class z extends g{constructor(S){super(S),(S==null?void 0:S.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(S==null?void 0:S.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}Qt=function q(S,k){if(h(S))return S;if(l(S))return K({readable:S});if(c(S))return K({writable:S});if(s(S))return K({writable:!1,readable:!1});if(typeof S=="function"){const{value:$,write:x,final:L,destroy:G}=H(S);if(i($))return I(z,$,{objectMode:!0,write:x,final:L,destroy:G});const J=$==null?void 0:$.then;if(typeof J=="function"){let W;const se=D(J,$,E=>{if(E!=null)throw new _("nully","body",E)},E=>{b(W,E)});return W=new z({objectMode:!0,readable:!1,write:x,final(E){L(async()=>{try{await se,e.nextTick(E,null)}catch(te){e.nextTick(E,te)}})},destroy:G})}throw new _("Iterable, AsyncIterable or AsyncFunction",k,$)}if(N(S))return q(S.arrayBuffer());if(i(S))return I(z,S,{objectMode:!0,writable:!1});if(typeof(S==null?void 0:S.writable)=="object"||typeof(S==null?void 0:S.readable)=="object"){const $=S!=null&&S.readable?l(S==null?void 0:S.readable)?S==null?void 0:S.readable:q(S.readable):void 0,x=S!=null&&S.writable?c(S==null?void 0:S.writable)?S==null?void 0:S.writable:q(S.writable):void 0;return K({readable:$,writable:x})}const Y=S==null?void 0:S.then;if(typeof Y=="function"){let $;return D(Y,S,x=>{x!=null&&$.push(x),$.push(null)},x=>{b($,x)}),$=new z({objectMode:!0,writable:!1,read(){}})}throw new m(k,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],S)};function H(q){let{promise:S,resolve:k}=O();const Y=new B,$=Y.signal;return{value:q(async function*(){for(;;){const L=S;S=null;const{chunk:G,done:J,cb:W}=await L;if(e.nextTick(W),J)return;if($.aborted)throw new p(void 0,{cause:$.reason});({promise:S,resolve:k}=O()),yield G}}(),{signal:$}),write(L,G,J){const W=k;k=null,W({chunk:L,done:!1,cb:J})},final(L){const G=k;k=null,G({done:!0,cb:L})},destroy(L,G){Y.abort(),G(L)}}}function K(q){const S=q.readable&&typeof q.readable.read!="function"?M.wrap(q.readable):q.readable,k=q.writable;let Y=!!n(S),$=!!r(k),x,L,G,J,W;function se(E){const te=J;J=null,te?te(E):E&&W.destroy(E)}return W=new z({readableObjectMode:!!(S!=null&&S.readableObjectMode),writableObjectMode:!!(k!=null&&k.writableObjectMode),readable:Y,writable:$}),$&&(d(k,E=>{$=!1,E&&b(S,E),se(E)}),W._write=function(E,te,ge){k.write(E,te)?ge():x=ge},W._final=function(E){k.end(),L=E},k.on("drain",function(){if(x){const E=x;x=null,E()}}),k.on("finish",function(){if(L){const E=L;L=null,E()}})),Y&&(d(S,E=>{Y=!1,E&&b(S,E),se(E)}),S.on("readable",function(){if(G){const E=G;G=null,E()}}),S.on("end",function(){W.push(null)}),W._read=function(){for(;;){const E=S.read();if(E===null){G=W._read;return}if(!W.push(E))return}}),W._destroy=function(E,te){!E&&J!==null&&(E=new p),G=null,x=null,L=null,J===null?te(E):(J=te,b(k,E),b(S,E))},W}return Qt}var en,Sr;function me(){if(Sr)return en;Sr=1;const{ObjectDefineProperties:e,ObjectGetOwnPropertyDescriptor:t,ObjectKeys:n,ObjectSetPrototypeOf:r}=V;en=l;const i=Mt(),s=wi();r(l.prototype,i.prototype),r(l,i);{const p=n(s.prototype);for(let m=0;m<p.length;m++){const _=p[m];l.prototype[_]||(l.prototype[_]=s.prototype[_])}}function l(p){if(!(this instanceof l))return new l(p);i.call(this,p),s.call(this,p),p?(this.allowHalfOpen=p.allowHalfOpen!==!1,p.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),p.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}e(l.prototype,{writable:{__proto__:null,...t(s.prototype,"writable")},writableHighWaterMark:{__proto__:null,...t(s.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...t(s.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...t(s.prototype,"writableBuffer")},writableLength:{__proto__:null,...t(s.prototype,"writableLength")},writableFinished:{__proto__:null,...t(s.prototype,"writableFinished")},writableCorked:{__proto__:null,...t(s.prototype,"writableCorked")},writableEnded:{__proto__:null,...t(s.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...t(s.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(p){this._readableState&&this._writableState&&(this._readableState.destroyed=p,this._writableState.destroyed=p)}}});let c;function h(){return c===void 0&&(c={}),c}l.fromWeb=function(p,m){return h().newStreamDuplexFromReadableWritablePair(p,m)},l.toWeb=function(p){return h().newReadableWritablePairFromDuplex(p)};let d;return l.from=function(p){return d||(d=na()),d(p,"body")},en}const{ObjectSetPrototypeOf:yi,Symbol:ra}=V;var mi=Se;const{ERR_METHOD_NOT_IMPLEMENTED:ia}=ne.codes,Mn=me(),{getHighWaterMark:oa}=Ln;yi(Se.prototype,Mn.prototype);yi(Se,Mn);const st=ra("kCallback");function Se(e){if(!(this instanceof Se))return new Se(e);const t=e?oa(this,e,"readableHighWaterMark",!0):null;t===0&&(e={...e,highWaterMark:null,readableHighWaterMark:t,writableHighWaterMark:e.writableHighWaterMark||0}),Mn.call(this,e),this._readableState.sync=!1,this[st]=null,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",sa)}function Sn(e){typeof this._flush=="function"&&!this.destroyed?this._flush((t,n)=>{if(t){e?e(t):this.destroy(t);return}n!=null&&this.push(n),this.push(null),e&&e()}):(this.push(null),e&&e())}function sa(){this._final!==Sn&&Sn.call(this)}Se.prototype._final=Sn;Se.prototype._transform=function(e,t,n){throw new ia("_transform()")};Se.prototype._write=function(e,t,n){const r=this._readableState,i=this._writableState,s=r.length;this._transform(e,t,(l,c)=>{if(l){n(l);return}c!=null&&this.push(c),i.ended||s===r.length||r.length<r.highWaterMark?n():this[st]=n})};Se.prototype._read=function(){if(this[st]){const e=this[st];this[st]=null,e()}};const{ObjectSetPrototypeOf:Si}=V;var Ei=Ve;const Dn=mi;Si(Ve.prototype,Dn.prototype);Si(Ve,Dn);function Ve(e){if(!(this instanceof Ve))return new Ve(e);Dn.call(this,e)}Ve.prototype._transform=function(e,t,n){n(null,e)};const it=xe,{ArrayIsArray:aa,Promise:la,SymbolAsyncIterator:da}=V,St=Pe,{once:ua}=Ee,ca=Ke,Er=me(),{aggregateTwoErrors:fa,codes:{ERR_INVALID_ARG_TYPE:En,ERR_INVALID_RETURN_VALUE:tn,ERR_MISSING_ARGS:ha,ERR_STREAM_DESTROYED:pa,ERR_STREAM_PREMATURE_CLOSE:ga},AbortError:ba}=ne,{validateFunction:_a,validateAbortSignal:wa}=It,{isIterable:Me,isReadable:nn,isReadableNodeStream:yt,isNodeStream:Rr,isTransformStream:He,isWebStream:ya,isReadableStream:rn,isReadableEnded:ma}=Re,Sa=globalThis.AbortController||An().AbortController;let on,sn;function Ar(e,t,n){let r=!1;e.on("close",()=>{r=!0});const i=St(e,{readable:t,writable:n},s=>{r=!s});return{destroy:s=>{r||(r=!0,ca.destroyer(e,s||new pa("pipe")))},cleanup:i}}function Ea(e){return _a(e[e.length-1],"streams[stream.length - 1]"),e.pop()}function an(e){if(Me(e))return e;if(yt(e))return Ra(e);throw new En("val",["Readable","Iterable","AsyncIterable"],e)}async function*Ra(e){sn||(sn=Mt()),yield*sn.prototype[da].call(e)}async function ht(e,t,n,{end:r}){let i,s=null;const l=d=>{if(d&&(i=d),s){const p=s;s=null,p()}},c=()=>new la((d,p)=>{i?p(i):s=()=>{i?p(i):d()}});t.on("drain",l);const h=St(t,{readable:!1},l);try{t.writableNeedDrain&&await c();for await(const d of e)t.write(d)||await c();r&&t.end(),await c(),n()}catch(d){n(i!==d?fa(i,d):d)}finally{h(),t.off("drain",l)}}async function ln(e,t,n,{end:r}){He(t)&&(t=t.writable);const i=t.getWriter();try{for await(const s of e)await i.ready,i.write(s).catch(()=>{});await i.ready,r&&await i.close(),n()}catch(s){try{await i.abort(s),n(s)}catch(l){n(l)}}}function Aa(...e){return Ri(e,ua(Ea(e)))}function Ri(e,t,n){if(e.length===1&&aa(e[0])&&(e=e[0]),e.length<2)throw new ha("streams");const r=new Sa,i=r.signal,s=n==null?void 0:n.signal,l=[];wa(s,"options.signal");function c(){b(new ba)}s==null||s.addEventListener("abort",c);let h,d;const p=[];let m=0;function _(I){b(I,--m===0)}function b(I,y){if(I&&(!h||h.code==="ERR_STREAM_PREMATURE_CLOSE")&&(h=I),!(!h&&!y)){for(;p.length;)p.shift()(h);s==null||s.removeEventListener("abort",c),r.abort(),y&&(h||l.forEach(N=>N()),it.nextTick(t,h,d))}}let g;for(let I=0;I<e.length;I++){const y=e[I],N=I<e.length-1,B=I>0,D=N||(n==null?void 0:n.end)!==!1,z=I===e.length-1;if(Rr(y)){let H=function(K){K&&K.name!=="AbortError"&&K.code!=="ERR_STREAM_PREMATURE_CLOSE"&&_(K)};if(D){const{destroy:K,cleanup:q}=Ar(y,N,B);p.push(K),nn(y)&&z&&l.push(q)}y.on("error",H),nn(y)&&z&&l.push(()=>{y.removeListener("error",H)})}if(I===0)if(typeof y=="function"){if(g=y({signal:i}),!Me(g))throw new tn("Iterable, AsyncIterable or Stream","source",g)}else Me(y)||yt(y)||He(y)?g=y:g=Er.from(y);else if(typeof y=="function"){if(He(g)){var M;g=an((M=g)===null||M===void 0?void 0:M.readable)}else g=an(g);if(g=y(g,{signal:i}),N){if(!Me(g,!0))throw new tn("AsyncIterable",`transform[${I-1}]`,g)}else{var O;on||(on=Ei);const H=new on({objectMode:!0}),K=(O=g)===null||O===void 0?void 0:O.then;if(typeof K=="function")m++,K.call(g,k=>{d=k,k!=null&&H.write(k),D&&H.end(),it.nextTick(_)},k=>{H.destroy(k),it.nextTick(_,k)});else if(Me(g,!0))m++,ht(g,H,_,{end:D});else if(rn(g)||He(g)){const k=g.readable||g;m++,ht(k,H,_,{end:D})}else throw new tn("AsyncIterable or Promise","destination",g);g=H;const{destroy:q,cleanup:S}=Ar(g,!1,!0);p.push(q),z&&l.push(S)}}else if(Rr(y)){if(yt(g)){m+=2;const H=Ia(g,y,_,{end:D});nn(y)&&z&&l.push(H)}else if(He(g)||rn(g)){const H=g.readable||g;m++,ht(H,y,_,{end:D})}else if(Me(g))m++,ht(g,y,_,{end:D});else throw new En("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],g);g=y}else if(ya(y)){if(yt(g))m++,ln(an(g),y,_,{end:D});else if(rn(g)||Me(g))m++,ln(g,y,_,{end:D});else if(He(g))m++,ln(g.readable,y,_,{end:D});else throw new En("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],g);g=y}else g=Er.from(y)}return(i!=null&&i.aborted||s!=null&&s.aborted)&&it.nextTick(c),g}function Ia(e,t,n,{end:r}){let i=!1;if(t.on("close",()=>{i||n(new ga)}),e.pipe(t,{end:!1}),r){let s=function(){i=!0,t.end()};ma(e)?it.nextTick(s):e.once("end",s)}else n();return St(e,{readable:!0,writable:!1},s=>{const l=e._readableState;s&&s.code==="ERR_STREAM_PREMATURE_CLOSE"&&l&&l.ended&&!l.errored&&!l.errorEmitted?e.once("end",n).once("error",n):n(s)}),St(t,{readable:!1,writable:!0},n)}var kn={pipelineImpl:Ri,pipeline:Aa};const{pipeline:Ta}=kn,pt=me(),{destroyer:va}=Ke,{isNodeStream:gt,isReadable:Ir,isWritable:Tr,isWebStream:dn,isTransformStream:Le,isWritableStream:vr,isReadableStream:Pr}=Re,{AbortError:Pa,codes:{ERR_INVALID_ARG_VALUE:Cr,ERR_MISSING_ARGS:Ca}}=ne,Oa=Pe;var Ai=function(...t){if(t.length===0)throw new Ca("streams");if(t.length===1)return pt.from(t[0]);const n=[...t];if(typeof t[0]=="function"&&(t[0]=pt.from(t[0])),typeof t[t.length-1]=="function"){const b=t.length-1;t[b]=pt.from(t[b])}for(let b=0;b<t.length;++b)if(!(!gt(t[b])&&!dn(t[b]))){if(b<t.length-1&&!(Ir(t[b])||Pr(t[b])||Le(t[b])))throw new Cr(`streams[${b}]`,n[b],"must be readable");if(b>0&&!(Tr(t[b])||vr(t[b])||Le(t[b])))throw new Cr(`streams[${b}]`,n[b],"must be writable")}let r,i,s,l,c;function h(b){const g=l;l=null,g?g(b):b?c.destroy(b):!_&&!m&&c.destroy()}const d=t[0],p=Ta(t,h),m=!!(Tr(d)||vr(d)||Le(d)),_=!!(Ir(p)||Pr(p)||Le(p));if(c=new pt({writableObjectMode:!!(d!=null&&d.writableObjectMode),readableObjectMode:!!(p!=null&&p.writableObjectMode),writable:m,readable:_}),m){if(gt(d))c._write=function(g,M,O){d.write(g,M)?O():r=O},c._final=function(g){d.end(),i=g},d.on("drain",function(){if(r){const g=r;r=null,g()}});else if(dn(d)){const M=(Le(d)?d.writable:d).getWriter();c._write=async function(O,I,y){try{await M.ready,M.write(O).catch(()=>{}),y()}catch(N){y(N)}},c._final=async function(O){try{await M.ready,M.close().catch(()=>{}),i=O}catch(I){O(I)}}}const b=Le(p)?p.readable:p;Oa(b,()=>{if(i){const g=i;i=null,g()}})}if(_){if(gt(p))p.on("readable",function(){if(s){const b=s;s=null,b()}}),p.on("end",function(){c.push(null)}),c._read=function(){for(;;){const b=p.read();if(b===null){s=c._read;return}if(!c.push(b))return}};else if(dn(p)){const g=(Le(p)?p.readable:p).getReader();c._read=async function(){for(;;)try{const{value:M,done:O}=await g.read();if(!c.push(M))return;if(O){c.push(null);return}}catch{return}}}}return c._destroy=function(b,g){!b&&l!==null&&(b=new Pa),s=null,r=null,i=null,l===null?g(b):(l=g,gt(p)&&va(p,b))},c};const Ii=globalThis.AbortController||An().AbortController,{codes:{ERR_INVALID_ARG_VALUE:Na,ERR_INVALID_ARG_TYPE:lt,ERR_MISSING_ARGS:La,ERR_OUT_OF_RANGE:Ma},AbortError:he}=ne,{validateAbortSignal:We,validateInteger:Da,validateObject:je}=It,ka=V.Symbol("kWeak"),{finished:$a}=Pe,xa=Ai,{addAbortSignalNoValidate:Wa}=Lt,{isWritable:ja,isNodeStream:Fa}=Re,{ArrayPrototypePush:Ua,MathFloor:qa,Number:Ba,NumberIsNaN:Ha,Promise:Or,PromiseReject:Nr,PromisePrototypeThen:Ga,Symbol:Ti}=V,Et=Ti("kEmpty"),Lr=Ti("kEof");function Va(e,t){if(t!=null&&je(t,"options"),(t==null?void 0:t.signal)!=null&&We(t.signal,"options.signal"),Fa(e)&&!ja(e))throw new Na("stream",e,"must be writable");const n=xa(this,e);return t!=null&&t.signal&&Wa(t.signal,n),n}function Dt(e,t){if(typeof e!="function")throw new lt("fn",["Function","AsyncFunction"],e);t!=null&&je(t,"options"),(t==null?void 0:t.signal)!=null&&We(t.signal,"options.signal");let n=1;return(t==null?void 0:t.concurrency)!=null&&(n=qa(t.concurrency)),Da(n,"concurrency",1),(async function*(){var i,s;const l=new Ii,c=this,h=[],d=l.signal,p={signal:d},m=()=>l.abort();t!=null&&(i=t.signal)!==null&&i!==void 0&&i.aborted&&m(),t==null||(s=t.signal)===null||s===void 0||s.addEventListener("abort",m);let _,b,g=!1;function M(){g=!0}async function O(){try{for await(let N of c){var I;if(g)return;if(d.aborted)throw new he;try{N=e(N,p)}catch(B){N=Nr(B)}N!==Et&&(typeof((I=N)===null||I===void 0?void 0:I.catch)=="function"&&N.catch(M),h.push(N),_&&(_(),_=null),!g&&h.length&&h.length>=n&&await new Or(B=>{b=B}))}h.push(Lr)}catch(N){const B=Nr(N);Ga(B,void 0,M),h.push(B)}finally{var y;g=!0,_&&(_(),_=null),t==null||(y=t.signal)===null||y===void 0||y.removeEventListener("abort",m)}}O();try{for(;;){for(;h.length>0;){const I=await h[0];if(I===Lr)return;if(d.aborted)throw new he;I!==Et&&(yield I),h.shift(),b&&(b(),b=null)}await new Or(I=>{_=I})}}finally{l.abort(),g=!0,b&&(b(),b=null)}}).call(this)}function za(e=void 0){return e!=null&&je(e,"options"),(e==null?void 0:e.signal)!=null&&We(e.signal,"options.signal"),(async function*(){let n=0;for await(const i of this){var r;if(e!=null&&(r=e.signal)!==null&&r!==void 0&&r.aborted)throw new he({cause:e.signal.reason});yield[n++,i]}}).call(this)}async function vi(e,t=void 0){for await(const n of $n.call(this,e,t))return!0;return!1}async function Ka(e,t=void 0){if(typeof e!="function")throw new lt("fn",["Function","AsyncFunction"],e);return!await vi.call(this,async(...n)=>!await e(...n),t)}async function Ya(e,t){for await(const n of $n.call(this,e,t))return n}async function Ja(e,t){if(typeof e!="function")throw new lt("fn",["Function","AsyncFunction"],e);async function n(r,i){return await e(r,i),Et}for await(const r of Dt.call(this,n,t));}function $n(e,t){if(typeof e!="function")throw new lt("fn",["Function","AsyncFunction"],e);async function n(r,i){return await e(r,i)?r:Et}return Dt.call(this,n,t)}class Za extends La{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function Xa(e,t,n){var r;if(typeof e!="function")throw new lt("reducer",["Function","AsyncFunction"],e);n!=null&&je(n,"options"),(n==null?void 0:n.signal)!=null&&We(n.signal,"options.signal");let i=arguments.length>1;if(n!=null&&(r=n.signal)!==null&&r!==void 0&&r.aborted){const d=new he(void 0,{cause:n.signal.reason});throw this.once("error",()=>{}),await $a(this.destroy(d)),d}const s=new Ii,l=s.signal;if(n!=null&&n.signal){const d={once:!0,[ka]:this};n.signal.addEventListener("abort",()=>s.abort(),d)}let c=!1;try{for await(const d of this){var h;if(c=!0,n!=null&&(h=n.signal)!==null&&h!==void 0&&h.aborted)throw new he;i?t=await e(t,d,{signal:l}):(t=d,i=!0)}if(!c&&!i)throw new Za}finally{s.abort()}return t}async function Qa(e){e!=null&&je(e,"options"),(e==null?void 0:e.signal)!=null&&We(e.signal,"options.signal");const t=[];for await(const r of this){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new he(void 0,{cause:e.signal.reason});Ua(t,r)}return t}function el(e,t){const n=Dt.call(this,e,t);return(async function*(){for await(const i of n)yield*i}).call(this)}function Pi(e){if(e=Ba(e),Ha(e))return 0;if(e<0)throw new Ma("number",">= 0",e);return e}function tl(e,t=void 0){return t!=null&&je(t,"options"),(t==null?void 0:t.signal)!=null&&We(t.signal,"options.signal"),e=Pi(e),(async function*(){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new he;for await(const s of this){var i;if(t!=null&&(i=t.signal)!==null&&i!==void 0&&i.aborted)throw new he;e--<=0&&(yield s)}}).call(this)}function nl(e,t=void 0){return t!=null&&je(t,"options"),(t==null?void 0:t.signal)!=null&&We(t.signal,"options.signal"),e=Pi(e),(async function*(){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new he;for await(const s of this){var i;if(t!=null&&(i=t.signal)!==null&&i!==void 0&&i.aborted)throw new he;if(e-- >0)yield s;else return}}).call(this)}In.streamReturningOperators={asIndexedPairs:za,drop:tl,filter:$n,flatMap:el,map:Dt,take:nl,compose:Va};In.promiseReturningOperators={every:Ka,forEach:Ja,reduce:Xa,toArray:Qa,some:vi,find:Ya};var un,Mr;function Ci(){if(Mr)return un;Mr=1;const{ArrayPrototypePop:e,Promise:t}=V,{isIterable:n,isNodeStream:r,isWebStream:i}=Re,{pipelineImpl:s}=kn,{finished:l}=Pe;Oi();function c(...h){return new t((d,p)=>{let m,_;const b=h[h.length-1];if(b&&typeof b=="object"&&!r(b)&&!n(b)&&!i(b)){const g=e(h);m=g.signal,_=g.end}s(h,(g,M)=>{g?p(g):d(M)},{signal:m,end:_})})}return un={finished:l,pipeline:c},un}var Dr;function Oi(){if(Dr)return zt.exports;Dr=1;const{Buffer:e}=$e,{ObjectDefineProperty:t,ObjectKeys:n,ReflectApply:r}=V,{promisify:{custom:i}}=Ee,{streamReturningOperators:s,promiseReturningOperators:l}=In,{codes:{ERR_ILLEGAL_CONSTRUCTOR:c}}=ne,h=Ai,{pipeline:d}=kn,{destroyer:p}=Ke,m=Pe,_=Ci(),b=Re,g=zt.exports=Nn.Stream;g.isDisturbed=b.isDisturbed,g.isErrored=b.isErrored,g.isReadable=b.isReadable,g.Readable=Mt();for(const O of n(s)){let y=function(...N){if(new.target)throw c();return g.Readable.from(r(I,this,N))};const I=s[O];t(y,"name",{__proto__:null,value:I.name}),t(y,"length",{__proto__:null,value:I.length}),t(g.Readable.prototype,O,{__proto__:null,value:y,enumerable:!1,configurable:!0,writable:!0})}for(const O of n(l)){let y=function(...N){if(new.target)throw c();return r(I,this,N)};const I=l[O];t(y,"name",{__proto__:null,value:I.name}),t(y,"length",{__proto__:null,value:I.length}),t(g.Readable.prototype,O,{__proto__:null,value:y,enumerable:!1,configurable:!0,writable:!0})}g.Writable=wi(),g.Duplex=me(),g.Transform=mi,g.PassThrough=Ei,g.pipeline=d;const{addAbortSignal:M}=Lt;return g.addAbortSignal=M,g.finished=m,g.destroy=p,g.compose=h,t(g,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return _}}),t(d,i,{__proto__:null,enumerable:!0,get(){return _.pipeline}}),t(m,i,{__proto__:null,enumerable:!0,get(){return _.finished}}),g.Stream=g,g._isUint8Array=function(I){return I instanceof Uint8Array},g._uint8ArrayToBuffer=function(I){return e.from(I.buffer,I.byteOffset,I.byteLength)},zt.exports}(function(e){const t=Oi(),n=Ci(),r=t.Readable.destroy;e.exports=t.Readable,e.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,e.exports._isUint8Array=t._isUint8Array,e.exports.isDisturbed=t.isDisturbed,e.exports.isErrored=t.isErrored,e.exports.isReadable=t.isReadable,e.exports.Readable=t.Readable,e.exports.Writable=t.Writable,e.exports.Duplex=t.Duplex,e.exports.Transform=t.Transform,e.exports.PassThrough=t.PassThrough,e.exports.addAbortSignal=t.addAbortSignal,e.exports.finished=t.finished,e.exports.destroy=t.destroy,e.exports.destroy=r,e.exports.pipeline=t.pipeline,e.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return n}}),e.exports.Stream=t.Stream,e.exports.default=e.exports})(Ur);var kt=Ur.exports;function bt(){}const kr="SYN",cn="ACK",$r="BRK";class xr extends kt.Duplex{constructor(t){let{name:n,target:r,targetWindow:i=window,targetOrigin:s="*"}=t;if(super({objectMode:!0}),T(this,"_init",void 0),T(this,"_haveSyn",void 0),T(this,"_name",void 0),T(this,"_target",void 0),T(this,"_targetWindow",void 0),T(this,"_targetOrigin",void 0),T(this,"_onMessage",void 0),T(this,"_synIntervalId",void 0),!n||!r)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=n,this._target=r,this._targetWindow=i,this._targetOrigin=s,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write($r,null,bt),this._haveSyn=!1,this._init=!1}_handShake(){this._write(kr,null,bt),this.cork()}_onData(t){if(!this._init)t===kr?(this._haveSyn=!0,this._write(cn,null,bt)):t===cn&&(this._init=!0,this._haveSyn||this._write(cn,null,bt),this.uncork());else if(t===$r)this._break();else try{this.push(t)}catch(n){this.emit("error",n)}}_postMessage(t){const n=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:t},n)}onMessage(t){const n=t.data;this._targetOrigin!=="*"&&t.origin!==this._targetOrigin||t.source!==this._targetWindow||typeof n!="object"||n.target!==this._name||!n.data||this._onData(n.data)}_read(){}_write(t,n,r){this._postMessage(t),r()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}function Wr(e,t,n){try{Reflect.apply(e,t,n)}catch(r){setTimeout(()=>{throw r})}}function rl(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r+=1)n[r]=e[r];return n}class $t extends Rt.EventEmitter{emit(t){let n=t==="error";const r=this._events;if(r!==void 0)n=n&&r.error===void 0;else if(!n)return!1;for(var i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];if(n){let h;if(s.length>0&&([h]=s),h instanceof Error)throw h;const d=new Error(`Unhandled error.${h?` (${h.message})`:""}`);throw d.context=h,d}const c=r[t];if(c===void 0)return!1;if(typeof c=="function")Wr(c,this,s);else{const h=c.length,d=rl(c);for(let p=0;p<h;p+=1)Wr(d[p],this,s)}return!0}}class nt extends Error{constructor(t){let{code:n,message:r,data:i}=t;if(!Number.isInteger(n))throw new Error("code must be an integer");if(!r||typeof r!="string")throw new Error("message must be string");super(r),T(this,"code",void 0),T(this,"data",void 0),this.code=n,i!==void 0&&(this.data=i)}toString(){return qi({code:this.code,message:this.message,data:this.data,stack:this.stack})}}const Rn=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(r,i)=>{r||i.error?t(r||i.error):!n||Array.isArray(i)?e(i):e(i.result)}};function il(){const e={};function t(){return!1}const n=new $t;function r(h){const d=e[h.id];if(!d)throw new Error(`StreamMiddleware - Unknown response id "${h.id}"`);delete e[h.id],Object.assign(d.res,h),setTimeout(d.end)}function i(h){n.emit("notification",h)}function s(h,d,p){let m;try{!h.id?i(h):r(h)}catch(_){m=_}p(m)}const l=new kt.Duplex({objectMode:!0,read:t,write:s});return{events:n,middleware:(h,d,p,m)=>{l.push(h),e[h.id]={req:h,res:d,next:p,end:m}},stream:l}}function ol(){return(e,t,n,r)=>{const i=e.id,s=Math.random().toString(36).slice(2);e.id=s,t.id=s,n(l=>{e.id=i,t.id=i,l()})}}class we extends $t{constructor(){super(),T(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(t,n,r){const i=[];let s=null,l=!1;for(const c of r)if([s,l]=await we._runMiddleware(t,n,c,i),l)break;return[s,l,i.reverse()]}static _runMiddleware(t,n,r,i){return new Promise(s=>{const l=h=>{const d=h||n.error;d&&(n.error=Gn.serializeError(d)),s([d,!0])},c=h=>{n.error?l(n.error):(h&&(typeof h!="function"&&l(new nt({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),i.push(h)),s([null,!1]))};try{r(t,n,c,l)}catch(h){l(h)}})}static async _runReturnHandlers(t){for(const n of t)await new Promise((r,i)=>{n(s=>s?i(s):r())})}static _checkForCompletion(t,n,r){if(!("result"in n)&&!("error"in n))throw new nt({code:-32603,message:"Response has no error or result for request"});if(!r)throw new nt({code:-32603,message:"Nothing ended request"})}push(t){this._middleware.push(t)}handle(t,n){if(n&&typeof n!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(t)?n?this._handleBatch(t,n):this._handleBatch(t):n?this._handle(t,n):this._promiseHandle(t)}asMiddleware(){return async(t,n,r,i)=>{try{const[s,l,c]=await we._runAllMiddleware(t,n,this._middleware);return l?(await we._runReturnHandlers(c),i(s)):r(async h=>{try{await we._runReturnHandlers(c)}catch(d){return h(d)}return h()})}catch(s){return i(s)}}}async _handleBatch(t,n){try{const r=await Promise.all(t.map(this._promiseHandle.bind(this)));return n?n(null,r):r}catch(r){if(n)return n(r);throw r}}_promiseHandle(t){return new Promise(n=>{this._handle(t,(r,i)=>{n(i)})})}async _handle(t,n){if(!t||Array.isArray(t)||typeof t!="object"){const l=new nt({code:-32603,message:"request must be plain object"});return n(l,{id:void 0,jsonrpc:"2.0",error:l})}if(typeof t.method!="string"){const l=new nt({code:-32603,message:"method must be string"});return n(l,{id:t.id,jsonrpc:"2.0",error:l})}const r=ce({},t),i={id:r.id,jsonrpc:r.jsonrpc};let s=null;try{await this._processRequest(r,i)}catch(l){s=l}return s&&(delete i.result,i.error||(i.error=Gn.serializeError(s))),n(s,i)}async _processRequest(t,n){const[r,i,s]=await we._runAllMiddleware(t,n,this._middleware);if(we._checkForCompletion(t,n,i),await we._runReturnHandlers(s),r)throw r}}class sl extends kt.Duplex{constructor(t){let{parent:n,name:r}=t;super({objectMode:!0}),T(this,"_parent",void 0),T(this,"_name",void 0),this._parent=n,this._name=r}_read(){}_write(t,n,r){this._parent.push({name:this._name,data:t}),r()}}const jr=Symbol("IGNORE_SUBSTREAM");class al extends kt.Duplex{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(ce(ce({},t),{},{objectMode:!0})),T(this,"_substreams",void 0),T(this,"getStream",void 0),this._substreams={}}createStream(t){if(!t)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[t])throw new Error(`ObjectMultiplex - Substream for name "${t}" already exists`);const n=new sl({parent:this,name:t});return this._substreams[t]=n,ll(this,r=>n.destroy(r||void 0)),n}ignoreStream(t){if(!t)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[t])throw new Error(`ObjectMultiplex - Substream for name "${t}" already exists`);this._substreams[t]=jr}_read(){}_write(t,n,r){const{name:i,data:s}=t;if(!i)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${t}"`),r();const l=this._substreams[i];return l?(l!==jr&&l.push(s),r()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${i}"`),r())}}function ll(e,t){const n=Ui(t);Vn(e,{readable:!1},n),Vn(e,{writable:!1},n)}var ye={},Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.EthereumProviderError=Te.EthereumRpcError=void 0;const dl=Bi;class Ni extends Error{constructor(t,n,r){if(!Number.isInteger(t))throw new Error('"code" must be an integer.');if(!n||typeof n!="string")throw new Error('"message" must be a nonempty string.');super(n),this.code=t,r!==void 0&&(this.data=r)}serialize(){const t={code:this.code,message:this.message};return this.data!==void 0&&(t.data=this.data),this.stack&&(t.stack=this.stack),t}toString(){return dl.default(this.serialize(),fl,2)}}Te.EthereumRpcError=Ni;class ul extends Ni{constructor(t,n,r){if(!cl(t))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(t,n,r)}}Te.EthereumProviderError=ul;function cl(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}function fl(e,t){if(t!=="[Circular]")return t}var xn={},ve={};Object.defineProperty(ve,"__esModule",{value:!0});ve.errorValues=ve.errorCodes=void 0;ve.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};ve.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.serializeError=e.isValidCode=e.getMessageFromCode=e.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const t=ve,n=Te,r=t.errorCodes.rpc.internal,i="Unspecified error message. This is a bug, please report it.",s={code:r,message:l(r)};e.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function l(_,b=i){if(Number.isInteger(_)){const g=_.toString();if(m(t.errorValues,g))return t.errorValues[g].message;if(d(_))return e.JSON_RPC_SERVER_ERROR_MESSAGE}return b}e.getMessageFromCode=l;function c(_){if(!Number.isInteger(_))return!1;const b=_.toString();return!!(t.errorValues[b]||d(_))}e.isValidCode=c;function h(_,{fallbackError:b=s,shouldIncludeStack:g=!1}={}){var M,O;if(!b||!Number.isInteger(b.code)||typeof b.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(_ instanceof n.EthereumRpcError)return _.serialize();const I={};if(_&&typeof _=="object"&&!Array.isArray(_)&&m(_,"code")&&c(_.code)){const N=_;I.code=N.code,N.message&&typeof N.message=="string"?(I.message=N.message,m(N,"data")&&(I.data=N.data)):(I.message=l(I.code),I.data={originalError:p(_)})}else{I.code=b.code;const N=(M=_)===null||M===void 0?void 0:M.message;I.message=N&&typeof N=="string"?N:b.message,I.data={originalError:p(_)}}const y=(O=_)===null||O===void 0?void 0:O.stack;return g&&_&&y&&typeof y=="string"&&(I.stack=y),I}e.serializeError=h;function d(_){return _>=-32099&&_<=-32e3}function p(_){return _&&typeof _=="object"&&!Array.isArray(_)?Object.assign({},_):_}function m(_,b){return Object.prototype.hasOwnProperty.call(_,b)}})(xn);var xt={};Object.defineProperty(xt,"__esModule",{value:!0});xt.ethErrors=void 0;const Wn=Te,Li=xn,Q=ve;xt.ethErrors={rpc:{parse:e=>ie(Q.errorCodes.rpc.parse,e),invalidRequest:e=>ie(Q.errorCodes.rpc.invalidRequest,e),invalidParams:e=>ie(Q.errorCodes.rpc.invalidParams,e),methodNotFound:e=>ie(Q.errorCodes.rpc.methodNotFound,e),internal:e=>ie(Q.errorCodes.rpc.internal,e),server:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return ie(t,e)},invalidInput:e=>ie(Q.errorCodes.rpc.invalidInput,e),resourceNotFound:e=>ie(Q.errorCodes.rpc.resourceNotFound,e),resourceUnavailable:e=>ie(Q.errorCodes.rpc.resourceUnavailable,e),transactionRejected:e=>ie(Q.errorCodes.rpc.transactionRejected,e),methodNotSupported:e=>ie(Q.errorCodes.rpc.methodNotSupported,e),limitExceeded:e=>ie(Q.errorCodes.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>rt(Q.errorCodes.provider.userRejectedRequest,e),unauthorized:e=>rt(Q.errorCodes.provider.unauthorized,e),unsupportedMethod:e=>rt(Q.errorCodes.provider.unsupportedMethod,e),disconnected:e=>rt(Q.errorCodes.provider.disconnected,e),chainDisconnected:e=>rt(Q.errorCodes.provider.chainDisconnected,e),custom:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:t,message:n,data:r}=e;if(!n||typeof n!="string")throw new Error('"message" must be a nonempty string');return new Wn.EthereumProviderError(t,n,r)}}};function ie(e,t){const[n,r]=Mi(t);return new Wn.EthereumRpcError(e,n||Li.getMessageFromCode(e),r)}function rt(e,t){const[n,r]=Mi(t);return new Wn.EthereumProviderError(e,n||Li.getMessageFromCode(e),r)}function Mi(e){if(e){if(typeof e=="string")return[e];if(typeof e=="object"&&!Array.isArray(e)){const{message:t,data:n}=e;if(t&&typeof t!="string")throw new Error("Must specify string message.");return[t||void 0,n]}}return[]}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getMessageFromCode=e.serializeError=e.EthereumProviderError=e.EthereumRpcError=e.ethErrors=e.errorCodes=void 0;const t=Te;Object.defineProperty(e,"EthereumRpcError",{enumerable:!0,get:function(){return t.EthereumRpcError}}),Object.defineProperty(e,"EthereumProviderError",{enumerable:!0,get:function(){return t.EthereumProviderError}});const n=xn;Object.defineProperty(e,"serializeError",{enumerable:!0,get:function(){return n.serializeError}}),Object.defineProperty(e,"getMessageFromCode",{enumerable:!0,get:function(){return n.getMessageFromCode}});const r=xt;Object.defineProperty(e,"ethErrors",{enumerable:!0,get:function(){return r.ethErrors}});const i=ve;Object.defineProperty(e,"errorCodes",{enumerable:!0,get:function(){return i.errorCodes}})})(ye);var hl="2.0.0";function Di(e){return e!==null&&typeof e=="object"&&typeof e.pipe=="function"}function pl(e){return Di(e)&&e.writable!==!1&&typeof e._write=="function"&&typeof e._writableState=="object"}function gl(e){return Di(e)&&e.readable!==!1&&typeof e._read=="function"&&typeof e._readableState=="object"}function bl(e){return pl(e)&&gl(e)}var ue={errors:{disconnected:()=>"Torus: Lost connection to Torus.",permanentlyDisconnected:()=>"Torus: Disconnected from iframe. Page reload required.",unsupportedSync:e=>`Torus: The Torus Ethereum provider does not support synchronous methods like ${e} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:e=>`Invalid options. Received: { maxEventListeners: ${e}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:e=>`'args.logger' must include required method '${e}'.`},info:{connected:e=>`Torus: Connected to chain with ID "${e}".`},warnings:{}};const _l={PRODUCTION:"production",DEVELOPMENT:"development",TESTING:"testing"},ot={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"},fn={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless"},wl={en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies benötigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"継続する",actionRequired:"認証が必要です",pendingAction:"続行をクリックして、ポップアップでリクエストを続行します",cookiesRequired:"必要なクッキー",enableCookies:"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。",clickHere:"詳しくは"}},ko:{embed:{continue:"계속하다",actionRequired:"승인 필요",pendingAction:"팝업에서 요청을 진행하려면 계속을 클릭하십시오.",cookiesRequired:"쿠키 필요",enableCookies:"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.",clickHere:"더 많은 정보"}},zh:{embed:{continue:"继续",actionRequired:"需要授权",pendingAction:"单击继续以在弹出窗口中继续您的请求",cookiesRequired:"必填Cookie",enableCookies:"请在您的浏览器首选项中启用cookie以访问Torus。",clickHere:"更多信息"}}};var jn={supportedVerifierList:[fn.GOOGLE,fn.REDDIT,fn.DISCORD],api:"https://api.tor.us",translations:wl,prodTorusUrl:"",localStorageKeyPrefix:"torus-"},j=Hi.getLogger("solana-embed");function yl(){return(e,t,n)=>{(typeof e.method!="string"||!e.method)&&(t.error=ye.ethErrors.rpc.invalidRequest({message:"The request 'method' must be a non-empty string.",data:e})),n(r=>{const{error:i}=t;return i&&j.error(`Torus - RPC Error: ${i.message}`,i),r()})}}function ml(e,t,n){let r=`Torus: Lost connection to "${e}".`;t!=null&&t.stack&&(r+=`
${t.stack}`),j.warn(r),n&&n.listenerCount("error")>0&&n.emit("error",r)}const _t=()=>Math.random().toString(36).slice(2),ki=async e=>{let t,n;switch(e){case"testing":t="https://solana-testing.tor.us",n="debug";break;case"development":t="http://localhost:8080",n="debug";break;default:t="https://solana.tor.us",n="error";break}return{torusUrl:t,logLevel:n}},Sl=()=>{let e=window.navigator.language||"en-US";const t=e.split("-");return e=Object.prototype.hasOwnProperty.call(jn.translations,t[0])?t[0]:"en",e},El={height:660,width:375},Rl={height:740,width:1315},Al={height:700,width:1200},$i={height:600,width:400};function Il(e){let t;try{t=window[e];const n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(n){const r=n;return r&&(r.code===22||r.code===1014||r.name==="QuotaExceededError"||r.name==="NS_ERROR_DOM_QUOTA_REACHED")&&t&&t.length!==0}}function at(e){let{width:t,height:n}=e;const r=window.screenLeft!==void 0?window.screenLeft:window.screenX,i=window.screenTop!==void 0?window.screenTop:window.screenY,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,l=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,c=1,h=Math.abs((s-t)/2/c+r),d=Math.abs((l-n)/2/c+i);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${n/c},width=${t/c},top=${d},left=${h}`}class xi extends $t{constructor(t,n){let{maxEventListeners:r=100,jsonRpcStreamName:i="provider"}=n;if(super(),T(this,"isTorus",void 0),T(this,"_rpcEngine",void 0),T(this,"jsonRpcConnectionEvents",void 0),T(this,"_state",void 0),!bl(t))throw new Error(ue.errors.invalidDuplexStream());this.isTorus=!0,this.setMaxListeners(r),this._handleConnect=this._handleConnect.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this._initializeState=this._initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this);const s=new al;Kn(t,s,t,this._handleStreamDisconnect.bind(this,"Torus")),s.ignoreStream("phishing");const l=il();Kn(l.stream,s.createStream(i),l.stream,this._handleStreamDisconnect.bind(this,"Torus RpcProvider"));const c=new we;c.push(ol()),c.push(yl()),c.push(Vi({origin:location.origin})),c.push(l.middleware),this._rpcEngine=c,this.jsonRpcConnectionEvents=l.events}async request(t){if(!t||typeof t!="object"||Array.isArray(t))throw ye.ethErrors.rpc.invalidRequest({message:ue.errors.invalidRequestArgs(),data:t});const{method:n,params:r}=t;if(typeof n!="string"||n.length===0)throw ye.ethErrors.rpc.invalidRequest({message:ue.errors.invalidRequestMethod(),data:t});if(r!==void 0&&!Array.isArray(r)&&(typeof r!="object"||r===null))throw ye.ethErrors.rpc.invalidRequest({message:ue.errors.invalidRequestParams(),data:t});return new Promise((i,s)=>{this._rpcRequest({method:n,params:r},Rn(i,s))})}send(t,n){this._rpcRequest(t,n)}sendAsync(t){return new Promise((n,r)=>{this._rpcRequest(t,Rn(n,r))})}_handleStreamDisconnect(t,n){ml(t,n,this),this._handleDisconnect(!1,n?n.message:void 0)}}const Ge=e=>{const t=window.document.createElement("template"),n=e.trim();return t.innerHTML=n,t.content.firstChild};function wt(e){return e.version===void 0}class Wi extends $t{constructor(t){let{url:n,target:r,features:i,timeout:s=3e4}=t;super(),T(this,"url",void 0),T(this,"target",void 0),T(this,"features",void 0),T(this,"window",void 0),T(this,"windowTimer",void 0),T(this,"iClosedWindow",void 0),T(this,"timeout",void 0),this.url=n,this.target=r||"_blank",this.features=i||at(Al),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=s,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var t;return this.window=window.open(this.url.href,this.target,this.features),(t=this.window)!=null&&t.focus&&this.window.focus(),Promise.resolve()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(t){t?window.location.replace(this.url.href):window.location.href=this.url.href}}class Wt extends xi{constructor(t,n){let{maxEventListeners:r=100,jsonRpcStreamName:i="provider"}=n;super(t,{maxEventListeners:r,jsonRpcStreamName:i}),T(this,"embedTranslations",void 0),T(this,"torusUrl",void 0),T(this,"dappStorageKey",void 0),T(this,"windowRefs",void 0),T(this,"tryWindowHandle",void 0),T(this,"torusAlertContainer",void 0),T(this,"torusIframe",void 0),this._state=ce({},Wt._defaultState),this.torusUrl="",this.dappStorageKey="";const s=jn.translations[Sl()];this.embedTranslations=s.embed,this.windowRefs={},this.on("connect",()=>{this._state.isConnected=!0});const l=c=>{const{method:h,params:d}=c;if(h===tt.IFRAME_STATUS){const{isFullScreen:p,rid:m}=d;this._displayIframe({isFull:p,rid:m})}else if(h===tt.CREATE_WINDOW){const{windowId:p,url:m}=d;this._createPopupBlockAlert(p,m)}else if(h===tt.CLOSE_WINDOW)this._handleCloseWindow(d);else if(h===tt.USER_LOGGED_IN){const{currentLoginProvider:p}=d;this._state.isLoggedIn=!0,this._state.currentLoginProvider=p}else h===tt.USER_LOGGED_OUT&&(this._state.isLoggedIn=!1,this._state.currentLoginProvider=null,this._displayIframe())};this.jsonRpcConnectionEvents.on("notification",l)}get isLoggedIn(){return this._state.isLoggedIn}get isIFrameFullScreen(){return this._state.isIFrameFullScreen}isConnected(){return this._state.isConnected}async _initializeState(t){try{const{torusUrl:n,dappStorageKey:r,torusAlertContainer:i,torusIframe:s}=t;this.torusUrl=n,this.dappStorageKey=r,this.torusAlertContainer=i,this.torusIframe=s,this.torusIframe.addEventListener("load",()=>{this._state.isIFrameFullScreen||this._displayIframe()});const{currentLoginProvider:l,isLoggedIn:c}=await this.request({method:de.GET_PROVIDER_STATE,params:[]});this._handleConnect(l,c)}catch(n){j.error("Torus: Failed to get initial state. Please report this bug.",n)}finally{j.info("initialized communication state"),this._state.initialized=!0,this.emit("_initialized")}}_handleWindow(t){let{url:n,target:r,features:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new URL(n||`${this.torusUrl}/redirect?windowId=${t}`);this.dappStorageKey&&(s.hash?s.hash+=`&dappStorageKey=${this.dappStorageKey}`:s.hash=`#dappStorageKey=${this.dappStorageKey}`);const l=new Wi({url:s,target:r,features:i});if(l.open(),!l.window){this._createPopupBlockAlert(t,s.href);return}this.windowRefs[t]=l,this.request({method:de.OPENED_WINDOW,params:{windowId:t}}),l.once("close",()=>{delete this.windowRefs[t],this.request({method:de.CLOSED_WINDOW,params:{windowId:t}})})}_displayIframe(){let{isFull:t=!1,rid:n=""}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r={};if(t)r.display="block",r.width="100%",r.height="100%",r.top="0px",r.right="0px",r.left="0px",r.bottom="0px";else switch(r.display=this._state.torusWidgetVisibility?"block":"none",r.height="70px",r.width="70px",this._state.buttonPosition){case ot.TOP_LEFT:r.top="0px",r.left="0px",r.right="auto",r.bottom="auto";break;case ot.TOP_RIGHT:r.top="0px",r.right="0px",r.left="auto",r.bottom="auto";break;case ot.BOTTOM_RIGHT:r.bottom="0px",r.right="0px",r.top="auto",r.left="auto";break;case ot.BOTTOM_LEFT:default:r.bottom="0px",r.left="0px",r.top="auto",r.right="auto";break}Object.assign(this.torusIframe.style,r),this._state.isIFrameFullScreen=t,this.request({method:de.IFRAME_STATUS,params:{isIFrameFullScreen:t,rid:n}})}hideTorusButton(){this._state.torusWidgetVisibility=!1,this._displayIframe()}showTorusButton(){this._state.torusWidgetVisibility=!0,this._displayIframe()}_rpcRequest(t,n){const r=n,i=t;Array.isArray(i)||i.jsonrpc||(i.jsonrpc="2.0"),this.tryWindowHandle(i,r)}_handleConnect(t,n){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{currentLoginProvider:t,isLoggedIn:n}),j.debug(ue.info.connected(t)))}_handleDisconnect(t,n){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!t){this._state.isConnected=!1;let r;t?(r=new ye.EthereumRpcError(1013,n||ue.errors.disconnected()),j.debug(r)):(r=new ye.EthereumRpcError(1011,n||ue.errors.permanentlyDisconnected()),j.error(r),this._state.currentLoginProvider=null,this._state.isLoggedIn=!1,this._state.torusWidgetVisibility=!1,this._state.isIFrameFullScreen=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r)}}_handleCloseWindow(t){const{windowId:n}=t;this.windowRefs[n]&&(this.windowRefs[n].close(),delete this.windowRefs[n])}async _createPopupBlockAlert(t,n){const r=this.getLogoUrl(),i=Ge(`<div id="torusAlert" class="torus-alert--v2"><div id="torusAlert__logo"><img src="${r}" /></div><div><h1 id="torusAlert__title">${this.embedTranslations.actionRequired}</h1><p id="torusAlert__desc">${this.embedTranslations.pendingAction}</p></div></div>`),s=Ge(`<div><a id="torusAlert__btn">${this.embedTranslations.continue}</a></div>`),l=Ge('<div id="torusAlert__btn-container"></div>');l.appendChild(s),i.appendChild(l);const c=()=>{s.addEventListener("click",()=>{this._handleWindow(t,{url:n,target:"_blank",features:at($i)}),i.remove(),this.torusAlertContainer.children.length===0&&(this.torusAlertContainer.style.display="none")})};(()=>{this.torusAlertContainer.appendChild(i)})(),c(),this.torusAlertContainer.style.display="block"}getLogoUrl(){return`${this.torusUrl}/images/torus_icon-blue.svg`}}T(Wt,"_defaultState",{buttonPosition:"bottom-left",currentLoginProvider:null,isIFrameFullScreen:!1,hasEmittedConnection:!1,torusWidgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1});class jt extends xi{constructor(t,n){let{maxEventListeners:r=100,jsonRpcStreamName:i="provider"}=n;super(t,{maxEventListeners:r,jsonRpcStreamName:i}),T(this,"chainId",void 0),T(this,"selectedAddress",void 0),T(this,"tryWindowHandle",void 0),this._state=ce({},jt._defaultState),this.selectedAddress=null,this.chainId=null,this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this.on("connect",()=>{this._state.isConnected=!0});const s=l=>{const{method:c,params:h}=l;c===Gt.ACCOUNTS_CHANGED?this._handleAccountsChanged(h):c===Gt.UNLOCK_STATE_CHANGED?this._handleUnlockStateChanged(h):c===Gt.CHAIN_CHANGED&&this._handleChainChanged(h)};this.jsonRpcConnectionEvents.on("notification",s)}isConnected(){return this._state.isConnected}async _initializeState(){try{const{accounts:t,chainId:n,isUnlocked:r}=await this.request({method:Gi.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:n}),this._handleChainChanged({chainId:n}),this._handleUnlockStateChanged({accounts:t,isUnlocked:r}),this._handleAccountsChanged(t)}catch(t){j.error("Torus: Failed to get initial state. Please report this bug.",t)}finally{j.info("initialized provider state"),this._state.initialized=!0,this.emit("_initialized")}}_rpcRequest(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=n;const s=t;if(!Array.isArray(s)){if(s.jsonrpc||(s.jsonrpc="2.0"),s.method==="solana_accounts"||s.method==="solana_requestAccounts")i=(l,c)=>{this._handleAccountsChanged(c.result||[],s.method==="solana_accounts",r),n(l,c)};else if(s.method==="wallet_getProviderState"){this._rpcEngine.handle(t,i);return}}this.tryWindowHandle(s,i)}_handleConnect(t){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:t}),j.debug(ue.info.connected(t)))}_handleDisconnect(t,n){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!t){this._state.isConnected=!1;let r;t?(r=new ye.EthereumRpcError(1013,n||ue.errors.disconnected()),j.debug(r)):(r=new ye.EthereumRpcError(1011,n||ue.errors.permanentlyDisconnected()),j.error(r),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r)}}_handleAccountsChanged(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=t;Array.isArray(i)||(j.error("Torus: Received non-array accounts parameter. Please report this bug.",i),i=[]);for(const s of t)if(typeof s!="string"){j.error("Torus: Received non-string account. Please report this bug.",t),i=[];break}Xi(this._state.accounts,i)||(n&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!r&&j.error('Torus: "solana_accounts" unexpectedly updated accounts. Please report this bug.',i),this._state.accounts=i,this.emit("accountsChanged",i)),this.selectedAddress!==i[0]&&(this.selectedAddress=i[0]||null)}_handleChainChanged(){let{chainId:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!t){j.error("Torus: Received invalid network parameters. Please report this bug.",{chainId:t});return}t==="loading"?this._handleDisconnect(!0):(this._handleConnect(t),t!==this.chainId&&(this.chainId=t,this._state.initialized&&this.emit("chainChanged",this.chainId)))}_handleUnlockStateChanged(){let{accounts:t,isUnlocked:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(typeof n!="boolean"){j.error("Torus: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:n});return}n!==this._state.isUnlocked&&(this._state.isUnlocked=n,this._handleAccountsChanged(t||[]))}}T(jt,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});function Fr(e){return new Promise((t,n)=>{try{const r=document.createElement("img");r.onload=()=>t(!0),r.onerror=()=>t(!1),r.src=e}catch(r){n(r)}})}const Tl=e=>{const{document:t}=e,n=t.querySelector('head > meta[property="og:site_name"]');if(n)return n.content;const r=t.querySelector('head > meta[name="title"]');return r?r.content:t.title&&t.title.length>0?t.title:e.location.hostname};async function vl(e){try{const{document:t}=e;let n=t.querySelector('head > link[rel="shortcut icon"]');return n&&await Fr(n.href)||(n=Array.from(t.querySelectorAll('head > link[rel="icon"]')).find(r=>!!r.href),n&&await Fr(n.href))?n.href:""}catch{return""}}const Pl=async()=>({name:Tl(window),icon:await vl(window)}),Cl=["send_transaction","sign_transaction","sign_all_transactions","sign_message","connect"],Ol=[de.SET_PROVIDER],Nl=Il("localStorage");(async function(){try{if(typeof document>"u")return;const t=document.createElement("link"),{torusUrl:n}=await ki("production");t.href=`${n}/frame`,t.crossOrigin="anonymous",t.type="text/html",t.rel="prefetch",t.relList&&t.relList.supports&&t.relList.supports("prefetch")&&document.head.appendChild(t)}catch(t){j.warn(t)}})();class Ll{constructor(){let{modalZIndex:t=99999}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,"isInitialized",void 0),T(this,"torusAlert",void 0),T(this,"modalZIndex",void 0),T(this,"alertZIndex",void 0),T(this,"requestedLoginProvider",void 0),T(this,"provider",void 0),T(this,"communicationProvider",void 0),T(this,"dappStorageKey",void 0),T(this,"isTopupHidden",!1),T(this,"torusAlertContainer",void 0),T(this,"torusUrl",void 0),T(this,"torusIframe",void 0),T(this,"styleLink",void 0),this.torusUrl="",this.isInitialized=!1,this.requestedLoginProvider=null,this.modalZIndex=t,this.alertZIndex=t+1e3,this.dappStorageKey=""}get isLoggedIn(){return this.communicationProvider?this.communicationProvider.isLoggedIn:!1}async init(){let{buildEnv:t=_l.PRODUCTION,enableLogging:n=!1,network:r,showTorusButton:i=!1,useLocalStorage:s=!1,buttonPosition:l=ot.BOTTOM_LEFT,apiKey:c="torus-default",extraParams:h={},whiteLabel:d}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.isInitialized)throw new Error("Already initialized");zi(c);const{torusUrl:p,logLevel:m}=await ki(t);j.enableAll(),j.info(p,"url loaded"),j.info(`Solana Embed Version :${hl}`),this.torusUrl=p,j.setDefaultLevel(m),n?j.enableAll():j.disableAll();const _=this.handleDappStorageKey(s),b=new URL(p);b.pathname.endsWith("/")?b.pathname+="frame":b.pathname+="/frame";const g=new URLSearchParams;return _&&g.append("dappStorageKey",_),g.append("origin",window.location.origin),b.hash=g.toString(),this.torusIframe=Ge(`<iframe
        id="torusIframe"
        class="torusIframe"
        src="${b.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()}"
      ></iframe>`),this.torusAlertContainer=Ge(`<div id="torusAlertContainer" style="display:none; z-index: ${this.alertZIndex.toString()}"></div>`),this.styleLink=Ge(`<link href="${p}/css/widget.css" rel="stylesheet" type="text/css">`),new Promise((M,O)=>{try{this.torusIframe.addEventListener("load",async()=>{const I=await Pl();this.torusIframe.contentWindow.postMessage({buttonPosition:l,apiKey:c,network:r,dappMetadata:I,extraParams:h,whiteLabel:d},b.origin),await this._setupWeb3({torusUrl:p}),i&&this.showTorusButton(),d!=null&&d.topupHide?this.isTopupHidden=d.topupHide:this.hideTorusButton(),this.isInitialized=!0,window.torus=this,M()}),window.document.head.appendChild(this.styleLink),window.document.body.appendChild(this.torusIframe),window.document.body.appendChild(this.torusAlertContainer)}catch(I){O(I)}})}async login(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.isInitialized)throw new Error("Call init() first");try{this.requestedLoginProvider=t.loginProvider||null,this.requestedLoginProvider||this.communicationProvider._displayIframe({isFull:!0});const n=await new Promise((r,i)=>{this.provider._rpcRequest({method:"solana_requestAccounts",params:[this.requestedLoginProvider,t.login_hint]},Rn(r,i))});if(Array.isArray(n)&&n.length>0)return n;throw new Error("Login failed")}catch(n){throw j.error("login failed",n),n}finally{this.communicationProvider.isIFrameFullScreen&&this.communicationProvider._displayIframe()}}async loginWithPrivateKey(t){if(!this.isInitialized)throw new Error("Call init() first");const{privateKey:n,userInfo:r}=t,{success:i}=await this.communicationProvider.request({method:"login_with_private_key",params:{privateKey:n,userInfo:r}});if(!i)throw new Error("Login Failed")}async logout(){if(!this.communicationProvider.isLoggedIn)throw new Error("Not logged in");await this.communicationProvider.request({method:de.LOGOUT,params:[]}),this.requestedLoginProvider=null}async cleanUp(){this.communicationProvider.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function t(n){return n instanceof Element||n instanceof Document}t(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),t(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),t(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}hideTorusButton(){this.communicationProvider.hideTorusButton()}showTorusButton(){this.communicationProvider.showTorusButton()}async setProvider(t){await this.communicationProvider.request({method:de.SET_PROVIDER,params:ce({},t)})}async showWallet(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=await this.communicationProvider.request({method:de.WALLET_INSTANCE_ID,params:[]}),i=t?`/${t}`:"",s=new URL(`${this.torusUrl}/wallet${i}`);s.searchParams.append("instanceId",r),Object.keys(n).forEach(c=>{s.searchParams.append(c,n[c])}),this.dappStorageKey&&(s.hash=`#dappStorageKey=${this.dappStorageKey}`),new Wi({url:s,features:at(Rl)}).open()}async getUserInfo(){return await this.communicationProvider.request({method:de.USER_INFO,params:[]})}async initiateTopup(t,n){if(!this.isInitialized)throw new Error("Torus is not initialized");const r=_t();return this.communicationProvider._handleWindow(r),await this.communicationProvider.request({method:de.TOPUP,params:{provider:t,params:n,windowId:r}})}async getAccounts(){return await this.provider.request({method:"getAccounts",params:[]})}async sendTransaction(t){const n=wt(t),r=n?t.serialize({requireAllSignatures:!1}).toString("hex"):Be.Buffer.from(t.serialize()).toString("hex");return await this.provider.request({method:"send_transaction",params:{message:r,isLegacyTransaction:n}})}async signAndSendTransaction(t,n){const r=wt(t),i=r?t.serialize({requireAllSignatures:!1}).toString("hex"):Be.Buffer.from(t.serialize()).toString("hex");return{signature:await this.provider.request({method:"send_transaction",params:{message:i,options:n,isLegacyTransaction:r}})}}async signTransaction(t){const n=wt(t),r=n?t.serializeMessage().toString("hex"):Be.Buffer.from(t.message.serialize()).toString("hex"),i=await this.provider.request({method:"sign_transaction",params:{message:r,messageOnly:!0,isLegacyTransaction:n}}),s=JSON.parse(i),l={publicKey:new zn(s.publicKey),signature:Be.Buffer.from(s.signature,"hex")};return t.addSignature(l.publicKey,l.signature),t}async signAllTransactions(t){let n;const r=t.map(l=>(n=wt(l),n?l.serializeMessage().toString("hex"):Be.Buffer.from(l.message.serialize()).toString("hex"))),s=(await this.provider.request({method:"sign_all_transactions",params:{message:r,messageOnly:!0,isLegacyTransaction:n}})).map(l=>{const c=JSON.parse(l);return{publicKey:new zn(c.publicKey),signature:Be.Buffer.from(c.signature,"hex")}});return t.forEach((l,c)=>(l.addSignature(s[c].publicKey,s[c].signature),l)),t}async signMessage(t){return await this.provider.request({method:"sign_message",params:{data:t}})}async getGaslessPublicKey(){return await this.provider.request({method:"get_gasless_public_key",params:[]})}handleDappStorageKey(t){const n=`${jn.localStorageKeyPrefix}${window.location.hostname}`;let r="";if(Nl&&t){const i=window.localStorage.getItem(n);if(i)r=i;else{const s=`torus-app-${_t()}`;window.localStorage.setItem(n,s),r=s}}return this.dappStorageKey=r,r}async _setupWeb3(t){j.info("setupWeb3 running");const n=new xr({name:"embed_torus",target:"iframe_torus",targetWindow:this.torusIframe.contentWindow}),r=new xr({name:"embed_communication",target:"iframe_communication",targetWindow:this.torusIframe.contentWindow}),i=new jt(n,{}),s=new Wt(r,{});i.tryWindowHandle=(d,p)=>{const m=d;if(!Array.isArray(m)&&Cl.includes(m.method)){if(!this.communicationProvider.isLoggedIn)throw new Error("User Not Logged In");const _=_t();s._handleWindow(_,{target:"_blank",features:at($i)}),m.windowId=_}i._rpcEngine.handle(m,p)},s.tryWindowHandle=(d,p)=>{const m=d;if(!Array.isArray(m)&&Ol.includes(m.method)){const _=_t();s._handleWindow(_,{target:"_blank",features:at(El)}),m.params.windowId=_}s._rpcEngine.handle(m,p)};const l=d=>{const p=i[d],m=this;i[d]=function(b,g){const{method:M,params:O=[]}=b;if(M==="solana_requestAccounts"){if(!g)return m.login({loginProvider:O[0]});m.login({loginProvider:O[0]}).then(I=>g(null,I)).catch(I=>g(I))}return p.apply(this,[b,g])}};l("request"),l("sendAsync"),l("send");const c=new Proxy(i,{deleteProperty:()=>!0}),h=new Proxy(s,{deleteProperty:()=>!0});this.provider=c,this.communicationProvider=h,await Promise.all([i._initializeState(),s._initializeState(ce(ce({},t),{},{dappStorageKey:this.dappStorageKey,torusAlertContainer:this.torusAlertContainer,torusIframe:this.torusIframe}))]),j.debug("Torus - injected provider")}}class jl extends Qi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),T(this,"name",dt.TORUS_SOLANA),T(this,"adapterNamespace",Ki.SOLANA),T(this,"currentChainNamespace",Yi.SOLANA),T(this,"type",Ji.EXTERNAL),T(this,"status",le.NOT_READY),T(this,"torusInstance",null),T(this,"torusWalletOptions",void 0),T(this,"initParams",void 0),T(this,"loginSettings",{}),T(this,"solanaProvider",null),this.torusWalletOptions=t.adapterSettings||{},this.initParams=t.initParams||{},this.loginSettings=t.loginSettings||{}}get provider(){return this.status!==le.NOT_READY&&this.solanaProvider?this.solanaProvider:null}set provider(t){throw new Error("Not implemented")}async init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};await super.init(t),super.checkInitializationRequirements();const{chainId:n,blockExplorer:r,displayName:i,rpcTarget:s,ticker:l,tickerName:c}=this.chainConfig,h={chainId:n,rpcTarget:s,blockExplorerUrl:r,displayName:i,tickerName:c,ticker:l,logo:""};this.torusInstance=new Ll(this.torusWalletOptions),Vt.debug("initializing torus solana adapter init"),await this.torusInstance.init(ce(ce({showTorusButton:!1},this.initParams),{},{network:h})),this.solanaProvider=new Zi({config:{chainConfig:this.chainConfig}}),this.status=le.READY,this.emit(ut.READY,dt.TORUS_SOLANA);try{Vt.debug("initializing torus solana adapter"),t.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(d){Vt.error("Failed to connect with cached torus solana provider",d),this.emit(ut.ERRORED,d)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance)throw ct.notReady("Torus wallet is not initialized");if(!this.solanaProvider)throw ct.notReady("Torus wallet is not initialized");this.status=le.CONNECTING,this.emit(ut.CONNECTING,{adapter:dt.TORUS_SOLANA});try{await this.torusInstance.login(this.loginSettings);try{const t=this.torusInstance.provider;t.sendTransaction=this.torusInstance.sendTransaction.bind(this.torusInstance),t.signAllTransactions=this.torusInstance.signAllTransactions.bind(this.torusInstance),t.signMessage=this.torusInstance.signMessage.bind(this.torusInstance),t.signTransaction=this.torusInstance.signTransaction.bind(this.torusInstance),await this.solanaProvider.setupProvider(t)}catch(t){if(t instanceof Yn&&t.code===5010){const{chainId:n,blockExplorer:r,displayName:i,rpcTarget:s,ticker:l,tickerName:c}=this.chainConfig,h={chainId:n,rpcTarget:s,blockExplorerUrl:r,displayName:i,tickerName:c,ticker:l,logo:""};await this.torusInstance.setProvider(h)}else throw t}return this.status=le.CONNECTED,this.torusInstance.showTorusButton(),this.emit(le.CONNECTED,{adapter:dt.TORUS_SOLANA,reconnected:this.rehydrated}),this.provider}catch(t){throw this.status=le.READY,this.rehydrated=!1,this.emit(ut.ERRORED,t),t instanceof Yn?t:Jn.connectionError("Failed to login with torus solana wallet")}}async disconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};if(await super.disconnectSession(),!this.torusInstance)throw ct.notReady("Torus wallet is not initialized");await this.torusInstance.logout(),t.cleanup?(this.status=le.NOT_READY,this.torusInstance=null,this.solanaProvider=null):this.status=le.READY,await super.disconnect()}async getUserInfo(){if(this.status!==le.CONNECTED)throw Jn.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw ct.notReady("Torus wallet is not initialized");return await this.torusInstance.getUserInfo()}async addChain(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(t,n),this.addChainConfig(t)}async switchChain(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(t,r);const i=this.getChainConfig(t.chainId);await((n=this.torusInstance)===null||n===void 0?void 0:n.setProvider({rpcTarget:i.rpcTarget,chainId:i.chainId,displayName:i.displayName,blockExplorerUrl:i.blockExplorer,ticker:i.ticker,tickerName:i.tickerName,logo:"https://images.web3auth.io/login-torus-solana.svg"})),this.setAdapterSettings({chainConfig:this.getChainConfig(t.chainId)})}}export{jl as SolanaWalletAdapter};

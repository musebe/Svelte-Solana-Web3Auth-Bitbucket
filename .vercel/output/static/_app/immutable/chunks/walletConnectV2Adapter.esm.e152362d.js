import{av as Zt,R as Qe,n as vt,aw as Ws,C as ot,d as Ye,p as Ot,j as qr,w as Mr,A as ke,_ as ai,W as Ze,q as zr,m as ct,e as et,X as jr,k as ci,ax as Yi}from"./authFunctions.a8864b2c.js";import{k as ze}from"./scheduler.e3945ab3.js";import{c as C,b as Ur,w as Ys,r as Js,f as qi,t as ei,a as Vr,d as lt,V as Kr,M as kr,N as R,k as Br,e as Ei,g as Hr,K as Gr,T as Wr,q as Ji,x as Yr,H as Jr,F as Qr,h as Qi,$ as Xr,p as Zr,J as en,u as qt,i as Xi,X as tn,n as sn,_ as Qs,j as He,I as rn,l as Zi,m as _t,y as ie,U as Fe,o as ht,s as qe,v as nn,z as Et,A as Xs,B as on,C as an,D as cn,E as Zs,G as hn,L as er,O as tr,P as It,Q as xi,R as Yt,S as ir,W as ln,Y as hi,Z as un,a0 as fn,a1 as dn,a2 as pn,a3 as Bt,a4 as gn,a5 as yn,a6 as li,a7 as es,a8 as mn,a9 as wn,aa as bn,ab as ts,ac as vn,ad as _n,ae as En,af as xn,ag as In,ah as Sn,ai as Pn,aj as is}from"./ethereumProvider.esm.d381e564.js";import{B as Rn}from"./modal.esm.36bd4cf9.js";import{B as On}from"./baseEvmAdapter.esm.87bb7bf8.js";const Nn=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Tn=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,An=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Cn(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Fn(r);return}return e}function Fn(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function Ht(r,e={}){if(typeof r!="string")return r;const t=r.trim();if(r[0]==='"'&&r.at(-1)==='"'&&!r.includes("\\"))return t.slice(1,-1);if(t.length<=9){const i=t.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!An.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(Nn.test(r)||Tn.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,Cn)}return JSON.parse(r)}catch(i){if(e.strict)throw i;return r}}function Dn(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function oe(r,...e){try{return Dn(r(...e))}catch(t){return Promise.reject(t)}}function $n(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function Ln(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function Jt(r){if($n(r))return String(r);if(Ln(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return Jt(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function sr(){if(typeof ze.Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Ii="base64:";function qn(r){if(typeof r=="string")return r;sr();const e=ze.Buffer.from(r).toString("base64");return Ii+e}function Mn(r){return typeof r!="string"||!r.startsWith(Ii)?r:(sr(),ze.Buffer.from(r.slice(Ii.length),"base64"))}function Le(r){return r?r.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function zn(...r){return Le(r.join(":"))}function Gt(r){return r=Le(r),r?r+":":""}const jn="memory",Un=()=>{const r=new Map;return{name:jn,options:{},hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return Array.from(r.keys())},clear(){r.clear()},dispose(){r.clear()}}};function Vn(r={}){const e={mounts:{"":r.driver||Un()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=c=>{for(const u of e.mountpoints)if(c.startsWith(u))return{base:u,relativeKey:c.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:c,driver:e.mounts[""]}},i=(c,u)=>e.mountpoints.filter(p=>p.startsWith(c)||u&&c.startsWith(p)).map(p=>({relativeBase:c.length>p.length?c.slice(p.length):void 0,mountpoint:p,driver:e.mounts[p]})),s=(c,u)=>{if(e.watching){u=Le(u);for(const p of e.watchListeners)p(c,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await ss(e.mounts[c],s,c)}},a=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},h=(c,u,p)=>{const d=new Map,_=m=>{let S=d.get(m.base);return S||(S={driver:m.driver,base:m.base,items:[]},d.set(m.base,S)),S};for(const m of c){const S=typeof m=="string",$=Le(S?m:m.key),L=S?void 0:m.value,q=S||!m.options?u:{...u,...m.options},V=t($);_(V).items.push({key:$,value:L,relativeKey:V.relativeKey,options:q})}return Promise.all([...d.values()].map(m=>p(m))).then(m=>m.flat())},l={hasItem(c,u={}){c=Le(c);const{relativeKey:p,driver:d}=t(c);return oe(d.hasItem,p,u)},getItem(c,u={}){c=Le(c);const{relativeKey:p,driver:d}=t(c);return oe(d.getItem,p,u).then(_=>Ht(_))},getItems(c,u){return h(c,u,p=>p.driver.getItems?oe(p.driver.getItems,p.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(_=>({key:zn(p.base,_.key),value:Ht(_.value)}))):Promise.all(p.items.map(d=>oe(p.driver.getItem,d.relativeKey,d.options).then(_=>({key:d.key,value:Ht(_)})))))},getItemRaw(c,u={}){c=Le(c);const{relativeKey:p,driver:d}=t(c);return d.getItemRaw?oe(d.getItemRaw,p,u):oe(d.getItem,p,u).then(_=>Mn(_))},async setItem(c,u,p={}){if(u===void 0)return l.removeItem(c);c=Le(c);const{relativeKey:d,driver:_}=t(c);_.setItem&&(await oe(_.setItem,d,Jt(u),p),_.watch||s("update",c))},async setItems(c,u){await h(c,u,async p=>{p.driver.setItems&&await oe(p.driver.setItems,p.items.map(d=>({key:d.relativeKey,value:Jt(d.value),options:d.options})),u),p.driver.setItem&&await Promise.all(p.items.map(d=>oe(p.driver.setItem,d.relativeKey,Jt(d.value),d.options)))})},async setItemRaw(c,u,p={}){if(u===void 0)return l.removeItem(c,p);c=Le(c);const{relativeKey:d,driver:_}=t(c);if(_.setItemRaw)await oe(_.setItemRaw,d,u,p);else if(_.setItem)await oe(_.setItem,d,qn(u),p);else return;_.watch||s("update",c)},async removeItem(c,u={}){typeof u=="boolean"&&(u={removeMeta:u}),c=Le(c);const{relativeKey:p,driver:d}=t(c);d.removeItem&&(await oe(d.removeItem,p,u),(u.removeMeta||u.removeMata)&&await oe(d.removeItem,p+"$",u),d.watch||s("remove",c))},async getMeta(c,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),c=Le(c);const{relativeKey:p,driver:d}=t(c),_=Object.create(null);if(d.getMeta&&Object.assign(_,await oe(d.getMeta,p,u)),!u.nativeOnly){const m=await oe(d.getItem,p+"$",u).then(S=>Ht(S));m&&typeof m=="object"&&(typeof m.atime=="string"&&(m.atime=new Date(m.atime)),typeof m.mtime=="string"&&(m.mtime=new Date(m.mtime)),Object.assign(_,m))}return _},setMeta(c,u,p={}){return this.setItem(c+"$",u,p)},removeMeta(c,u={}){return this.removeItem(c+"$",u)},async getKeys(c,u={}){c=Gt(c);const p=i(c,!0);let d=[];const _=[];for(const m of p){const $=(await oe(m.driver.getKeys,m.relativeBase,u)).map(L=>m.mountpoint+Le(L)).filter(L=>!d.some(q=>L.startsWith(q)));_.push(...$),d=[m.mountpoint,...d.filter(L=>!L.startsWith(m.mountpoint))]}return c?_.filter(m=>m.startsWith(c)&&!m.endsWith("$")):_.filter(m=>!m.endsWith("$"))},async clear(c,u={}){c=Gt(c),await Promise.all(i(c,!1).map(async p=>{if(p.driver.clear)return oe(p.driver.clear,p.relativeBase,u);if(p.driver.removeItem){const d=await p.driver.getKeys(p.relativeBase||"",u);return Promise.all(d.map(_=>p.driver.removeItem(_,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>rs(c)))},async watch(c){return await n(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==c),e.watchListeners.length===0&&await a()}},async unwatch(){e.watchListeners=[],await a()},mount(c,u){if(c=Gt(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((p,d)=>d.length-p.length)),e.mounts[c]=u,e.watching&&Promise.resolve(ss(u,s,c)).then(p=>{e.unwatch[c]=p}).catch(console.error),l},async unmount(c,u=!0){c=Gt(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&(e.unwatch[c](),delete e.unwatch[c]),u&&await rs(e.mounts[c]),e.mountpoints=e.mountpoints.filter(p=>p!==c),delete e.mounts[c])},getMount(c=""){c=Le(c)+":";const u=t(c);return{driver:u.driver,base:u.base}},getMounts(c="",u={}){return c=Le(c),i(c,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))}};return l}function ss(r,e,t){return r.watch?r.watch((i,s)=>e(i,t+s)):()=>{}}async function rs(r){typeof r.dispose=="function"&&await oe(r.dispose)}function gt(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function rr(r,e){const t=indexedDB.open(r);t.onupgradeneeded=()=>t.result.createObjectStore(e);const i=gt(t);return(s,n)=>i.then(a=>n(a.transaction(e,s).objectStore(e)))}let ui;function Ut(){return ui||(ui=rr("keyval-store","keyval")),ui}function ns(r,e=Ut()){return e("readonly",t=>gt(t.get(r)))}function Kn(r,e,t=Ut()){return t("readwrite",i=>(i.put(e,r),gt(i.transaction)))}function kn(r,e=Ut()){return e("readwrite",t=>(t.delete(r),gt(t.transaction)))}function Bn(r=Ut()){return r("readwrite",e=>(e.clear(),gt(e.transaction)))}function Hn(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},gt(r.transaction)}function Gn(r=Ut()){return r("readonly",e=>{if(e.getAllKeys)return gt(e.getAllKeys());const t=[];return Hn(e,i=>t.push(i.key)).then(()=>t)})}const Wn=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),Yn=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function ti(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return Yn(r)}catch{return r}}function Vt(r){return typeof r=="string"?r:Wn(r)||""}const Jn="idb-keyval";var Qn=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let i;return r.dbName&&r.storeName&&(i=rr(r.dbName,r.storeName)),{name:Jn,options:r,async hasItem(s){return!(typeof await ns(t(s),i)>"u")},async getItem(s){return await ns(t(s),i)??null},setItem(s,n){return Kn(t(s),n,i)},removeItem(s){return kn(t(s),i)},getKeys(){return Gn(i)},clear(){return Bn(i)}}};const Xn="WALLET_CONNECT_V2_INDEXED_DB",Zn="keyvaluestorage";class eo{constructor(){this.indexedDb=Vn({driver:Qn({dbName:Xn,storeName:Zn})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Vt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}}var fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ze.global<"u"?ze.global:typeof self<"u"?self:{},Qt={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof fi<"u"&&fi.localStorage?Qt.exports=fi.localStorage:typeof window<"u"&&window.localStorage?Qt.exports=window.localStorage:Qt.exports=new e})();function to(r){var e;return[r[0],ti((e=r[1])!=null?e:"")]}class io{constructor(){this.localStorage=Qt.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(to)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return ti(t)}async setItem(e,t){this.localStorage.setItem(e,Vt(t))}async removeItem(e){this.localStorage.removeItem(e)}}const so="wc_storage_version",os=1,ro=async(r,e,t)=>{const i=so,s=await e.getItem(i);if(s&&s>=os){t(e);return}const n=await r.getKeys();if(!n.length){t(e);return}const a=[];for(;n.length;){const h=n.shift();if(!h)continue;const l=h.toLowerCase();if(l.includes("wc@")||l.includes("walletconnect")||l.includes("wc_")||l.includes("wallet_connect")){const c=await r.getItem(h);await e.setItem(h,c),a.push(h)}}await e.setItem(i,os),t(e),no(r,a)},no=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};let oo=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new io;this.storage=e;try{const t=new eo;ro(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var Pt={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Si=function(r,e){return Si=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},Si(r,e)};function ao(r,e){Si(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Pi=function(){return Pi=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Pi.apply(this,arguments)};function co(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function ho(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var h=r.length-1;h>=0;h--)(a=r[h])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function lo(r,e){return function(t,i){e(t,i,r)}}function uo(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function fo(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function h(u){try{c(i.next(u))}catch(p){a(p)}}function l(u){try{c(i.throw(u))}catch(p){a(p)}}function c(u){u.done?n(u.value):s(u.value).then(h,l)}c((i=i.apply(r,e||[])).next())})}function po(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function h(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],s=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function go(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function yo(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function Ri(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function nr(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(h){a={error:h}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return n}function mo(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(nr(arguments[e]));return r}function wo(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],a=0,h=n.length;a<h;a++,s++)i[s]=n[a];return i}function Mt(r){return this instanceof Mt?(this.v=r,this):new Mt(r)}function bo(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(d){i[d]&&(s[d]=function(_){return new Promise(function(m,S){n.push([d,_,m,S])>1||h(d,_)})})}function h(d,_){try{l(i[d](_))}catch(m){p(n[0][3],m)}}function l(d){d.value instanceof Mt?Promise.resolve(d.value.v).then(c,u):p(n[0][2],d)}function c(d){h("next",d)}function u(d){h("throw",d)}function p(d,_){d(_),n.shift(),n.length&&h(n[0][0],n[0][1])}}function vo(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(a){return(t=!t)?{value:Mt(r[s](a)),done:s==="return"}:n?n(a):a}:n}}function _o(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Ri=="function"?Ri(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(a){return new Promise(function(h,l){a=r[n](a),s(h,l,a.done,a.value)})}}function s(n,a,h,l){Promise.resolve(l).then(function(c){n({value:c,done:h})},a)}}function Eo(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function xo(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function Io(r){return r&&r.__esModule?r:{default:r}}function So(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function Po(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const Ro=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Pi},__asyncDelegator:vo,__asyncGenerator:bo,__asyncValues:_o,__await:Mt,__awaiter:fo,__classPrivateFieldGet:So,__classPrivateFieldSet:Po,__createBinding:go,__decorate:ho,__exportStar:yo,__extends:ao,__generator:po,__importDefault:Io,__importStar:xo,__makeTemplateObject:Eo,__metadata:uo,__param:lo,__read:nr,__rest:co,__spread:mo,__spreadArrays:wo,__values:Ri},Symbol.toStringTag,{value:"Module"})),ii=Zt(Ro);var Nt={},di={},Tt={};let yt=class{};const Oo=Object.freeze(Object.defineProperty({__proto__:null,IEvents:yt},Symbol.toStringTag,{value:"Module"})),No=Zt(Oo);var as;function To(){if(as)return Tt;as=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.IHeartBeat=void 0;const r=No;class e extends r.IEvents{constructor(i){super()}}return Tt.IHeartBeat=e,Tt}var cs;function or(){return cs||(cs=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),ii.__exportStar(To(),r)}(di)),di}var pi={},dt={},hs;function Ao(){if(hs)return dt;hs=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.HEARTBEAT_EVENTS=dt.HEARTBEAT_INTERVAL=void 0;const r=C;return dt.HEARTBEAT_INTERVAL=r.FIVE_SECONDS,dt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},dt}var ls;function ar(){return ls||(ls=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),ii.__exportStar(Ao(),r)}(pi)),pi}var us;function Co(){if(us)return Nt;us=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.HeartBeat=void 0;const r=ii,e=Qe,t=C,i=or(),s=ar();class n extends i.IHeartBeat{constructor(h){super(h),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(h==null?void 0:h.interval)||s.HEARTBEAT_INTERVAL}static init(h){return r.__awaiter(this,void 0,void 0,function*(){const l=new n(h);return yield l.init(),l})}init(){return r.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(h,l){this.events.on(h,l)}once(h,l){this.events.once(h,l)}off(h,l){this.events.off(h,l)}removeListener(h,l){this.events.removeListener(h,l)}initialize(){return r.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return Nt.HeartBeat=n,Nt}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=ii;e.__exportStar(Co(),r),e.__exportStar(or(),r),e.__exportStar(ar(),r)})(Pt);var j={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Oi=function(r,e){return Oi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},Oi(r,e)};function Fo(r,e){Oi(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ni=function(){return Ni=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Ni.apply(this,arguments)};function Do(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function $o(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var h=r.length-1;h>=0;h--)(a=r[h])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function Lo(r,e){return function(t,i){e(t,i,r)}}function qo(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function Mo(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function h(u){try{c(i.next(u))}catch(p){a(p)}}function l(u){try{c(i.throw(u))}catch(p){a(p)}}function c(u){u.done?n(u.value):s(u.value).then(h,l)}c((i=i.apply(r,e||[])).next())})}function zo(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function h(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],s=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function jo(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function Uo(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function Ti(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function cr(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(h){a={error:h}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return n}function Vo(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(cr(arguments[e]));return r}function Ko(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],a=0,h=n.length;a<h;a++,s++)i[s]=n[a];return i}function zt(r){return this instanceof zt?(this.v=r,this):new zt(r)}function ko(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(d){i[d]&&(s[d]=function(_){return new Promise(function(m,S){n.push([d,_,m,S])>1||h(d,_)})})}function h(d,_){try{l(i[d](_))}catch(m){p(n[0][3],m)}}function l(d){d.value instanceof zt?Promise.resolve(d.value.v).then(c,u):p(n[0][2],d)}function c(d){h("next",d)}function u(d){h("throw",d)}function p(d,_){d(_),n.shift(),n.length&&h(n[0][0],n[0][1])}}function Bo(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(a){return(t=!t)?{value:zt(r[s](a)),done:s==="return"}:n?n(a):a}:n}}function Ho(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Ti=="function"?Ti(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(a){return new Promise(function(h,l){a=r[n](a),s(h,l,a.done,a.value)})}}function s(n,a,h,l){Promise.resolve(l).then(function(c){n({value:c,done:h})},a)}}function Go(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function Wo(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function Yo(r){return r&&r.__esModule?r:{default:r}}function Jo(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function Qo(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const Xo=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ni},__asyncDelegator:Bo,__asyncGenerator:ko,__asyncValues:Ho,__await:zt,__awaiter:Mo,__classPrivateFieldGet:Jo,__classPrivateFieldSet:Qo,__createBinding:jo,__decorate:$o,__exportStar:Uo,__extends:Fo,__generator:zo,__importDefault:Yo,__importStar:Wo,__makeTemplateObject:Go,__metadata:qo,__param:Lo,__read:cr,__rest:Do,__spread:Vo,__spreadArrays:Ko,__values:Ti},Symbol.toStringTag,{value:"Module"})),Zo=Zt(Xo);var gi,fs;function ea(){if(fs)return gi;fs=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}gi=e;function e(t,i,s){var n=s&&s.stringify||r,a=1;if(typeof t=="object"&&t!==null){var h=i.length+a;if(h===1)return t;var l=new Array(h);l[0]=n(t);for(var c=1;c<h;c++)l[c]=n(i[c]);return l.join(" ")}if(typeof t!="string")return t;var u=i.length;if(u===0)return t;for(var p="",d=1-a,_=-1,m=t&&t.length||0,S=0;S<m;){if(t.charCodeAt(S)===37&&S+1<m){switch(_=_>-1?_:0,t.charCodeAt(S+1)){case 100:case 102:if(d>=u||i[d]==null)break;_<S&&(p+=t.slice(_,S)),p+=Number(i[d]),_=S+2,S++;break;case 105:if(d>=u||i[d]==null)break;_<S&&(p+=t.slice(_,S)),p+=Math.floor(Number(i[d])),_=S+2,S++;break;case 79:case 111:case 106:if(d>=u||i[d]===void 0)break;_<S&&(p+=t.slice(_,S));var $=typeof i[d];if($==="string"){p+="'"+i[d]+"'",_=S+2,S++;break}if($==="function"){p+=i[d].name||"<anonymous>",_=S+2,S++;break}p+=n(i[d]),_=S+2,S++;break;case 115:if(d>=u)break;_<S&&(p+=t.slice(_,S)),p+=String(i[d]),_=S+2,S++;break;case 37:_<S&&(p+=t.slice(_,S)),p+="%",_=S+2,S++,d--;break}++d}++S}return _===-1?t:(_<m&&(p+=t.slice(_)),p)}return gi}var yi,ds;function ta(){if(ds)return yi;ds=1;const r=ea();yi=s;const e=K().console||{},t={mapHttpRequest:m,mapHttpResponse:m,wrapRequestSerializer:S,wrapResponseSerializer:S,wrapErrorSerializer:S,req:m,res:m,err:d};function i(v,x){return Array.isArray(v)?v.filter(function(M){return M!=="!stdSerializers.err"}):v===!0?Object.keys(x):!1}function s(v){v=v||{},v.browser=v.browser||{};const x=v.browser.transmit;if(x&&typeof x.send!="function")throw Error("pino: transmit option must have a send function");const O=v.browser.write||e;v.browser.write&&(v.browser.asObject=!0);const M=v.serializers||{},F=i(v.browser.serialize,M);let U=v.browser.serialize;Array.isArray(v.browser.serialize)&&v.browser.serialize.indexOf("!stdSerializers.err")>-1&&(U=!1);const B=["error","fatal","warn","info","debug","trace"];typeof O=="function"&&(O.error=O.fatal=O.warn=O.info=O.debug=O.trace=O),v.enabled===!1&&(v.level="silent");const ee=v.level||"info",y=Object.create(O);y.log||(y.log=$),Object.defineProperty(y,"levelVal",{get:G}),Object.defineProperty(y,"level",{get:Q,set:T});const E={transmit:x,serialize:F,asObject:v.browser.asObject,levels:B,timestamp:_(v)};y.levels=s.levels,y.level=ee,y.setMaxListeners=y.getMaxListeners=y.emit=y.addListener=y.on=y.prependListener=y.once=y.prependOnceListener=y.removeListener=y.removeAllListeners=y.listeners=y.listenerCount=y.eventNames=y.write=y.flush=$,y.serializers=M,y._serialize=F,y._stdErrSerialize=U,y.child=P,x&&(y._logEvent=p());function G(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Q(){return this._level}function T(I){if(I!=="silent"&&!this.levels.values[I])throw Error("unknown level "+I);this._level=I,n(E,y,"error","log"),n(E,y,"fatal","error"),n(E,y,"warn","error"),n(E,y,"info","log"),n(E,y,"debug","log"),n(E,y,"trace","log")}function P(I,N){if(!I)throw new Error("missing bindings for child Pino");N=N||{},F&&I.serializers&&(N.serializers=I.serializers);const re=N.serializers;if(F&&re){var J=Object.assign({},M,re),mt=v.browser.serialize===!0?Object.keys(J):F;delete I.serializers,l([I],mt,J,this._stdErrSerialize)}function wt(je){this._childLevel=(je._childLevel|0)+1,this.error=c(je,I,"error"),this.fatal=c(je,I,"fatal"),this.warn=c(je,I,"warn"),this.info=c(je,I,"info"),this.debug=c(je,I,"debug"),this.trace=c(je,I,"trace"),J&&(this.serializers=J,this._serialize=mt),x&&(this._logEvent=p([].concat(je._logEvent.bindings,I)))}return wt.prototype=this,new wt(this)}return y}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:L,epochTime:q,unixTime:V,isoTime:z});function n(v,x,O,M){const F=Object.getPrototypeOf(x);x[O]=x.levelVal>x.levels.values[O]?$:F[O]?F[O]:e[O]||e[M]||$,a(v,x,O)}function a(v,x,O){!v.transmit&&x[O]===$||(x[O]=function(M){return function(){const U=v.timestamp(),B=new Array(arguments.length),ee=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var y=0;y<B.length;y++)B[y]=arguments[y];if(v.serialize&&!v.asObject&&l(B,this._serialize,this.serializers,this._stdErrSerialize),v.asObject?M.call(ee,h(this,O,B,U)):M.apply(ee,B),v.transmit){const E=v.transmit.level||x.level,G=s.levels.values[E],Q=s.levels.values[O];if(Q<G)return;u(this,{ts:U,methodLevel:O,methodValue:Q,transmitLevel:E,transmitValue:s.levels.values[v.transmit.level||x.level],send:v.transmit.send,val:x.levelVal},B)}}}(x[O]))}function h(v,x,O,M){v._serialize&&l(O,v._serialize,v.serializers,v._stdErrSerialize);const F=O.slice();let U=F[0];const B={};M&&(B.time=M),B.level=s.levels.values[x];let ee=(v._childLevel|0)+1;if(ee<1&&(ee=1),U!==null&&typeof U=="object"){for(;ee--&&typeof F[0]=="object";)Object.assign(B,F.shift());U=F.length?r(F.shift(),F):void 0}else typeof U=="string"&&(U=r(F.shift(),F));return U!==void 0&&(B.msg=U),B}function l(v,x,O,M){for(const F in v)if(M&&v[F]instanceof Error)v[F]=s.stdSerializers.err(v[F]);else if(typeof v[F]=="object"&&!Array.isArray(v[F]))for(const U in v[F])x&&x.indexOf(U)>-1&&U in O&&(v[F][U]=O[U](v[F][U]))}function c(v,x,O){return function(){const M=new Array(1+arguments.length);M[0]=x;for(var F=1;F<M.length;F++)M[F]=arguments[F-1];return v[O].apply(this,M)}}function u(v,x,O){const M=x.send,F=x.ts,U=x.methodLevel,B=x.methodValue,ee=x.val,y=v._logEvent.bindings;l(O,v._serialize||Object.keys(v.serializers),v.serializers,v._stdErrSerialize===void 0?!0:v._stdErrSerialize),v._logEvent.ts=F,v._logEvent.messages=O.filter(function(E){return y.indexOf(E)===-1}),v._logEvent.level.label=U,v._logEvent.level.value=B,M(U,v._logEvent,ee),v._logEvent=p(y)}function p(v){return{ts:0,messages:[],bindings:v||[],level:{label:"",value:0}}}function d(v){const x={type:v.constructor.name,msg:v.message,stack:v.stack};for(const O in v)x[O]===void 0&&(x[O]=v[O]);return x}function _(v){return typeof v.timestamp=="function"?v.timestamp:v.timestamp===!1?L:q}function m(){return{}}function S(v){return v}function $(){}function L(){return!1}function q(){return Date.now()}function V(){return Math.round(Date.now()/1e3)}function z(){return new Date(Date.now()).toISOString()}function K(){function v(x){return typeof x<"u"&&x}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return v(self)||v(window)||v(this)||{}}}return yi}var pt={},ps;function hr(){return ps||(ps=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.PINO_CUSTOM_CONTEXT_KEY=pt.PINO_LOGGER_DEFAULTS=void 0,pt.PINO_LOGGER_DEFAULTS={level:"info"},pt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),pt}var Ce={},gs;function ia(){if(gs)return Ce;gs=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.generateChildLogger=Ce.formatChildLoggerContext=Ce.getLoggerContext=Ce.setBrowserLoggerContext=Ce.getBrowserLoggerContext=Ce.getDefaultLoggerOptions=void 0;const r=hr();function e(h){return Object.assign(Object.assign({},h),{level:(h==null?void 0:h.level)||r.PINO_LOGGER_DEFAULTS.level})}Ce.getDefaultLoggerOptions=e;function t(h,l=r.PINO_CUSTOM_CONTEXT_KEY){return h[l]||""}Ce.getBrowserLoggerContext=t;function i(h,l,c=r.PINO_CUSTOM_CONTEXT_KEY){return h[c]=l,h}Ce.setBrowserLoggerContext=i;function s(h,l=r.PINO_CUSTOM_CONTEXT_KEY){let c="";return typeof h.bindings>"u"?c=t(h,l):c=h.bindings().context||"",c}Ce.getLoggerContext=s;function n(h,l,c=r.PINO_CUSTOM_CONTEXT_KEY){const u=s(h,c);return u.trim()?`${u}/${l}`:l}Ce.formatChildLoggerContext=n;function a(h,l,c=r.PINO_CUSTOM_CONTEXT_KEY){const u=n(h,l,c),p=h.child({context:u});return i(p,u,c)}return Ce.generateChildLogger=a,Ce}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.pino=void 0;const e=Zo,t=e.__importDefault(ta());Object.defineProperty(r,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(hr(),r),e.__exportStar(ia(),r)})(j);class sa extends yt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let ra=class extends yt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},na=class{constructor(e,t){this.logger=e,this.core=t}};class oa extends yt{constructor(e,t){super(),this.relayer=e,this.logger=t}}let aa=class extends yt{constructor(e){super()}};class ca{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}}class ha extends yt{constructor(e,t){super(),this.relayer=e,this.logger=t}}class la extends yt{constructor(e,t){super(),this.core=e,this.logger=t}}class ua{constructor(e,t){this.projectId=e,this.logger=t}}let fa=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},da=class{constructor(e){this.client=e}};var Mi={},lr={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Ur,t=Ys;r.DIGEST_LENGTH=64,r.BLOCK_SIZE=128;var i=function(){function h(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return h.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},h.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},h.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},h.prototype.update=function(l,c){if(c===void 0&&(c=l.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var u=0;if(this._bytesHashed+=c,this._bufferLength>0){for(;this._bufferLength<r.BLOCK_SIZE&&c>0;)this._buffer[this._bufferLength++]=l[u++],c--;this._bufferLength===this.blockSize&&(n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(c>=this.blockSize&&(u=n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,l,u,c),c%=this.blockSize);c>0;)this._buffer[this._bufferLength++]=l[u++],c--;return this},h.prototype.finish=function(l){if(!this._finished){var c=this._bytesHashed,u=this._bufferLength,p=c/536870912|0,d=c<<3,_=c%128<112?128:256;this._buffer[u]=128;for(var m=u+1;m<_-8;m++)this._buffer[m]=0;e.writeUint32BE(p,this._buffer,_-8),e.writeUint32BE(d,this._buffer,_-4),n(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,_),this._finished=!0}for(var m=0;m<this.digestLength/8;m++)e.writeUint32BE(this._stateHi[m],l,m*8),e.writeUint32BE(this._stateLo[m],l,m*8+4);return this},h.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},h.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},h.prototype.restoreState=function(l){return this._stateHi.set(l.stateHi),this._stateLo.set(l.stateLo),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},h.prototype.cleanSavedState=function(l){t.wipe(l.stateHi),t.wipe(l.stateLo),l.buffer&&t.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},h}();r.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function n(h,l,c,u,p,d,_){for(var m=c[0],S=c[1],$=c[2],L=c[3],q=c[4],V=c[5],z=c[6],K=c[7],v=u[0],x=u[1],O=u[2],M=u[3],F=u[4],U=u[5],B=u[6],ee=u[7],y,E,G,Q,T,P,I,N;_>=128;){for(var re=0;re<16;re++){var J=8*re+d;h[re]=e.readUint32BE(p,J),l[re]=e.readUint32BE(p,J+4)}for(var re=0;re<80;re++){var mt=m,wt=S,je=$,w=L,b=q,g=V,o=z,f=K,A=v,D=x,H=O,W=M,k=F,Y=U,Ne=B,ae=ee;if(y=K,E=ee,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=(q>>>14|F<<32-14)^(q>>>18|F<<32-18)^(F>>>41-32|q<<32-(41-32)),E=(F>>>14|q<<32-14)^(F>>>18|q<<32-18)^(q>>>41-32|F<<32-(41-32)),T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,y=q&V^~q&z,E=F&U^~F&B,T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,y=s[re*2],E=s[re*2+1],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,y=h[re%16],E=l[re%16],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,G=I&65535|N<<16,Q=T&65535|P<<16,y=G,E=Q,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=(m>>>28|v<<32-28)^(v>>>34-32|m<<32-(34-32))^(v>>>39-32|m<<32-(39-32)),E=(v>>>28|m<<32-28)^(m>>>34-32|v<<32-(34-32))^(m>>>39-32|v<<32-(39-32)),T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,y=m&S^m&$^S&$,E=v&x^v&O^x&O,T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,f=I&65535|N<<16,ae=T&65535|P<<16,y=w,E=W,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=G,E=Q,T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,w=I&65535|N<<16,W=T&65535|P<<16,S=mt,$=wt,L=je,q=w,V=b,z=g,K=o,m=f,x=A,O=D,M=H,F=W,U=k,B=Y,ee=Ne,v=ae,re%16===15)for(var J=0;J<16;J++)y=h[J],E=l[J],T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=h[(J+9)%16],E=l[(J+9)%16],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,G=h[(J+1)%16],Q=l[(J+1)%16],y=(G>>>1|Q<<32-1)^(G>>>8|Q<<32-8)^G>>>7,E=(Q>>>1|G<<32-1)^(Q>>>8|G<<32-8)^(Q>>>7|G<<32-7),T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,G=h[(J+14)%16],Q=l[(J+14)%16],y=(G>>>19|Q<<32-19)^(Q>>>61-32|G<<32-(61-32))^G>>>6,E=(Q>>>19|G<<32-19)^(G>>>61-32|Q<<32-(61-32))^(Q>>>6|G<<32-6),T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,h[J]=I&65535|N<<16,l[J]=T&65535|P<<16}y=m,E=v,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[0],E=u[0],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[0]=m=I&65535|N<<16,u[0]=v=T&65535|P<<16,y=S,E=x,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[1],E=u[1],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[1]=S=I&65535|N<<16,u[1]=x=T&65535|P<<16,y=$,E=O,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[2],E=u[2],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[2]=$=I&65535|N<<16,u[2]=O=T&65535|P<<16,y=L,E=M,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[3],E=u[3],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[3]=L=I&65535|N<<16,u[3]=M=T&65535|P<<16,y=q,E=F,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[4],E=u[4],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[4]=q=I&65535|N<<16,u[4]=F=T&65535|P<<16,y=V,E=U,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[5],E=u[5],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[5]=V=I&65535|N<<16,u[5]=U=T&65535|P<<16,y=z,E=B,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[6],E=u[6],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[6]=z=I&65535|N<<16,u[6]=B=T&65535|P<<16,y=K,E=ee,T=E&65535,P=E>>>16,I=y&65535,N=y>>>16,y=c[7],E=u[7],T+=E&65535,P+=E>>>16,I+=y&65535,N+=y>>>16,P+=T>>>16,I+=P>>>16,N+=I>>>16,c[7]=K=I&65535|N<<16,u[7]=ee=T&65535|P<<16,d+=128,_-=128}return d}function a(h){var l=new i;l.update(h);var c=l.digest();return l.clean(),c}r.hash=a})(lr);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convertSecretKeyToX25519=r.convertPublicKeyToX25519=r.verify=r.sign=r.extractPublicKeyFromSecretKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.SEED_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=r.SIGNATURE_LENGTH=void 0;const e=Js,t=lr,i=Ys;r.SIGNATURE_LENGTH=64,r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=64,r.SEED_LENGTH=32;function s(w){const b=new Float64Array(16);if(w)for(let g=0;g<w.length;g++)b[g]=w[g];return b}const n=new Uint8Array(32);n[0]=9;const a=s(),h=s([1]),l=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),c=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),u=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),p=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),d=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function _(w,b){for(let g=0;g<16;g++)w[g]=b[g]|0}function m(w){let b=1;for(let g=0;g<16;g++){let o=w[g]+b+65535;b=Math.floor(o/65536),w[g]=o-b*65536}w[0]+=b-1+37*(b-1)}function S(w,b,g){const o=~(g-1);for(let f=0;f<16;f++){const A=o&(w[f]^b[f]);w[f]^=A,b[f]^=A}}function $(w,b){const g=s(),o=s();for(let f=0;f<16;f++)o[f]=b[f];m(o),m(o),m(o);for(let f=0;f<2;f++){g[0]=o[0]-65517;for(let D=1;D<15;D++)g[D]=o[D]-65535-(g[D-1]>>16&1),g[D-1]&=65535;g[15]=o[15]-32767-(g[14]>>16&1);const A=g[15]>>16&1;g[14]&=65535,S(o,g,1-A)}for(let f=0;f<16;f++)w[2*f]=o[f]&255,w[2*f+1]=o[f]>>8}function L(w,b){let g=0;for(let o=0;o<32;o++)g|=w[o]^b[o];return(1&g-1>>>8)-1}function q(w,b){const g=new Uint8Array(32),o=new Uint8Array(32);return $(g,w),$(o,b),L(g,o)}function V(w){const b=new Uint8Array(32);return $(b,w),b[0]&1}function z(w,b){for(let g=0;g<16;g++)w[g]=b[2*g]+(b[2*g+1]<<8);w[15]&=32767}function K(w,b,g){for(let o=0;o<16;o++)w[o]=b[o]+g[o]}function v(w,b,g){for(let o=0;o<16;o++)w[o]=b[o]-g[o]}function x(w,b,g){let o,f,A=0,D=0,H=0,W=0,k=0,Y=0,Ne=0,ae=0,Te=0,le=0,ce=0,ne=0,se=0,te=0,X=0,Z=0,ue=0,Ae=0,De=0,Me=0,Ue=0,Ke=0,We=0,Xe=0,at=0,ft=0,bt=0,Rt=0,kt=0,oi=0,Wi=0,fe=g[0],de=g[1],pe=g[2],ge=g[3],ye=g[4],me=g[5],we=g[6],be=g[7],ve=g[8],_e=g[9],Ee=g[10],xe=g[11],Ie=g[12],Se=g[13],Pe=g[14],Re=g[15];o=b[0],A+=o*fe,D+=o*de,H+=o*pe,W+=o*ge,k+=o*ye,Y+=o*me,Ne+=o*we,ae+=o*be,Te+=o*ve,le+=o*_e,ce+=o*Ee,ne+=o*xe,se+=o*Ie,te+=o*Se,X+=o*Pe,Z+=o*Re,o=b[1],D+=o*fe,H+=o*de,W+=o*pe,k+=o*ge,Y+=o*ye,Ne+=o*me,ae+=o*we,Te+=o*be,le+=o*ve,ce+=o*_e,ne+=o*Ee,se+=o*xe,te+=o*Ie,X+=o*Se,Z+=o*Pe,ue+=o*Re,o=b[2],H+=o*fe,W+=o*de,k+=o*pe,Y+=o*ge,Ne+=o*ye,ae+=o*me,Te+=o*we,le+=o*be,ce+=o*ve,ne+=o*_e,se+=o*Ee,te+=o*xe,X+=o*Ie,Z+=o*Se,ue+=o*Pe,Ae+=o*Re,o=b[3],W+=o*fe,k+=o*de,Y+=o*pe,Ne+=o*ge,ae+=o*ye,Te+=o*me,le+=o*we,ce+=o*be,ne+=o*ve,se+=o*_e,te+=o*Ee,X+=o*xe,Z+=o*Ie,ue+=o*Se,Ae+=o*Pe,De+=o*Re,o=b[4],k+=o*fe,Y+=o*de,Ne+=o*pe,ae+=o*ge,Te+=o*ye,le+=o*me,ce+=o*we,ne+=o*be,se+=o*ve,te+=o*_e,X+=o*Ee,Z+=o*xe,ue+=o*Ie,Ae+=o*Se,De+=o*Pe,Me+=o*Re,o=b[5],Y+=o*fe,Ne+=o*de,ae+=o*pe,Te+=o*ge,le+=o*ye,ce+=o*me,ne+=o*we,se+=o*be,te+=o*ve,X+=o*_e,Z+=o*Ee,ue+=o*xe,Ae+=o*Ie,De+=o*Se,Me+=o*Pe,Ue+=o*Re,o=b[6],Ne+=o*fe,ae+=o*de,Te+=o*pe,le+=o*ge,ce+=o*ye,ne+=o*me,se+=o*we,te+=o*be,X+=o*ve,Z+=o*_e,ue+=o*Ee,Ae+=o*xe,De+=o*Ie,Me+=o*Se,Ue+=o*Pe,Ke+=o*Re,o=b[7],ae+=o*fe,Te+=o*de,le+=o*pe,ce+=o*ge,ne+=o*ye,se+=o*me,te+=o*we,X+=o*be,Z+=o*ve,ue+=o*_e,Ae+=o*Ee,De+=o*xe,Me+=o*Ie,Ue+=o*Se,Ke+=o*Pe,We+=o*Re,o=b[8],Te+=o*fe,le+=o*de,ce+=o*pe,ne+=o*ge,se+=o*ye,te+=o*me,X+=o*we,Z+=o*be,ue+=o*ve,Ae+=o*_e,De+=o*Ee,Me+=o*xe,Ue+=o*Ie,Ke+=o*Se,We+=o*Pe,Xe+=o*Re,o=b[9],le+=o*fe,ce+=o*de,ne+=o*pe,se+=o*ge,te+=o*ye,X+=o*me,Z+=o*we,ue+=o*be,Ae+=o*ve,De+=o*_e,Me+=o*Ee,Ue+=o*xe,Ke+=o*Ie,We+=o*Se,Xe+=o*Pe,at+=o*Re,o=b[10],ce+=o*fe,ne+=o*de,se+=o*pe,te+=o*ge,X+=o*ye,Z+=o*me,ue+=o*we,Ae+=o*be,De+=o*ve,Me+=o*_e,Ue+=o*Ee,Ke+=o*xe,We+=o*Ie,Xe+=o*Se,at+=o*Pe,ft+=o*Re,o=b[11],ne+=o*fe,se+=o*de,te+=o*pe,X+=o*ge,Z+=o*ye,ue+=o*me,Ae+=o*we,De+=o*be,Me+=o*ve,Ue+=o*_e,Ke+=o*Ee,We+=o*xe,Xe+=o*Ie,at+=o*Se,ft+=o*Pe,bt+=o*Re,o=b[12],se+=o*fe,te+=o*de,X+=o*pe,Z+=o*ge,ue+=o*ye,Ae+=o*me,De+=o*we,Me+=o*be,Ue+=o*ve,Ke+=o*_e,We+=o*Ee,Xe+=o*xe,at+=o*Ie,ft+=o*Se,bt+=o*Pe,Rt+=o*Re,o=b[13],te+=o*fe,X+=o*de,Z+=o*pe,ue+=o*ge,Ae+=o*ye,De+=o*me,Me+=o*we,Ue+=o*be,Ke+=o*ve,We+=o*_e,Xe+=o*Ee,at+=o*xe,ft+=o*Ie,bt+=o*Se,Rt+=o*Pe,kt+=o*Re,o=b[14],X+=o*fe,Z+=o*de,ue+=o*pe,Ae+=o*ge,De+=o*ye,Me+=o*me,Ue+=o*we,Ke+=o*be,We+=o*ve,Xe+=o*_e,at+=o*Ee,ft+=o*xe,bt+=o*Ie,Rt+=o*Se,kt+=o*Pe,oi+=o*Re,o=b[15],Z+=o*fe,ue+=o*de,Ae+=o*pe,De+=o*ge,Me+=o*ye,Ue+=o*me,Ke+=o*we,We+=o*be,Xe+=o*ve,at+=o*_e,ft+=o*Ee,bt+=o*xe,Rt+=o*Ie,kt+=o*Se,oi+=o*Pe,Wi+=o*Re,A+=38*ue,D+=38*Ae,H+=38*De,W+=38*Me,k+=38*Ue,Y+=38*Ke,Ne+=38*We,ae+=38*Xe,Te+=38*at,le+=38*ft,ce+=38*bt,ne+=38*Rt,se+=38*kt,te+=38*oi,X+=38*Wi,f=1,o=A+f+65535,f=Math.floor(o/65536),A=o-f*65536,o=D+f+65535,f=Math.floor(o/65536),D=o-f*65536,o=H+f+65535,f=Math.floor(o/65536),H=o-f*65536,o=W+f+65535,f=Math.floor(o/65536),W=o-f*65536,o=k+f+65535,f=Math.floor(o/65536),k=o-f*65536,o=Y+f+65535,f=Math.floor(o/65536),Y=o-f*65536,o=Ne+f+65535,f=Math.floor(o/65536),Ne=o-f*65536,o=ae+f+65535,f=Math.floor(o/65536),ae=o-f*65536,o=Te+f+65535,f=Math.floor(o/65536),Te=o-f*65536,o=le+f+65535,f=Math.floor(o/65536),le=o-f*65536,o=ce+f+65535,f=Math.floor(o/65536),ce=o-f*65536,o=ne+f+65535,f=Math.floor(o/65536),ne=o-f*65536,o=se+f+65535,f=Math.floor(o/65536),se=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=X+f+65535,f=Math.floor(o/65536),X=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,A+=f-1+37*(f-1),f=1,o=A+f+65535,f=Math.floor(o/65536),A=o-f*65536,o=D+f+65535,f=Math.floor(o/65536),D=o-f*65536,o=H+f+65535,f=Math.floor(o/65536),H=o-f*65536,o=W+f+65535,f=Math.floor(o/65536),W=o-f*65536,o=k+f+65535,f=Math.floor(o/65536),k=o-f*65536,o=Y+f+65535,f=Math.floor(o/65536),Y=o-f*65536,o=Ne+f+65535,f=Math.floor(o/65536),Ne=o-f*65536,o=ae+f+65535,f=Math.floor(o/65536),ae=o-f*65536,o=Te+f+65535,f=Math.floor(o/65536),Te=o-f*65536,o=le+f+65535,f=Math.floor(o/65536),le=o-f*65536,o=ce+f+65535,f=Math.floor(o/65536),ce=o-f*65536,o=ne+f+65535,f=Math.floor(o/65536),ne=o-f*65536,o=se+f+65535,f=Math.floor(o/65536),se=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=X+f+65535,f=Math.floor(o/65536),X=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,A+=f-1+37*(f-1),w[0]=A,w[1]=D,w[2]=H,w[3]=W,w[4]=k,w[5]=Y,w[6]=Ne,w[7]=ae,w[8]=Te,w[9]=le,w[10]=ce,w[11]=ne,w[12]=se,w[13]=te,w[14]=X,w[15]=Z}function O(w,b){x(w,b,b)}function M(w,b){const g=s();let o;for(o=0;o<16;o++)g[o]=b[o];for(o=253;o>=0;o--)O(g,g),o!==2&&o!==4&&x(g,g,b);for(o=0;o<16;o++)w[o]=g[o]}function F(w,b){const g=s();let o;for(o=0;o<16;o++)g[o]=b[o];for(o=250;o>=0;o--)O(g,g),o!==1&&x(g,g,b);for(o=0;o<16;o++)w[o]=g[o]}function U(w,b){const g=s(),o=s(),f=s(),A=s(),D=s(),H=s(),W=s(),k=s(),Y=s();v(g,w[1],w[0]),v(Y,b[1],b[0]),x(g,g,Y),K(o,w[0],w[1]),K(Y,b[0],b[1]),x(o,o,Y),x(f,w[3],b[3]),x(f,f,c),x(A,w[2],b[2]),K(A,A,A),v(D,o,g),v(H,A,f),K(W,A,f),K(k,o,g),x(w[0],D,H),x(w[1],k,W),x(w[2],W,H),x(w[3],D,k)}function B(w,b,g){for(let o=0;o<4;o++)S(w[o],b[o],g)}function ee(w,b){const g=s(),o=s(),f=s();M(f,b[2]),x(g,b[0],f),x(o,b[1],f),$(w,o),w[31]^=V(g)<<7}function y(w,b,g){_(w[0],a),_(w[1],h),_(w[2],h),_(w[3],a);for(let o=255;o>=0;--o){const f=g[o/8|0]>>(o&7)&1;B(w,b,f),U(b,w),U(w,w),B(w,b,f)}}function E(w,b){const g=[s(),s(),s(),s()];_(g[0],u),_(g[1],p),_(g[2],h),x(g[3],u,p),y(w,g,b)}function G(w){if(w.length!==r.SEED_LENGTH)throw new Error(`ed25519: seed must be ${r.SEED_LENGTH} bytes`);const b=(0,t.hash)(w);b[0]&=248,b[31]&=127,b[31]|=64;const g=new Uint8Array(32),o=[s(),s(),s(),s()];E(o,b),ee(g,o);const f=new Uint8Array(64);return f.set(w),f.set(g,32),{publicKey:g,secretKey:f}}r.generateKeyPairFromSeed=G;function Q(w){const b=(0,e.randomBytes)(32,w),g=G(b);return(0,i.wipe)(b),g}r.generateKeyPair=Q;function T(w){if(w.length!==r.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${r.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(w.subarray(32))}r.extractPublicKeyFromSecretKey=T;const P=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function I(w,b){let g,o,f,A;for(o=63;o>=32;--o){for(g=0,f=o-32,A=o-12;f<A;++f)b[f]+=g-16*b[o]*P[f-(o-32)],g=Math.floor((b[f]+128)/256),b[f]-=g*256;b[f]+=g,b[o]=0}for(g=0,f=0;f<32;f++)b[f]+=g-(b[31]>>4)*P[f],g=b[f]>>8,b[f]&=255;for(f=0;f<32;f++)b[f]-=g*P[f];for(o=0;o<32;o++)b[o+1]+=b[o]>>8,w[o]=b[o]&255}function N(w){const b=new Float64Array(64);for(let g=0;g<64;g++)b[g]=w[g];for(let g=0;g<64;g++)w[g]=0;I(w,b)}function re(w,b){const g=new Float64Array(64),o=[s(),s(),s(),s()],f=(0,t.hash)(w.subarray(0,32));f[0]&=248,f[31]&=127,f[31]|=64;const A=new Uint8Array(64);A.set(f.subarray(32),32);const D=new t.SHA512;D.update(A.subarray(32)),D.update(b);const H=D.digest();D.clean(),N(H),E(o,H),ee(A,o),D.reset(),D.update(A.subarray(0,32)),D.update(w.subarray(32)),D.update(b);const W=D.digest();N(W);for(let k=0;k<32;k++)g[k]=H[k];for(let k=0;k<32;k++)for(let Y=0;Y<32;Y++)g[k+Y]+=W[k]*f[Y];return I(A.subarray(32),g),A}r.sign=re;function J(w,b){const g=s(),o=s(),f=s(),A=s(),D=s(),H=s(),W=s();return _(w[2],h),z(w[1],b),O(f,w[1]),x(A,f,l),v(f,f,w[2]),K(A,w[2],A),O(D,A),O(H,D),x(W,H,D),x(g,W,f),x(g,g,A),F(g,g),x(g,g,f),x(g,g,A),x(g,g,A),x(w[0],g,A),O(o,w[0]),x(o,o,A),q(o,f)&&x(w[0],w[0],d),O(o,w[0]),x(o,o,A),q(o,f)?-1:(V(w[0])===b[31]>>7&&v(w[0],a,w[0]),x(w[3],w[0],w[1]),0)}function mt(w,b,g){const o=new Uint8Array(32),f=[s(),s(),s(),s()],A=[s(),s(),s(),s()];if(g.length!==r.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${r.SIGNATURE_LENGTH} bytes`);if(J(A,w))return!1;const D=new t.SHA512;D.update(g.subarray(0,32)),D.update(w),D.update(b);const H=D.digest();return N(H),y(f,A,H),E(A,g.subarray(32)),U(f,A),ee(o,f),!L(g,o)}r.verify=mt;function wt(w){let b=[s(),s(),s(),s()];if(J(b,w))throw new Error("Ed25519: invalid public key");let g=s(),o=s(),f=b[1];K(g,h,f),v(o,h,f),M(o,o),x(g,g,o);let A=new Uint8Array(32);return $(A,g),A}r.convertPublicKeyToX25519=wt;function je(w){const b=(0,t.hash)(w.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const g=new Uint8Array(b.subarray(0,32));return(0,i.wipe)(b),g}r.convertSecretKeyToX25519=je})(Mi);const pa="EdDSA",ga="JWT",ur=".",fr="base64url",ya="utf8",ma="utf8",wa=":",ba="did",va="key",ys="base58btc",_a="z",Ea="K36",xa=32;function Xt(r){return ei(qi(Vt(r),ya),fr)}function dr(r){const e=qi(Ea,ys),t=_a+ei(Vr([e,r]),ys);return[ba,va,t].join(wa)}function Ia(r){return ei(r,fr)}function Sa(r){return qi([Xt(r.header),Xt(r.payload)].join(ur),ma)}function Pa(r){return[Xt(r.header),Xt(r.payload),Ia(r.signature)].join(ur)}function ms(r=Js.randomBytes(xa)){return Mi.generateKeyPairFromSeed(r)}async function Ra(r,e,t,i,s=C.fromMiliseconds(Date.now())){const n={alg:pa,typ:ga},a=dr(i.publicKey),h=s+t,l={iss:a,sub:r,aud:e,iat:s,exp:h},c=Sa({header:n,payload:l}),u=Mi.sign(i.secretKey,c);return Pa({header:n,payload:l,signature:u})}const Oa="PARSE_ERROR",Na="INVALID_REQUEST",Ta="METHOD_NOT_FOUND",Aa="INVALID_PARAMS",pr="INTERNAL_ERROR",zi="SERVER_ERROR",Ca=[-32700,-32600,-32601,-32602,-32603],Lt={[Oa]:{code:-32700,message:"Parse error"},[Na]:{code:-32600,message:"Invalid Request"},[Ta]:{code:-32601,message:"Method not found"},[Aa]:{code:-32602,message:"Invalid params"},[pr]:{code:-32603,message:"Internal error"},[zi]:{code:-32e3,message:"Server error"}},gr=zi;function Fa(r){return Ca.includes(r)}function ws(r){return Object.keys(Lt).includes(r)?Lt[r]:Lt[gr]}function Da(r){const e=Object.values(Lt).find(t=>t.code===r);return e||Lt[gr]}function $a(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var yr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ai=function(r,e){return Ai=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},Ai(r,e)};function La(r,e){Ai(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ci=function(){return Ci=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Ci.apply(this,arguments)};function qa(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function Ma(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var h=r.length-1;h>=0;h--)(a=r[h])&&(n=(s<3?a(n):s>3?a(e,t,n):a(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function za(r,e){return function(t,i){e(t,i,r)}}function ja(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function Ua(r,e,t,i){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function h(u){try{c(i.next(u))}catch(p){a(p)}}function l(u){try{c(i.throw(u))}catch(p){a(p)}}function c(u){u.done?n(u.value):s(u.value).then(h,l)}c((i=i.apply(r,e||[])).next())})}function Va(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,a;return a={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function h(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=c[0]&2?s.return:c[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,c[1])).done)return n;switch(s=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){t.label=c[1];break}if(c[0]===6&&t.label<n[1]){t.label=n[1],n=c;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(c);break}n[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],s=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ka(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function ka(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function Fi(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function mr(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],a;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(h){a={error:h}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}return n}function Ba(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(mr(arguments[e]));return r}function Ha(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],a=0,h=n.length;a<h;a++,s++)i[s]=n[a];return i}function jt(r){return this instanceof jt?(this.v=r,this):new jt(r)}function Ga(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(d){i[d]&&(s[d]=function(_){return new Promise(function(m,S){n.push([d,_,m,S])>1||h(d,_)})})}function h(d,_){try{l(i[d](_))}catch(m){p(n[0][3],m)}}function l(d){d.value instanceof jt?Promise.resolve(d.value.v).then(c,u):p(n[0][2],d)}function c(d){h("next",d)}function u(d){h("throw",d)}function p(d,_){d(_),n.shift(),n.length&&h(n[0][0],n[0][1])}}function Wa(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(a){return(t=!t)?{value:jt(r[s](a)),done:s==="return"}:n?n(a):a}:n}}function Ya(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Fi=="function"?Fi(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(a){return new Promise(function(h,l){a=r[n](a),s(h,l,a.done,a.value)})}}function s(n,a,h,l){Promise.resolve(l).then(function(c){n({value:c,done:h})},a)}}function Ja(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function Qa(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function Xa(r){return r&&r.__esModule?r:{default:r}}function Za(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function ec(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const tc=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ci},__asyncDelegator:Wa,__asyncGenerator:Ga,__asyncValues:Ya,__await:jt,__awaiter:Ua,__classPrivateFieldGet:Za,__classPrivateFieldSet:ec,__createBinding:Ka,__decorate:Ma,__exportStar:ka,__extends:La,__generator:Va,__importDefault:Xa,__importStar:Qa,__makeTemplateObject:Ja,__metadata:ja,__param:za,__read:mr,__rest:qa,__spread:Ba,__spreadArrays:Ha,__values:Fi},Symbol.toStringTag,{value:"Module"})),ic=Zt(tc);var tt={},bs;function sc(){if(bs)return tt;bs=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.isBrowserCryptoAvailable=tt.getSubtleCrypto=tt.getBrowerCrypto=void 0;function r(){return(vt===null||vt===void 0?void 0:vt.crypto)||(vt===null||vt===void 0?void 0:vt.msCrypto)||{}}tt.getBrowerCrypto=r;function e(){const i=r();return i.subtle||i.webkitSubtle}tt.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return tt.isBrowserCryptoAvailable=t,tt}var it={},vs;function rc(){if(vs)return it;vs=1,Object.defineProperty(it,"__esModule",{value:!0}),it.isBrowser=it.isNode=it.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}it.isReactNative=r;function e(){return typeof ze.process<"u"&&typeof ze.process.versions<"u"&&typeof ze.process.versions.node<"u"}it.isNode=e;function t(){return!r()&&!e()}return it.isBrowser=t,it}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=ic;e.__exportStar(sc(),r),e.__exportStar(rc(),r)})(yr);function ji(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function wr(r=6){return BigInt(ji(r))}function St(r,e,t){return{id:t||ji(),jsonrpc:"2.0",method:r,params:e}}function Ui(r,e){return{id:r,jsonrpc:"2.0",result:e}}function Vi(r,e,t){return{id:r,jsonrpc:"2.0",error:nc(e,t)}}function nc(r,e){return typeof r>"u"?ws(pr):(typeof r=="string"&&(r=Object.assign(Object.assign({},ws(zi)),{message:r})),typeof e<"u"&&(r.data=e),Fa(r.code)&&(r=Da(r.code)),r)}class oc{}class ac extends oc{constructor(){super()}}class cc extends ac{constructor(e){super()}}const hc="^wss?:";function lc(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function uc(r,e){const t=lc(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function _s(r){return uc(r,hc)}function fc(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function br(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function Ki(r){return br(r)&&"method"in r}function si(r){return br(r)&&(nt(r)||Ge(r))}function nt(r){return"result"in r}function Ge(r){return"error"in r}class dc extends cc{constructor(e){super(e),this.events=new Qe.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(St(e.method,e.params||[],e.id||wr().toString()),t)}async requestStrict(e,t){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{Ge(n)?s(n.error):i(n.result)});try{await this.connection.send(e,t)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),si(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const pc=()=>typeof WebSocket<"u"?WebSocket:typeof ze.global<"u"&&typeof ze.global.WebSocket<"u"?ze.global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),gc=()=>typeof WebSocket<"u"||typeof ze.global<"u"&&typeof ze.global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Es=r=>r.split("?")[0],xs=10,yc=pc();class mc{constructor(e){if(this.url=e,this.events=new Qe.EventEmitter,this.registering=!1,!_s(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Vt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!_s(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=new URLSearchParams(e).get("origin"),n=yr.isReactNative()?{headers:{origin:s}}:{rejectUnauthorized:!fc(e)},a=new yc(e,[],n);gc()?a.onerror=h=>{const l=h;i(this.emitError(l.error))}:a.on("error",h=>{i(this.emitError(h))}),a.onopen=()=>{this.onOpen(a),t(a)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?ti(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=Vi(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return $a(e,Es(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>xs&&this.events.setMaxListeners(xs)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Es(this.url)}`));return this.events.emit("register_error",t),t}}function wc(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=s}var h=r.length,l=r.charAt(0),c=Math.log(h)/Math.log(256),u=Math.log(256)/Math.log(h);function p(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var S=0,$=0,L=0,q=m.length;L!==q&&m[L]===0;)L++,S++;for(var V=(q-L)*u+1>>>0,z=new Uint8Array(V);L!==q;){for(var K=m[L],v=0,x=V-1;(K!==0||v<$)&&x!==-1;x--,v++)K+=256*z[x]>>>0,z[x]=K%h>>>0,K=K/h>>>0;if(K!==0)throw new Error("Non-zero carry");$=v,L++}for(var O=V-$;O!==V&&z[O]===0;)O++;for(var M=l.repeat(S);O<V;++O)M+=r.charAt(z[O]);return M}function d(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var S=0;if(m[S]!==" "){for(var $=0,L=0;m[S]===l;)$++,S++;for(var q=(m.length-S)*c+1>>>0,V=new Uint8Array(q);m[S];){var z=t[m.charCodeAt(S)];if(z===255)return;for(var K=0,v=q-1;(z!==0||K<L)&&v!==-1;v--,K++)z+=h*V[v]>>>0,V[v]=z%256>>>0,z=z/256>>>0;if(z!==0)throw new Error("Non-zero carry");L=K,S++}if(m[S]!==" "){for(var x=q-L;x!==q&&V[x]===0;)x++;for(var O=new Uint8Array($+(q-x)),M=$;x!==q;)O[M++]=V[x++];return O}}}function _(m){var S=d(m);if(S)return S;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:d,decode:_}}var bc=wc,vc=bc;const vr=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},_c=r=>new TextEncoder().encode(r),Ec=r=>new TextDecoder().decode(r);class xc{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ic{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return _r(this,e)}}class Sc{constructor(e){this.decoders=e}or(e){return _r(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const _r=(r,e)=>new Sc({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Pc{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new xc(e,t,i),this.decoder=new Ic(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ri=({name:r,prefix:e,encode:t,decode:i})=>new Pc(r,e,t,i),Kt=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=vc(t,e);return ri({prefix:r,name:e,encode:i,decode:n=>vr(s(n))})},Rc=(r,e,t,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=r.length;for(;r[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let h=0,l=0,c=0;for(let u=0;u<n;++u){const p=s[r[u]];if(p===void 0)throw new SyntaxError(`Non-${i} character`);l=l<<t|p,h+=t,h>=8&&(h-=8,a[c++]=255&l>>h)}if(h>=t||255&l<<8-h)throw new SyntaxError("Unexpected end of data");return a},Oc=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",a=0,h=0;for(let l=0;l<r.length;++l)for(h=h<<8|r[l],a+=8;a>t;)a-=t,n+=e[s&h>>a];if(a&&(n+=e[s&h<<t-a]),i)for(;n.length*t&7;)n+="=";return n},he=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ri({prefix:e,name:r,encode(s){return Oc(s,i,t)},decode(s){return Rc(s,i,t,r)}}),Nc=ri({prefix:"\0",name:"identity",encode:r=>Ec(r),decode:r=>_c(r)});var Tc=Object.freeze({__proto__:null,identity:Nc});const Ac=he({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Cc=Object.freeze({__proto__:null,base2:Ac});const Fc=he({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Dc=Object.freeze({__proto__:null,base8:Fc});const $c=Kt({prefix:"9",name:"base10",alphabet:"0123456789"});var Lc=Object.freeze({__proto__:null,base10:$c});const qc=he({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Mc=he({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var zc=Object.freeze({__proto__:null,base16:qc,base16upper:Mc});const jc=he({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Uc=he({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vc=he({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Kc=he({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kc=he({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Bc=he({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hc=he({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Gc=he({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Wc=he({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Yc=Object.freeze({__proto__:null,base32:jc,base32upper:Uc,base32pad:Vc,base32padupper:Kc,base32hex:kc,base32hexupper:Bc,base32hexpad:Hc,base32hexpadupper:Gc,base32z:Wc});const Jc=Kt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Qc=Kt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Xc=Object.freeze({__proto__:null,base36:Jc,base36upper:Qc});const Zc=Kt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),eh=Kt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var th=Object.freeze({__proto__:null,base58btc:Zc,base58flickr:eh});const ih=he({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),sh=he({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rh=he({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),nh=he({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var oh=Object.freeze({__proto__:null,base64:ih,base64pad:sh,base64url:rh,base64urlpad:nh});const Er=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),ah=Er.reduce((r,e,t)=>(r[t]=e,r),[]),ch=Er.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function hh(r){return r.reduce((e,t)=>(e+=ah[t],e),"")}function lh(r){const e=[];for(const t of r){const i=ch[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const uh=ri({prefix:"🚀",name:"base256emoji",encode:hh,decode:lh});var fh=Object.freeze({__proto__:null,base256emoji:uh}),dh=xr,Is=128,ph=127,gh=~ph,yh=Math.pow(2,31);function xr(r,e,t){e=e||[],t=t||0;for(var i=t;r>=yh;)e[t++]=r&255|Is,r/=128;for(;r&gh;)e[t++]=r&255|Is,r>>>=7;return e[t]=r|0,xr.bytes=t-i+1,e}var mh=Di,wh=128,Ss=127;function Di(r,i){var t=0,i=i||0,s=0,n=i,a,h=r.length;do{if(n>=h)throw Di.bytes=0,new RangeError("Could not decode varint");a=r[n++],t+=s<28?(a&Ss)<<s:(a&Ss)*Math.pow(2,s),s+=7}while(a>=wh);return Di.bytes=n-i,t}var bh=Math.pow(2,7),vh=Math.pow(2,14),_h=Math.pow(2,21),Eh=Math.pow(2,28),xh=Math.pow(2,35),Ih=Math.pow(2,42),Sh=Math.pow(2,49),Ph=Math.pow(2,56),Rh=Math.pow(2,63),Oh=function(r){return r<bh?1:r<vh?2:r<_h?3:r<Eh?4:r<xh?5:r<Ih?6:r<Sh?7:r<Ph?8:r<Rh?9:10},Nh={encode:dh,decode:mh,encodingLength:Oh},Ir=Nh;const Ps=(r,e,t=0)=>(Ir.encode(r,e,t),e),Rs=r=>Ir.encodingLength(r),$i=(r,e)=>{const t=e.byteLength,i=Rs(r),s=i+Rs(t),n=new Uint8Array(s+t);return Ps(r,n,0),Ps(t,n,i),n.set(e,s),new Th(r,t,e,n)};class Th{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Sr=({name:r,code:e,encode:t})=>new Ah(r,e,t);class Ah{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?$i(this.code,t):t.then(i=>$i(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Pr=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Ch=Sr({name:"sha2-256",code:18,encode:Pr("SHA-256")}),Fh=Sr({name:"sha2-512",code:19,encode:Pr("SHA-512")});var Dh=Object.freeze({__proto__:null,sha256:Ch,sha512:Fh});const Rr=0,$h="identity",Or=vr,Lh=r=>$i(Rr,Or(r)),qh={code:Rr,name:$h,encode:Or,digest:Lh};var Mh=Object.freeze({__proto__:null,identity:qh});new TextEncoder,new TextDecoder;const Os={...Tc,...Cc,...Dc,...Lc,...zc,...Yc,...Xc,...th,...oh,...fh};({...Dh,...Mh});function Nr(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function zh(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Nr(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Tr(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Ns=Tr("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),mi=Tr("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=zh(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),jh={utf8:Ns,"utf-8":Ns,hex:Os.base16,latin1:mi,ascii:mi,binary:mi,...Os};function Uh(r,e="utf8"){const t=jh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Nr(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}const Ar="wc",Vh=2,ki="core",ut=`${Ar}@2:${ki}:`,Kh={name:ki,logger:"error"},kh={database:":memory:"},Bh="crypto",Ts="client_ed25519_seed",Hh=C.ONE_DAY,Gh="keychain",Wh="0.3",Yh="messages",Jh="0.3",Qh=C.SIX_HOURS,Xh="publisher",Cr="irn",Zh="error",Fr="wss://relay.walletconnect.com",As="wss://relay.walletconnect.org",el="relayer",Oe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},tl="_subscription",st={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},il=C.ONE_SECOND,sl="2.10.6",rl=1e4,nl="0.3",ol="WALLETCONNECT_CLIENT_ID",Be={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},al="subscription",cl="0.3",hl=C.FIVE_SECONDS*1e3,ll="pairing",ul="0.3",At={wc_pairingDelete:{req:{ttl:C.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:C.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:C.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:C.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:C.ONE_DAY,prompt:!1,tag:0},res:{ttl:C.ONE_DAY,prompt:!1,tag:0}}},$t={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Je={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},fl="history",dl="0.3",pl="expirer",Ve={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},gl="0.3",wi="verify-api",xt="https://verify.walletconnect.com",Li="https://verify.walletconnect.org",yl=[xt,Li];class ml{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Gh,this.version=Wh,this.initialized=!1,this.storagePrefix=ut,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=j.generateChildLogger(t,this.name)}get context(){return j.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,er(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?tr(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}class wl{constructor(e,t,i){this.core=e,this.logger=t,this.name=Bh,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),n=ms(s);return dr(n.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Br();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const n=await this.getClientSeed(),a=ms(n),h=Ei();return await Ra(h,s,Hh,a)},this.generateSharedKey=(s,n,a)=>{this.isInitialized();const h=this.getPrivateKey(s),l=Hr(h,n);return this.setSymKey(l,a)},this.setSymKey=async(s,n)=>{this.isInitialized();const a=n||Gr(s);return await this.keychain.set(a,s),a},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,n,a)=>{this.isInitialized();const h=Wr(a),l=Vt(n);if(Ji(h)){const d=h.senderPublicKey,_=h.receiverPublicKey;s=await this.generateSharedKey(d,_)}const c=this.getSymKey(s),{type:u,senderPublicKey:p}=h;return Yr({type:u,symKey:c,message:l,senderPublicKey:p})},this.decode=async(s,n,a)=>{this.isInitialized();const h=Jr(n,a);if(Ji(h)){const l=h.receiverPublicKey,c=h.senderPublicKey;s=await this.generateSharedKey(l,c)}try{const l=this.getSymKey(s),c=Qr({symKey:l,encoded:n});return ti(c)}catch(l){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(l)}},this.getPayloadType=s=>{const n=Qi(s);return Xr(n.type)},this.getPayloadSenderPublicKey=s=>{const n=Qi(s);return n.senderPublicKey?ei(n.senderPublicKey,Zr):void 0},this.core=e,this.logger=j.generateChildLogger(t,this.name),this.keychain=i||new ml(this.core,this.logger)}get context(){return j.getLoggerContext(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ts)}catch{e=Ei(),await this.keychain.set(Ts,e)}return Uh(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}class bl extends na{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Yh,this.version=Jh,this.initialized=!1,this.storagePrefix=ut,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const n=It(s);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[n]<"u"||(a[n]=s,this.messages.set(i,a),await this.persist()),n},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const n=this.get(i),a=It(s);return typeof n[a]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=j.generateChildLogger(e,this.name),this.core=t}get context(){return j.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,er(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?tr(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}class vl extends oa{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new Qe.EventEmitter,this.name=Xh,this.queue=new Map,this.publishTimeout=C.toMiliseconds(C.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,s,n)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});try{const h=(n==null?void 0:n.ttl)||Qh,l=xi(n),c=(n==null?void 0:n.prompt)||!1,u=(n==null?void 0:n.tag)||0,p=(n==null?void 0:n.id)||wr().toString(),d={topic:i,message:s,opts:{ttl:h,relay:l,prompt:c,tag:u,id:p}},_=setTimeout(()=>this.queue.set(p,d),this.publishTimeout);try{await await qt(this.rpcPublish(i,s,h,l,c,u,p),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(p),this.relayer.events.emit(Oe.publish,d)}catch(m){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(a=n==null?void 0:n.internal)!=null&&a.throwOnFailedPublish)throw this.removeRequestFromQueue(p),m;return}finally{clearTimeout(_)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}})}catch(h){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(h),h}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=j.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return j.getLoggerContext(this.logger)}rpcPublish(e,t,i,s,n,a,h){var l,c,u,p;const d={method:Yt(s.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:n,tag:a},id:h};return lt((l=d.params)==null?void 0:l.prompt)&&((c=d.params)==null||delete c.prompt),lt((u=d.params)==null?void 0:u.tag)&&((p=d.params)==null||delete p.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:d}),this.relayer.request(d)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:s}=e;await this.publish(t,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Pt.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Oe.connection_stalled);return}this.checkQueue()}),this.relayer.on(Oe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class _l{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var El=Object.defineProperty,xl=Object.defineProperties,Il=Object.getOwnPropertyDescriptors,Cs=Object.getOwnPropertySymbols,Sl=Object.prototype.hasOwnProperty,Pl=Object.prototype.propertyIsEnumerable,Fs=(r,e,t)=>e in r?El(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ct=(r,e)=>{for(var t in e||(e={}))Sl.call(e,t)&&Fs(r,t,e[t]);if(Cs)for(var t of Cs(e))Pl.call(e,t)&&Fs(r,t,e[t]);return r},bi=(r,e)=>xl(r,Il(e));class Rl extends ha{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new _l,this.events=new Qe.EventEmitter,this.name=al,this.version=cl,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ut,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=xi(s),a={topic:i,relay:n};this.pending.set(i,a);const h=await this.rpcSubscribe(i,n);return this.onSubscribe(h,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),h}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}},this.unsubscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,n)=>{const a=new C.Watch;a.start(this.pendingSubscriptionWatchLabel);const h=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(h),a.stop(this.pendingSubscriptionWatchLabel),s(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=hl&&(clearInterval(h),a.stop(this.pendingSubscriptionWatchLabel),n(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=j.generateChildLogger(t,this.name),this.clientId=""}get context(){return j.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=xi(i);await this.rpcUnsubscribe(e,t,s);const n=Fe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const i={method:Yt(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await qt(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Oe.connection_stalled)}return It(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:Yt(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await qt(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Oe.connection_stalled)}}rpcUnsubscribe(e,t,i){const s={method:Yt(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,bi(Ct({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Ct({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Ct({},t)),this.topicMap.set(t.topic,e),this.events.emit(Be.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Be.deleted,bi(Ct({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Be.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Be.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);ir(t)&&this.onBatchSubscribe(t.map((i,s)=>bi(Ct({},e[s]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Pt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Oe.connect,async()=>{await this.onConnect()}),this.relayer.on(Oe.disconnect,()=>{this.onDisconnect()}),this.events.on(Be.created,async e=>{const t=Be.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Be.deleted,async e=>{const t=Be.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var Ol=Object.defineProperty,Ds=Object.getOwnPropertySymbols,Nl=Object.prototype.hasOwnProperty,Tl=Object.prototype.propertyIsEnumerable,$s=(r,e,t)=>e in r?Ol(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Al=(r,e)=>{for(var t in e||(e={}))Nl.call(e,t)&&$s(r,t,e[t]);if(Ds)for(var t of Ds(e))Tl.call(e,t)&&$s(r,t,e[t]);return r};class Cl extends aa{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Qe.EventEmitter,this.name=el,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(Oe.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Oe.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(st.payload,this.onPayloadHandler),this.provider.on(st.connect,this.onConnectHandler),this.provider.on(st.disconnect,this.onDisconnectHandler),this.provider.on(st.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?j.generateChildLogger(e.logger,this.name):j.pino(j.getDefaultLoggerOptions({level:e.logger||Zh})),this.messages=new bl(this.logger,e.core),this.subscriber=new Rl(this,this.logger),this.publisher=new vl(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Fr,this.projectId=e.projectId,this.bundleId=en(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${As}...`),await this.restartTransport(As)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},rl)}get context(){return j.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){var i;this.isInitialized();let s=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";if(s)return s;let n;const a=h=>{h.topic===e&&(this.subscriber.off(Be.created,a),n())};return await Promise.all([new Promise(h=>{n=h,this.subscriber.on(Be.created,a)}),new Promise(async h=>{s=await this.subscriber.subscribe(e,t),h()})]),s}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await qt(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(Be.resubscribed,()=>{t()})}),new Promise(async(t,i)=>{try{await qt(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(s){i(s);return}t()})])}catch(t){this.logger.error(t);const i=t;if(!this.isConnectionStalled(i.message))throw t;this.provider.events.emit(st.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Xi())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(t=>e.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new dc(new mc(tn({sdkVersion:sl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.debug(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ki(e)){if(!e.method.endsWith(tl))return;const t=e.params,{topic:i,message:s,publishedAt:n}=t.data,a={topic:i,message:s,publishedAt:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Al({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else si(e)&&this.events.emit(Oe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Oe.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Ui(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(st.payload,this.onPayloadHandler),this.provider.off(st.connect,this.onConnectHandler),this.provider.off(st.disconnect,this.onDisconnectHandler),this.provider.off(st.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Oe.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let e=await Xi();sn(async t=>{this.initialized&&e!==t&&(e=t,t?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(i=>this.logger.error(i))))})}onProviderDisconnect(){this.events.emit(Oe.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},C.toMiliseconds(il)))}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Fl=Object.defineProperty,Ls=Object.getOwnPropertySymbols,Dl=Object.prototype.hasOwnProperty,$l=Object.prototype.propertyIsEnumerable,qs=(r,e,t)=>e in r?Fl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ms=(r,e)=>{for(var t in e||(e={}))Dl.call(e,t)&&qs(r,t,e[t]);if(Ls)for(var t of Ls(e))$l.call(e,t)&&qs(r,t,e[t]);return r};class ni extends ca{constructor(e,t,i,s=ut,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=nl,this.cached=[],this.initialized=!1,this.storagePrefix=ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!lt(a)?this.map.set(this.getKey(a),a):Kr(a)?this.map.set(a.id,a):kr(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,h)=>{this.isInitialized(),this.map.has(a)?await this.update(a,h):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:h}),this.map.set(a,h),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(h=>Object.keys(a).every(l=>Rn(h[l],a[l]))):this.values),this.update=async(a,h)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:h});const l=Ms(Ms({},this.getData(a)),h);this.map.set(a,l),await this.persist()},this.delete=async(a,h)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:h}),this.map.delete(a),await this.persist())},this.logger=j.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return j.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ll{constructor(e,t){this.core=e,this.logger=t,this.name=ll,this.version=ul,this.events=new Ws,this.initialized=!1,this.storagePrefix=ut,this.ignoredPayloadTypes=[Qs],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ei(),s=await this.core.crypto.setSymKey(i),n=He(C.FIVE_MINUTES),a={protocol:Cr},h={topic:s,expiry:n,relay:a,active:!1},l=rn({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a});return await this.pairings.set(s,h),await this.core.relayer.subscribe(s),this.core.expirer.set(s,n),{topic:s,uri:l}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:n,relay:a}=Zi(i.uri);let h;if(this.pairings.keys.includes(s)&&(h=this.pairings.get(s),h.active))throw new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);const l=He(C.FIVE_MINUTES),c={topic:s,relay:a,expiry:l,active:!1};return await this.pairings.set(s,c),this.core.expirer.set(s,l),i.activatePairing&&await this.activate({topic:s}),this.events.emit($t.create,c),this.core.crypto.keychain.has(s)||(await this.core.crypto.setSymKey(n,s),await this.core.relayer.subscribe(s,{relay:a})),c},this.activate=async({topic:i})=>{this.isInitialized();const s=He(C.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:a,resolve:h,reject:l}=_t();this.events.once(ie("pairing_ping",n),({error:c})=>{c?l(c):h()}),await a()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Fe("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,n)=>{const a=St(s,n),h=await this.core.crypto.encode(i,a),l=At[s].req;return this.core.history.set(i,a),this.core.relayer.publish(i,h,l),a.id},this.sendResult=async(i,s,n)=>{const a=Ui(i,n),h=await this.core.crypto.encode(s,a),l=await this.core.history.get(s,i),c=At[l.request.method].res;await this.core.relayer.publish(s,h,c),await this.core.history.resolve(a)},this.sendError=async(i,s,n)=>{const a=Vi(i,n),h=await this.core.crypto.encode(s,a),l=await this.core.history.get(s,i),c=At[l.request.method]?At[l.request.method].res:At.unregistered_method.res;await this.core.relayer.publish(s,h,c),await this.core.history.resolve(a)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Fe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>ht(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return this.onPairingPingRequest(s,n);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,n);default:return this.onUnknownRpcMethodRequest(s,n)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:n}=i,a=(await this.core.history.get(s,n.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit($t.ping,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}},this.onPairingPingResponse=(i,s)=>{const{id:n}=s;setTimeout(()=>{nt(s)?this.events.emit(ie("pairing_ping",n),{}):Ge(s)&&this.events.emit(ie("pairing_ping",n),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit($t.delete,{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:n,method:a}=s;try{if(this.registeredMethods.includes(a))return;const h=Fe("WC_METHOD_UNSUPPORTED",a);await this.sendError(n,i,h),this.logger.error(h)}catch(h){await this.sendError(n,i,h),this.logger.error(h)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Fe("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{var s;if(!qe(i)){const{message:a}=R("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(a)}if(!nn(i.uri)){const{message:a}=R("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(a)}const n=Zi(i.uri);if(!((s=n==null?void 0:n.relay)!=null&&s.protocol)){const{message:a}=R("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(a)}if(!(n!=null&&n.symKey)){const{message:a}=R("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(a)}},this.isValidPing=async i=>{if(!qe(i)){const{message:n}=R("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!qe(i)){const{message:n}=R("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Et(i,!1)){const{message:s}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(ht(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=R("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=j.generateChildLogger(t,this.name),this.pairings=new ni(this.core,this.logger,this.name,this.storagePrefix)}get context(){return j.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Oe.message,async e=>{const{topic:t,message:i}=e;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(t,i);try{Ki(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):si(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.core.history.delete(t,s.id))}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(Ve.expired,async e=>{const{topic:t}=Xs(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit($t.expire,{topic:t}))})}}class ql extends ra{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new Qe.EventEmitter,this.name=fl,this.version=dl,this.cached=[],this.initialized=!1,this.storagePrefix=ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:He(C.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(Je.created,a)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Ge(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(Je.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(Je.deleted,n)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=j.generateChildLogger(t,this.name)}get context(){return j.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:St(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Je.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Je.created,e=>{const t=Je.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Je.updated,e=>{const t=Je.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(Je.deleted,e=>{const t=Je.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.core.heartbeat.on(Pt.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{C.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ml extends la{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new Qe.EventEmitter,this.name=pl,this.version=gl,this.cached=[],this.initialized=!1,this.storagePrefix=ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const n=this.formatTarget(i),a={target:n,expiry:s};this.expirations.set(n,a),this.checkExpiry(n,a),this.events.emit(Ve.created,{target:n,expiration:a})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(Ve.deleted,{target:s,expiration:n})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=j.generateChildLogger(t,this.name)}get context(){return j.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return on(e);if(typeof e=="number")return an(e);const{message:t}=R("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ve.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;C.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Ve.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Pt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ve.created,e=>{const t=Ve.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ve.expired,e=>{const t=Ve.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ve.deleted,e=>{const t=Ve.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}class zl extends ua{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.name=wi,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async i=>{if(this.verifyDisabled||cn()||!Zs())return;const s=this.getVerifyUrl(i==null?void 0:i.verifyUrl);this.verifyUrl!==s&&this.removeIframe(),this.verifyUrl=s;try{await this.createIframe()}catch(n){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(n)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Li;try{await this.createIframe()}catch(n){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(n),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const s=this.getVerifyUrl(i==null?void 0:i.verifyUrl);let n;try{n=await this.fetchAttestation(i.attestationId,s)}catch(a){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${s}`),this.logger.info(a),n=await this.fetchAttestation(i.attestationId,Li)}return n},this.fetchAttestation=async(i,s)=>{this.logger.info(`resolving attestation: ${i} from url: ${s}`);const n=this.startAbortTimer(C.ONE_SECOND*2),a=await fetch(`${s}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(n),a.status===200?await a.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var s;try{if(!this.iframe)return;(s=this.iframe.contentWindow)==null||s.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const s=n=>{n.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",s),i())};await Promise.race([new Promise(n=>{if(document.getElementById(wi))return n();window.addEventListener("message",s);const a=document.createElement("iframe");a.id=wi,a.src=`${this.verifyUrl}/${this.projectId}`,a.style.display="none",document.body.append(a),this.iframe=a,i=n}),new Promise((n,a)=>setTimeout(()=>{window.removeEventListener("message",s),a("verify iframe load timeout")},C.toMiliseconds(C.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=i=>{let s=i||xt;return yl.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${xt}`),s=xt),s},this.logger=j.generateChildLogger(t,this.name),this.verifyUrl=xt,this.abortController=new AbortController,this.isDevEnv=hn()&&{}.IS_VITEST}get context(){return j.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),C.toMiliseconds(e))}}var jl=Object.defineProperty,zs=Object.getOwnPropertySymbols,Ul=Object.prototype.hasOwnProperty,Vl=Object.prototype.propertyIsEnumerable,js=(r,e,t)=>e in r?jl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Us=(r,e)=>{for(var t in e||(e={}))Ul.call(e,t)&&js(r,t,e[t]);if(zs)for(var t of zs(e))Vl.call(e,t)&&js(r,t,e[t]);return r};class Bi extends sa{constructor(e){super(e),this.protocol=Ar,this.version=Vh,this.name=ki,this.events=new Qe.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Fr,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:j.pino(j.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Kh.logger}));this.logger=j.generateChildLogger(t,this.name),this.heartbeat=new Pt.HeartBeat,this.crypto=new wl(this,this.logger,e==null?void 0:e.keychain),this.history=new ql(this,this.logger),this.expirer=new Ml(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new oo(Us(Us({},kh),e==null?void 0:e.storageOptions)),this.relayer=new Cl({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Ll(this,this.logger),this.verify=new zl(this.projectId||"",this.logger)}static async init(e){const t=new Bi(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem(ol,i),t}get context(){return j.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Kl=Bi,Dr="wc",$r=2,Lr="client",Hi=`${Dr}@${$r}:${Lr}:`,vi={name:Lr,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Vs="WALLETCONNECT_DEEPLINK_CHOICE",kl="proposal",Bl="Proposal expired",Hl="session",Wt=C.SEVEN_DAYS,Gl="engine",Ft={wc_sessionPropose:{req:{ttl:C.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:C.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:C.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:C.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:C.ONE_DAY,prompt:!1,tag:1104},res:{ttl:C.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:C.ONE_DAY,prompt:!1,tag:1106},res:{ttl:C.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:C.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:C.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:C.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:C.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:C.ONE_DAY,prompt:!1,tag:1112},res:{ttl:C.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:C.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:C.THIRTY_SECONDS,prompt:!1,tag:1115}}},_i={min:C.FIVE_MINUTES,max:C.SEVEN_DAYS},rt={idle:"IDLE",active:"ACTIVE"},Wl="request",Yl=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Jl=Object.defineProperty,Ql=Object.defineProperties,Xl=Object.getOwnPropertyDescriptors,Ks=Object.getOwnPropertySymbols,Zl=Object.prototype.hasOwnProperty,eu=Object.prototype.propertyIsEnumerable,ks=(r,e,t)=>e in r?Jl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$e=(r,e)=>{for(var t in e||(e={}))Zl.call(e,t)&&ks(r,t,e[t]);if(Ks)for(var t of Ks(e))eu.call(e,t)&&ks(r,t,e[t]);return r},Dt=(r,e)=>Ql(r,Xl(e));class tu extends da{constructor(e){super(e),this.name=Gl,this.events=new Ws,this.initialized=!1,this.ignoredPayloadTypes=[Qs],this.requestQueue={state:rt.idle,queue:[]},this.sessionRequestQueue={state:rt.idle,queue:[]},this.requestQueueDelay=C.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ft)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},C.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const i=Dt($e({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:a,sessionProperties:h,relays:l}=i;let c=s,u,p=!1;if(c&&(p=this.client.core.pairing.pairings.get(c).active),!c||!p){const{topic:V,uri:z}=await this.client.core.pairing.create();c=V,u=z}const d=await this.client.core.crypto.generateKeyPair(),_=$e({requiredNamespaces:n,optionalNamespaces:a,relays:l??[{protocol:Cr}],proposer:{publicKey:d,metadata:this.client.metadata}},h&&{sessionProperties:h}),{reject:m,resolve:S,done:$}=_t(C.FIVE_MINUTES,Bl);if(this.events.once(ie("session_connect"),async({error:V,session:z})=>{if(V)m(V);else if(z){z.self.publicKey=d;const K=Dt($e({},z),{requiredNamespaces:z.requiredNamespaces,optionalNamespaces:z.optionalNamespaces});await this.client.session.set(z.topic,K),await this.setExpiry(z.topic,z.expiry),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:z.peer.metadata}),S(K)}}),!c){const{message:V}=R("NO_MATCHING_KEY",`connect() pairing topic: ${c}`);throw new Error(V)}const L=await this.sendRequest({topic:c,method:"wc_sessionPropose",params:_}),q=He(C.FIVE_MINUTES);return await this.setProposal(L,$e({id:L,expiry:q},_)),{uri:u,approval:$}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:i,relayProtocol:s,namespaces:n,sessionProperties:a}=t,h=this.client.proposal.get(i);let{pairingTopic:l,proposer:c,requiredNamespaces:u,optionalNamespaces:p}=h;l=l||"",hi(u)||(u=un(n,"approve()"));const d=await this.client.core.crypto.generateKeyPair(),_=c.publicKey,m=await this.client.core.crypto.generateSharedKey(d,_);l&&i&&(await this.client.core.pairing.updateMetadata({topic:l,metadata:c.metadata}),await this.sendResult({id:i,topic:l,result:{relay:{protocol:s??"irn"},responderPublicKey:d}}),await this.client.proposal.delete(i,Fe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:l}));const S=$e({relay:{protocol:s??"irn"},namespaces:n,requiredNamespaces:u,optionalNamespaces:p,pairingTopic:l,controller:{publicKey:d,metadata:this.client.metadata},expiry:He(Wt)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(m),await this.sendRequest({topic:m,method:"wc_sessionSettle",params:S,throwOnFailedPublish:!0});const $=Dt($e({},S),{topic:m,pairingTopic:l,acknowledged:!1,self:S.controller,peer:{publicKey:c.publicKey,metadata:c.metadata},controller:d});return await this.client.session.set(m,$),await this.setExpiry(m,He(Wt)),{topic:m,acknowledged:()=>new Promise(L=>setTimeout(()=>L(this.client.session.get(m)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:i,reason:s}=t,{pairingTopic:n}=this.client.proposal.get(i);n&&(await this.sendError(i,n,s),await this.client.proposal.delete(i,Fe("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:i,namespaces:s}=t,n=await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s}}),{done:a,resolve:h,reject:l}=_t();return this.events.once(ie("session_update",n),({error:c})=>{c?l(c):h()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:a}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:i}=t,s=await this.sendRequest({topic:i,method:"wc_sessionExtend",params:{}}),{done:n,resolve:a,reject:h}=_t();return this.events.once(ie("session_extend",s),({error:l})=>{l?h(l):a()}),await this.setExpiry(i,He(Wt)),{acknowledged:n}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:i,request:s,topic:n,expiry:a}=t,h=ji(),{done:l,resolve:c,reject:u}=_t(a,"Request expired. Please try again.");return this.events.once(ie("session_request",h),({error:p,result:d})=>{p?u(p):c(d)}),await Promise.all([new Promise(async p=>{await this.sendRequest({clientRpcId:h,topic:n,method:"wc_sessionRequest",params:{request:s,chainId:i},expiry:a,throwOnFailedPublish:!0}).catch(d=>u(d)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:h}),p()}),new Promise(async p=>{const d=await fn(this.client.core.storage,Vs);dn({id:h,topic:n,wcDeepLink:d}),p()}),l()]).then(p=>p[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:n}=s;nt(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0}):Ge(s)&&await this.sendError(n,i,s.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=await this.sendRequest({topic:i,method:"wc_sessionPing",params:{}}),{done:n,resolve:a,reject:h}=_t();this.events.once(ie("session_ping",s),({error:l})=>{l?h(l):a()}),await n()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:i,event:s,chainId:n}=t;await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:i}=t;this.client.session.keys.includes(i)?(await this.sendRequest({topic:i,method:"wc_sessionDelete",params:Fe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(i=>pn(i,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const i=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var a,h;return((a=n.peerMetadata)==null?void 0:a.url)&&((h=n.peerMetadata)==null?void 0:h.url)===t.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(t,i)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,Fe("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(s.publicKey)&&await this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),i||this.client.core.expirer.del(t),this.client.core.storage.removeItem(Vs).catch(n=>this.client.logger.warn(n))},this.deleteProposal=async(t,i)=>{await Promise.all([this.client.proposal.delete(t,Fe("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),s&&(this.sessionRequestQueue.state=rt.idle)},this.setExpiry=async(t,i)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:i}),this.client.core.expirer.set(t,i)},this.setProposal=async(t,i)=>{await this.client.proposal.set(t,i),this.client.core.expirer.set(t,i.expiry)},this.setPendingSessionRequest=async t=>{const i=Ft.wc_sessionRequest.req.ttl,{id:s,topic:n,params:a,verifyContext:h}=t;await this.client.pendingRequest.set(s,{id:s,topic:n,params:a,verifyContext:h}),i&&this.client.core.expirer.set(s,He(i))},this.sendRequest=async t=>{const{topic:i,method:s,params:n,expiry:a,relayRpcId:h,clientRpcId:l,throwOnFailedPublish:c}=t,u=St(s,n,l);if(Zs()&&Yl.includes(s)){const _=It(JSON.stringify(u));this.client.core.verify.register({attestationId:_})}const p=await this.client.core.crypto.encode(i,u),d=Ft[s].req;return a&&(d.ttl=a),h&&(d.id=h),this.client.core.history.set(i,u),c?(d.internal=Dt($e({},d.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,p,d)):this.client.core.relayer.publish(i,p,d).catch(_=>this.client.logger.error(_)),u.id},this.sendResult=async t=>{const{id:i,topic:s,result:n,throwOnFailedPublish:a}=t,h=Ui(i,n),l=await this.client.core.crypto.encode(s,h),c=await this.client.core.history.get(s,i),u=Ft[c.request.method].res;a?(u.internal=Dt($e({},u.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,l,u)):this.client.core.relayer.publish(s,l,u).catch(p=>this.client.logger.error(p)),await this.client.core.history.resolve(h)},this.sendError=async(t,i,s)=>{const n=Vi(t,s),a=await this.client.core.crypto.encode(i,n),h=await this.client.core.history.get(i,t),l=Ft[h.request.method].res;this.client.core.relayer.publish(i,a,l),await this.client.core.history.resolve(n)},this.cleanup=async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{ht(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{ht(s.expiry)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===rt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=rt.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(i=>setTimeout(i,300))}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=rt.idle},this.processRequest=t=>{const{topic:i,payload:s}=t,n=s.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${n}`)}},this.onRelayEventResponse=async t=>{const{topic:i,payload:s}=t,n=(await this.client.core.history.get(i,s.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${n}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:i}=t,{message:s}=R("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)},this.onSessionProposeRequest=async(t,i)=>{const{params:s,id:n}=i;try{this.isValidConnect($e({},i.params));const a=He(C.FIVE_MINUTES),h=$e({id:n,pairingTopic:t,expiry:a},s);await this.setProposal(n,h);const l=It(JSON.stringify(i)),c=await this.getVerifyContext(l,h.proposer.metadata);this.client.events.emit("session_proposal",{id:n,params:h,verifyContext:c})}catch(a){await this.sendError(n,t,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(t,i)=>{const{id:s}=i;if(nt(i)){const{result:n}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const h=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:h});const l=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const c=await this.client.core.crypto.generateSharedKey(h,l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:c});const u=await this.client.core.relayer.subscribe(c);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:u}),await this.client.core.pairing.activate({topic:t})}else Ge(i)&&(await this.client.proposal.delete(s,Fe("USER_DISCONNECTED")),this.events.emit(ie("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(t,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:a,controller:h,expiry:l,namespaces:c,requiredNamespaces:u,optionalNamespaces:p,sessionProperties:d,pairingTopic:_}=i.params,m=$e({topic:t,relay:a,expiry:l,namespaces:c,acknowledged:!0,pairingTopic:_,requiredNamespaces:u,optionalNamespaces:p,controller:h.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:h.publicKey,metadata:h.metadata}},d&&{sessionProperties:d});await this.sendResult({id:i.id,topic:t,result:!0}),this.events.emit(ie("session_connect"),{session:m}),this.cleanupDuplicatePairings(m)}catch(a){await this.sendError(s,t,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(t,i)=>{const{id:s}=i;nt(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ie("session_approve",s),{})):Ge(i)&&(await this.client.session.delete(t,Fe("USER_DISCONNECTED")),this.events.emit(ie("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(t,i)=>{const{params:s,id:n}=i;try{const a=`${t}_session_update`,h=Bt.get(a);if(h&&this.isRequestOutOfSync(h,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidUpdate($e({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:t,result:!0}),this.client.events.emit("session_update",{id:n,topic:t,params:s}),Bt.set(a,n)}catch(a){await this.sendError(n,t,a),this.client.logger.error(a)}},this.isRequestOutOfSync=(t,i)=>parseInt(i.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,i)=>{const{id:s}=i;nt(i)?this.events.emit(ie("session_update",s),{}):Ge(i)&&this.events.emit(ie("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,He(Wt)),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(n){await this.sendError(s,t,n),this.client.logger.error(n)}},this.onSessionExtendResponse=(t,i)=>{const{id:s}=i;nt(i)?this.events.emit(ie("session_extend",s),{}):Ge(i)&&this.events.emit(ie("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(n){await this.sendError(s,t,n),this.client.logger.error(n)}},this.onSessionPingResponse=(t,i)=>{const{id:s}=i;setTimeout(()=>{nt(i)?this.events.emit(ie("session_ping",s),{}):Ge(i)&&this.events.emit(ie("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(Oe.publish,async()=>{n(await this.deleteSession(t))})}),this.sendResult({id:s,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:s,topic:t})}catch(n){this.client.logger.error(n)}},this.onSessionRequest=async(t,i)=>{const{id:s,params:n}=i;try{this.isValidRequest($e({topic:t},n));const a=It(JSON.stringify(St("wc_sessionRequest",n,s))),h=this.client.session.get(t),l=await this.getVerifyContext(a,h.peer.metadata),c={id:s,topic:t,params:n,verifyContext:l};await this.setPendingSessionRequest(c),this.addSessionRequestToSessionRequestQueue(c),this.processSessionRequestQueue()}catch(a){await this.sendError(s,t,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(t,i)=>{const{id:s}=i;nt(i)?this.events.emit(ie("session_request",s),{result:i.result}):Ge(i)&&this.events.emit(ie("session_request",s),{error:i.error})},this.onSessionEventRequest=async(t,i)=>{const{id:s,params:n}=i;try{const a=`${t}_session_event_${n.event.name}`,h=Bt.get(a);if(h&&this.isRequestOutOfSync(h,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit($e({topic:t},n)),this.client.events.emit("session_event",{id:s,topic:t,params:n}),Bt.set(a,s)}catch(a){await this.sendError(s,t,a),this.client.logger.error(a)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=rt.idle,this.processSessionRequestQueue()},C.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===rt.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=rt.active,this.client.events.emit("session_request",t)}catch(i){this.client.logger.error(i)}},this.onPairingCreated=t=>{if(t.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);i&&this.onSessionProposeRequest(t.topic,St("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id))},this.isValidConnect=async t=>{if(!qe(t)){const{message:l}=R("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:a,relays:h}=t;if(lt(i)||await this.isValidPairingTopic(i),!gn(h,!0)){const{message:l}=R("MISSING_OR_INVALID",`connect() relays: ${h}`);throw new Error(l)}!lt(s)&&hi(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!lt(n)&&hi(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),lt(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(t,i)=>{const s=yn(t,"connect()",i);if(s)throw new Error(s.message)},this.isValidApprove=async t=>{if(!qe(t))throw new Error(R("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:a}=t;await this.isValidProposalId(i);const h=this.client.proposal.get(i),l=li(s,"approve()");if(l)throw new Error(l.message);const c=es(h.requiredNamespaces,s,"approve()");if(c)throw new Error(c.message);if(!Et(n,!0)){const{message:u}=R("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(u)}lt(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async t=>{if(!qe(t)){const{message:n}=R("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:i,reason:s}=t;if(await this.isValidProposalId(i),!mn(s)){const{message:n}=R("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}},this.isValidSessionSettleRequest=t=>{if(!qe(t)){const{message:c}=R("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(c)}const{relay:i,controller:s,namespaces:n,expiry:a}=t;if(!wn(i)){const{message:c}=R("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(c)}const h=bn(s,"onSessionSettleRequest()");if(h)throw new Error(h.message);const l=li(n,"onSessionSettleRequest()");if(l)throw new Error(l.message);if(ht(a)){const{message:c}=R("EXPIRED","onSessionSettleRequest()");throw new Error(c)}},this.isValidUpdate=async t=>{if(!qe(t)){const{message:l}=R("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(l)}const{topic:i,namespaces:s}=t;await this.isValidSessionTopic(i);const n=this.client.session.get(i),a=li(s,"update()");if(a)throw new Error(a.message);const h=es(n.requiredNamespaces,s,"update()");if(h)throw new Error(h.message)},this.isValidExtend=async t=>{if(!qe(t)){const{message:s}=R("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionTopic(i)},this.isValidRequest=async t=>{if(!qe(t)){const{message:l}=R("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(l)}const{topic:i,request:s,chainId:n,expiry:a}=t;await this.isValidSessionTopic(i);const{namespaces:h}=this.client.session.get(i);if(!ts(h,n)){const{message:l}=R("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(l)}if(!vn(s)){const{message:l}=R("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(l)}if(!_n(h,n,s.method)){const{message:l}=R("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(l)}if(a&&!En(a,_i)){const{message:l}=R("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${_i.min} and ${_i.max}`);throw new Error(l)}},this.isValidRespond=async t=>{if(!qe(t)){const{message:n}=R("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(n)}const{topic:i,response:s}=t;if(await this.isValidSessionTopic(i),!xn(s)){const{message:n}=R("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(n)}},this.isValidPing=async t=>{if(!qe(t)){const{message:s}=R("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async t=>{if(!qe(t)){const{message:h}=R("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(h)}const{topic:i,event:s,chainId:n}=t;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!ts(a,n)){const{message:h}=R("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(h)}if(!In(s)){const{message:h}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}if(!Sn(a,n,s.name)){const{message:h}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}},this.isValidDisconnect=async t=>{if(!qe(t)){const{message:s}=R("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(t,i)=>{const s={verified:{verifyUrl:i.verifyUrl||xt,validation:"UNKNOWN",origin:i.url||""}};try{const n=await this.client.core.verify.resolve({attestationId:t,verifyUrl:i.verifyUrl});n&&(s.verified.origin=n.origin,s.verified.isScam=n.isScam,s.verified.validation=n.origin===new URL(i.url).origin?"VALID":"INVALID")}catch(n){this.client.logger.info(n)}return this.client.logger.info(`Verify context: ${JSON.stringify(s)}`),s},this.validateSessionProps=(t,i)=>{Object.values(t).forEach(s=>{if(!Et(s,!1)){const{message:n}=R("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(n)}})}}async isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Oe.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(t,i);try{Ki(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):si(s)?(await this.client.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.client.core.history.delete(t,s.id)):this.onRelayEventUnknownPayload({topic:t,payload:s})}catch(n){this.client.logger.error(n)}})}registerExpirerEvents(){this.client.core.expirer.on(Ve.expired,async e=>{const{topic:t,id:i}=Xs(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,R("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on($t.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!Et(e,!1)){const{message:t}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(ht(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=R("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Et(e,!1)){const{message:t}=R("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=R("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(ht(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=R("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Et(e,!1)){const{message:t}=R("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=R("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Pn(e)){const{message:t}=R("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=R("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(ht(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=R("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class iu extends ni{constructor(e,t){super(e,t,kl,Hi),this.core=e,this.logger=t}}class su extends ni{constructor(e,t){super(e,t,Hl,Hi),this.core=e,this.logger=t}}class ru extends ni{constructor(e,t){super(e,t,Wl,Hi,i=>i.id),this.core=e,this.logger=t}}class Gi extends fa{constructor(e){super(e),this.protocol=Dr,this.version=$r,this.name=vi.name,this.events=new Qe.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||vi.name,this.metadata=(e==null?void 0:e.metadata)||ln();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:j.pino(j.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||vi.logger}));this.core=(e==null?void 0:e.core)||new Kl(e),this.logger=j.generateChildLogger(t,this.name),this.session=new su(this.core,this.logger),this.proposal=new iu(this.core,this.logger),this.pendingRequest=new ru(this.core,this.logger),this.engine=new tu(this)}static async init(e){const t=new Gi(e);return await t.initialize(),t}get context(){return j.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const Bs=[{name:"Rainbow",chains:[ot.EIP155],logo:"https://images.web3auth.io/login-rainbow.svg",mobile:{native:"rainbow:",universal:"https://rnbwapp.com"},desktop:{native:"",universal:""}},{name:"MetaMask",chains:[ot.EIP155],logo:"https://images.web3auth.io/login-metamask.svg",mobile:{native:"metamask:",universal:"https://metamask.app.link"},desktop:{native:"",universal:""}},{name:"Argent",chains:[ot.EIP155],logo:"https://images.web3auth.io/login-argent.svg",mobile:{native:"argent://",universal:"https://www.argent.xyz/app"},desktop:{native:"",universal:""}},{name:"Trust Wallet",chains:[ot.EIP155],logo:"https://images.web3auth.io/login-trust.svg",mobile:{native:"trust:",universal:"https://link.trustwallet.com"},desktop:{native:"",universal:""}},{name:"Zerion",chains:[ot.EIP155],logo:"https://images.web3auth.io/login-zerion.svg",mobile:{native:"zerion://",universal:"https://wallet.zerion.io"},desktop:{native:"",universal:""}}];let nu=function(r){return r.ETH_SEND_TRANSACTION="eth_sendTransaction",r.ETH_SIGN="eth_sign",r.PERSONAL_SIGN="personal_sign",r.ETH_SIGN_TYPED_DATA="eth_signTypedData",r}({}),ou=function(r){return r.ETH_CHAIN_CHANGED="chainChanged",r.ETH_ACCOUNTS_CHANGED="accountsChanged",r}({});const au=r=>{const{document:e}=r,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const i=e.querySelector('head > meta[name="title"]');return i?i.content:e.title&&e.title.length>0?e.title:r.location.hostname};function Hs(r){return new Promise((e,t)=>{try{const i=document.createElement("img");i.onload=()=>e(!0),i.onerror=()=>e(!1),i.src=r}catch(i){t(i)}})}async function cu(r){const{document:e}=r;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await Hs(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(i=>!!i.href)||null,t&&await Hs(t.href))?t.href:null}const hu=async()=>({name:au(window),icon:await cu(window)}),lu=r=>{const e=[];return r.forEach(t=>{const[i]=t.split(":");e.includes(i)||e.push(i)}),e},uu=r=>{switch(r){case ot.EIP155:return Object.values(nu);default:throw new Error(`No default methods for namespace: ${r}`)}},fu=r=>{switch(r){case ot.EIP155:return Object.values(ou);default:throw new Error(`No default events for namespace: ${r}`)}},du=r=>{const e=lu(r);return Object.fromEntries(e.map(t=>[t,{methods:uu(t),chains:r.filter(i=>i.startsWith(t)),events:fu(t)}]))},pu=async(r,e,t)=>{if(r===ot.EIP155){const i=await hu(),s={walletConnectInitOptions:{projectId:t,relayUrl:"wss://relay.walletconnect.com",metadata:{name:i.name,description:i.name,url:window.location.origin,icons:[i.icon||""]}}},n=e.map(h=>`${r}:${h}`),a={requiredNamespaces:du(n)};return{adapterSettings:s,loginSettings:a}}throw new Error(`Unsupported chain namespace: ${r}`)},Gs=(r,e,t)=>{var i,s;const n=(t==null?void 0:t.requiredNamespaces)||{},a=`${r}:${e}`;return!n[r].chains||((i=n[r].chains)===null||i===void 0?void 0:i.length)===0?!1:!!((s=n[r].chains)===null||s===void 0?void 0:s.includes(a))};class Ru extends On{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),Ye(this,"name",Ot.WALLET_CONNECT_V2),Ye(this,"adapterNamespace",qr.EIP155),Ye(this,"currentChainNamespace",ot.EIP155),Ye(this,"type",Mr.EXTERNAL),Ye(this,"adapterOptions",void 0),Ye(this,"status",ke.NOT_READY),Ye(this,"adapterData",{uri:"",extensionAdapters:Bs}),Ye(this,"connector",null),Ye(this,"activeSession",null),Ye(this,"wcProvider",null),this.adapterOptions=ai({},e)}get connected(){return!!this.activeSession}get provider(){return this.status!==ke.NOT_READY&&this.wcProvider?this.wcProvider:null}set provider(e){throw new Error("Not implemented")}async init(e){var t,i,s;await super.init(),super.checkInitializationRequirements();const n=(t=this.adapterOptions.adapterSettings)===null||t===void 0||(t=t.walletConnectInitOptions)===null||t===void 0?void 0:t.projectId;if(!n)throw Ze.invalidParams("Wallet connect project id is required in wallet connect v2 adapter");const a=await pu((i=this.chainConfig)===null||i===void 0?void 0:i.chainNamespace,[parseInt((s=this.chainConfig)===null||s===void 0?void 0:s.chainId,16)],n);this.adapterOptions.loginSettings||(this.adapterOptions.loginSettings=a.loginSettings),this.adapterOptions.adapterSettings=zr(a.adapterSettings,this.adapterOptions.adapterSettings);const{adapterSettings:h}=this.adapterOptions;if(this.connector=await Gi.init(h==null?void 0:h.walletConnectInitOptions),this.wcProvider=new is({config:{chainConfig:this.chainConfig},connector:this.connector}),this.emit(ct.READY,Ot.WALLET_CONNECT_V2),this.status=ke.READY,et.debug("initializing wallet connect v2 adapter"),e.autoConnect)if(await this.checkForPersistedSession(),this.connected){this.rehydrated=!0;try{await this.onConnectHandler()}catch(l){et.error("wallet auto connect",l),this.emit(ct.ERRORED,l)}}else this.status=ke.NOT_READY,this.emit(ct.CACHE_CLEAR)}async connect(){if(super.checkConnectionRequirements(),!this.connector)throw Ze.notReady("Wallet adapter is not ready yet");try{return this.connected?(await this.onConnectHandler(),this.provider):(this.status!==ke.CONNECTING&&await this.createNewSession(),this.provider)}catch(e){throw et.error("Wallet connect v2 adapter error while connecting",e),this.status=ke.READY,this.rehydrated=!0,this.emit(ct.ERRORED,e),e instanceof jr?e:ci.connectionError(`Failed to login with wallet connect: ${(e==null?void 0:e.message)||""}`)}}async addChain(e){var t;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(super.checkAddChainRequirements(e,i),!Gs(this.currentChainNamespace,parseInt(e.chainId,16),this.adapterOptions.loginSettings))throw Yi.chainIDNotAllowed(`Unsupported chainID: ${e.chainId}`);await((t=this.wcProvider)===null||t===void 0?void 0:t.addChain(e)),this.addChainConfig(e)}async switchChain(e){var t;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(super.checkSwitchChainRequirements(e,i),!Gs(this.currentChainNamespace,parseInt(e.chainId,16),this.adapterOptions.loginSettings))throw Yi.chainIDNotAllowed(`Unsupported chainID: ${e.chainId}`);await((t=this.wcProvider)===null||t===void 0?void 0:t.switchChain({chainId:e.chainId})),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}async getUserInfo(){if(!this.connected)throw ci.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(){var e,t;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};await super.disconnectSession();const{cleanup:s}=i;if(!this.connector||!this.connected||!((e=this.activeSession)!==null&&e!==void 0&&e.topic))throw ci.notConnectedError("Not connected with wallet");await this.connector.disconnect({topic:(t=this.activeSession)===null||t===void 0?void 0:t.topic,reason:Fe("USER_DISCONNECTED")}),this.rehydrated=!1,s?(this.connector=null,this.status=ke.NOT_READY,this.wcProvider=null):this.status=ke.READY,this.activeSession=null,await super.disconnect()}cleanupPendingPairings(){if(!this.connector)throw Ze.notReady("Wallet adapter is not ready yet");const e=this.connector.pairing.getAll({active:!1});ir(e)&&e.forEach(t=>{this.connector&&this.connector.pairing.delete(t.topic,Fe("USER_DISCONNECTED"))})}async checkForPersistedSession(){if(!this.connector)throw Ze.notReady("Wallet adapter is not ready yet");if(this.connector.session.length){const e=this.connector.session.keys.length-1;this.activeSession=this.connector.session.get(this.connector.session.keys[e])}return this.activeSession}async createNewSession(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{forceNewSession:!1};try{var t,i;if(!this.connector)throw Ze.notReady("Wallet adapter is not ready yet");if(!this.adapterOptions.loginSettings)throw Ze.notReady("login settings are not set yet");if(this.status=ke.CONNECTING,this.emit(ct.CONNECTING,{adapter:Ot.WALLET_CONNECT_V2}),e.forceNewSession&&(t=this.activeSession)!==null&&t!==void 0&&t.topic){var s;await this.connector.disconnect({topic:(s=this.activeSession)===null||s===void 0?void 0:s.topic,reason:Fe("USER_DISCONNECTED")})}et.debug("creating new session for web3auth wallet connect");const{uri:n,approval:a}=await this.connector.connect(this.adapterOptions.loginSettings),h=(i=this.adapterOptions)===null||i===void 0||(i=i.adapterSettings)===null||i===void 0?void 0:i.qrcodeModal;if(n)if(h)try{await h.openModal({uri:n}),et.debug("EVENT","QR Code Modal closed"),this.status=ke.READY,this.emit(ct.READY,Ot.WALLET_CONNECT_V2)}catch{et.error("unable to open qr code modal")}else this.updateAdapterData({uri:n,extensionAdapters:Bs});this.connector.events.once("proposal_expire",c=>{et.info("proposal expired",c),this.createNewSession({forceNewSession:!0})}),et.info("awaiting session approval from wallet");const l=await a();this.activeSession=l,await this.onConnectHandler(),h&&h.closeModal()}catch(n){throw et.error("error while creating new wallet connect session",n),this.emit(ct.ERRORED,n),n}}async onConnectHandler(){var e;if(!this.connector||!this.wcProvider)throw Ze.notReady("Wallet adapter is not ready yet");if(!this.chainConfig)throw Ze.invalidParams("Chain config is not set");(e=this.adapterOptions.adapterSettings)!==null&&e!==void 0&&e.qrcodeModal&&(this.wcProvider=new is({config:{chainConfig:this.chainConfig,skipLookupNetwork:!0},connector:this.connector})),await this.wcProvider.setupProvider(this.connector),this.subscribeEvents(),this.cleanupPendingPairings(),this.status=ke.CONNECTED,this.emit(ct.CONNECTED,{adapter:Ot.WALLET_CONNECT_V2,reconnected:this.rehydrated})}subscribeEvents(){if(!this.connector)throw Ze.notReady("Wallet adapter is not ready yet");this.connector.events.on("session_update",e=>{let{topic:t,params:i}=e;if(!this.connector)return;const{namespaces:s}=i,n=this.connector.session.get(t),a=ai(ai({},n),{},{namespaces:s});this.activeSession=a}),this.connector.events.on("session_delete",()=>{this.disconnect()})}}export{nu as DEFAULT_EIP155_METHODS,ou as DEFAULT_EIP_155_EVENTS,Bs as WALLET_CONNECT_EXTENSION_ADAPTERS,Ru as WalletConnectV2Adapter,lu as getNamespacesFromChains,du as getRequiredNamespaces,fu as getSupportedEventsByNamespace,uu as getSupportedMethodsByNamespace,pu as getWalletConnectV2Settings};

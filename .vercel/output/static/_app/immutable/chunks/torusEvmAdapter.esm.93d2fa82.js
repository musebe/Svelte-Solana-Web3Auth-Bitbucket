import{e as wt,s as Di,r as gn,_ as T,d as te,f as Ie,o as Ni,h as Ln,p as on,j as Mi,k as Pi,m as Or,n as Oi,q as Li,W as lt,A as ki,C as Ui,t as Wi,u as de,v as xt,w as Bt,x as dt,y as xi,z as kn}from"./authFunctions.2a27f1e8.js";import{i as xe,j as Be,k as Bi}from"./scheduler.e3945ab3.js";import{d as $i}from"./index.50c0c6a9.js";import{B as Hi}from"./baseEvmAdapter.esm.edc87732.js";function Fi(e,t){if(e==null)return{};var n={},r=Object.keys(e),i,a;for(a=0;a<r.length;a++)i=r[a],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}function Vi(e,t){if(e==null)return{};var n=Fi(e,t),r,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Lr={exports:{}},$t={exports:{}},z={ArrayIsArray(e){return Array.isArray(e)},ArrayPrototypeIncludes(e,t){return e.includes(t)},ArrayPrototypeIndexOf(e,t){return e.indexOf(t)},ArrayPrototypeJoin(e,t){return e.join(t)},ArrayPrototypeMap(e,t){return e.map(t)},ArrayPrototypePop(e,t){return e.pop(t)},ArrayPrototypePush(e,t){return e.push(t)},ArrayPrototypeSlice(e,t,n){return e.slice(t,n)},Error,FunctionPrototypeCall(e,t,...n){return e.call(t,...n)},FunctionPrototypeSymbolHasInstance(e,t){return Function.prototype[Symbol.hasInstance].call(e,t)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(e,t){return Object.defineProperties(e,t)},ObjectDefineProperty(e,t,n){return Object.defineProperty(e,t,n)},ObjectGetOwnPropertyDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)},ObjectKeys(e){return Object.keys(e)},ObjectSetPrototypeOf(e,t){return Object.setPrototypeOf(e,t)},Promise,PromisePrototypeCatch(e,t){return e.catch(t)},PromisePrototypeThen(e,t,n){return e.then(t,n)},PromiseReject(e){return Promise.reject(e)},ReflectApply:Reflect.apply,RegExpPrototypeTest(e,t){return e.test(t)},SafeSet:Set,String,StringPrototypeSlice(e,t,n){return e.slice(t,n)},StringPrototypeToLowerCase(e){return e.toLowerCase()},StringPrototypeToUpperCase(e){return e.toUpperCase()},StringPrototypeTrim(e){return e.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(e,t,n){return e.set(t,n)},Uint8Array},kr={exports:{}};(function(e){const t=xe,n=Object.getPrototypeOf(async function(){}).constructor,r=globalThis.Blob||t.Blob,i=typeof r<"u"?function(u){return u instanceof r}:function(u){return!1};class a extends Error{constructor(u){if(!Array.isArray(u))throw new TypeError(`Expected input to be an Array, got ${typeof u}`);let f="";for(let d=0;d<u.length;d++)f+=`    ${u[d].stack}
`;super(f),this.name="AggregateError",this.errors=u}}e.exports={AggregateError:a,kEmptyObject:Object.freeze({}),once(l){let u=!1;return function(...f){u||(u=!0,l.apply(this,f))}},createDeferredPromise:function(){let l,u;return{promise:new Promise((d,c)=>{l=d,u=c}),resolve:l,reject:u}},promisify(l){return new Promise((u,f)=>{l((d,...c)=>d?f(d):u(...c))})},debuglog(){return function(){}},format(l,...u){return l.replace(/%([sdifj])/g,function(...[f,d]){const c=u.shift();return d==="f"?c.toFixed(6):d==="j"?JSON.stringify(c):d==="s"&&typeof c=="object"?`${c.constructor!==Object?c.constructor.name:""} {}`.trim():c.toString()})},inspect(l){switch(typeof l){case"string":if(l.includes("'"))if(l.includes('"')){if(!l.includes("`")&&!l.includes("${"))return`\`${l}\``}else return`"${l}"`;return`'${l}'`;case"number":return isNaN(l)?"NaN":Object.is(l,-0)?String(l):l;case"bigint":return`${String(l)}n`;case"boolean":case"undefined":return String(l);case"object":return"{}"}},types:{isAsyncFunction(l){return l instanceof n},isArrayBufferView(l){return ArrayBuffer.isView(l)}},isBlob:i},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(kr);var Ee=kr.exports,yn={};const{format:ji,inspect:gt,AggregateError:Ki}=Ee,Gi=globalThis.AggregateError||Ki,qi=Symbol("kIsNodeError"),Yi=["string","function","number","object","Function","Object","boolean","bigint","symbol"],Xi=/^([A-Z][a-z0-9]*)+$/,zi="__node_internal_",mt={};function Ue(e,t){if(!e)throw new mt.ERR_INTERNAL_ASSERTION(t)}function Un(e){let t="",n=e.length;const r=e[0]==="-"?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function Zi(e,t,n){if(typeof t=="function")return Ue(t.length<=n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${t.length}).`),t(...n);const r=(t.match(/%[dfijoOs]/g)||[]).length;return Ue(r===n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${r}).`),n.length===0?t:ji(t,...n)}function Q(e,t,n){n||(n=Error);class r extends n{constructor(...a){super(Zi(e,t,a))}toString(){return`${this.name} [${e}]: ${this.message}`}}Object.defineProperties(r.prototype,{name:{value:n.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${e}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),r.prototype.code=e,r.prototype[qi]=!0,mt[e]=r}function Wn(e){const t=zi+e.name;return Object.defineProperty(e,"name",{value:t}),e}function Ji(e,t){if(e&&t&&e!==t){if(Array.isArray(t.errors))return t.errors.push(e),t;const n=new Gi([t,e],t.message);return n.code=t.code,n}return e||t}let Qi=class extends Error{constructor(t="The operation was aborted",n=void 0){if(n!==void 0&&typeof n!="object")throw new mt.ERR_INVALID_ARG_TYPE("options","Object",n);super(t,n),this.code="ABORT_ERR",this.name="AbortError"}};Q("ERR_ASSERTION","%s",Error);Q("ERR_INVALID_ARG_TYPE",(e,t,n)=>{Ue(typeof e=="string","'name' must be a string"),Array.isArray(t)||(t=[t]);let r="The ";e.endsWith(" argument")?r+=`${e} `:r+=`"${e}" ${e.includes(".")?"property":"argument"} `,r+="must be ";const i=[],a=[],l=[];for(const f of t)Ue(typeof f=="string","All expected entries have to be of type string"),Yi.includes(f)?i.push(f.toLowerCase()):Xi.test(f)?a.push(f):(Ue(f!=="object",'The value "object" should be written as "Object"'),l.push(f));if(a.length>0){const f=i.indexOf("object");f!==-1&&(i.splice(i,f,1),a.push("Object"))}if(i.length>0){switch(i.length){case 1:r+=`of type ${i[0]}`;break;case 2:r+=`one of type ${i[0]} or ${i[1]}`;break;default:{const f=i.pop();r+=`one of type ${i.join(", ")}, or ${f}`}}(a.length>0||l.length>0)&&(r+=" or ")}if(a.length>0){switch(a.length){case 1:r+=`an instance of ${a[0]}`;break;case 2:r+=`an instance of ${a[0]} or ${a[1]}`;break;default:{const f=a.pop();r+=`an instance of ${a.join(", ")}, or ${f}`}}l.length>0&&(r+=" or ")}switch(l.length){case 0:break;case 1:l[0].toLowerCase()!==l[0]&&(r+="an "),r+=`${l[0]}`;break;case 2:r+=`one of ${l[0]} or ${l[1]}`;break;default:{const f=l.pop();r+=`one of ${l.join(", ")}, or ${f}`}}if(n==null)r+=`. Received ${n}`;else if(typeof n=="function"&&n.name)r+=`. Received function ${n.name}`;else if(typeof n=="object"){var u;if((u=n.constructor)!==null&&u!==void 0&&u.name)r+=`. Received an instance of ${n.constructor.name}`;else{const f=gt(n,{depth:-1});r+=`. Received ${f}`}}else{let f=gt(n,{colors:!1});f.length>25&&(f=`${f.slice(0,25)}...`),r+=`. Received type ${typeof n} (${f})`}return r},TypeError);Q("ERR_INVALID_ARG_VALUE",(e,t,n="is invalid")=>{let r=gt(t);return r.length>128&&(r=r.slice(0,128)+"..."),`The ${e.includes(".")?"property":"argument"} '${e}' ${n}. Received ${r}`},TypeError);Q("ERR_INVALID_RETURN_VALUE",(e,t,n)=>{var r;const i=n!=null&&(r=n.constructor)!==null&&r!==void 0&&r.name?`instance of ${n.constructor.name}`:`type ${typeof n}`;return`Expected ${e} to be returned from the "${t}" function but got ${i}.`},TypeError);Q("ERR_MISSING_ARGS",(...e)=>{Ue(e.length>0,"At least one arg needs to be specified");let t;const n=e.length;switch(e=(Array.isArray(e)?e:[e]).map(r=>`"${r}"`).join(" or "),n){case 1:t+=`The ${e[0]} argument`;break;case 2:t+=`The ${e[0]} and ${e[1]} arguments`;break;default:{const r=e.pop();t+=`The ${e.join(", ")}, and ${r} arguments`}break}return`${t} must be specified`},TypeError);Q("ERR_OUT_OF_RANGE",(e,t,n)=>{Ue(t,'Missing "range" argument');let r;return Number.isInteger(n)&&Math.abs(n)>2**32?r=Un(String(n)):typeof n=="bigint"?(r=String(n),(n>2n**32n||n<-(2n**32n))&&(r=Un(r)),r+="n"):r=gt(n),`The value of "${e}" is out of range. It must be ${t}. Received ${r}`},RangeError);Q("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);Q("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);Q("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);Q("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);Q("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);Q("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Q("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);Q("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);Q("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);Q("ERR_STREAM_WRITE_AFTER_END","write after end",Error);Q("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var ie={AbortError:Qi,aggregateTwoErrors:Wn(Ji),hideStackFrames:Wn,codes:mt};const{ArrayIsArray:_n,ArrayPrototypeIncludes:Ur,ArrayPrototypeJoin:Wr,ArrayPrototypeMap:eo,NumberIsInteger:wn,NumberIsNaN:to,NumberMAX_SAFE_INTEGER:no,NumberMIN_SAFE_INTEGER:ro,NumberParseInt:io,ObjectPrototypeHasOwnProperty:oo,RegExpPrototypeExec:xr,String:ao,StringPrototypeToUpperCase:so,StringPrototypeTrim:lo}=z,{hideStackFrames:se,codes:{ERR_SOCKET_BAD_PORT:uo,ERR_INVALID_ARG_TYPE:ne,ERR_INVALID_ARG_VALUE:Ye,ERR_OUT_OF_RANGE:We,ERR_UNKNOWN_SIGNAL:xn}}=ie,{normalizeEncoding:fo}=Ee,{isAsyncFunction:co,isArrayBufferView:ho}=Ee.types,Bn={};function po(e){return e===(e|0)}function bo(e){return e===e>>>0}const go=/^[0-7]+$/,yo="must be a 32-bit unsigned integer or an octal string";function _o(e,t,n){if(typeof e>"u"&&(e=n),typeof e=="string"){if(xr(go,e)===null)throw new Ye(t,e,yo);e=io(e,8)}return Br(e,t),e}const wo=se((e,t,n=ro,r=no)=>{if(typeof e!="number")throw new ne(t,"number",e);if(!wn(e))throw new We(t,"an integer",e);if(e<n||e>r)throw new We(t,`>= ${n} && <= ${r}`,e)}),mo=se((e,t,n=-2147483648,r=2147483647)=>{if(typeof e!="number")throw new ne(t,"number",e);if(!wn(e))throw new We(t,"an integer",e);if(e<n||e>r)throw new We(t,`>= ${n} && <= ${r}`,e)}),Br=se((e,t,n=!1)=>{if(typeof e!="number")throw new ne(t,"number",e);if(!wn(e))throw new We(t,"an integer",e);const r=n?1:0,i=4294967295;if(e<r||e>i)throw new We(t,`>= ${r} && <= ${i}`,e)});function mn(e,t){if(typeof e!="string")throw new ne(t,"string",e)}function So(e,t,n=void 0,r){if(typeof e!="number")throw new ne(t,"number",e);if(n!=null&&e<n||r!=null&&e>r||(n!=null||r!=null)&&to(e))throw new We(t,`${n!=null?`>= ${n}`:""}${n!=null&&r!=null?" && ":""}${r!=null?`<= ${r}`:""}`,e)}const Eo=se((e,t,n)=>{if(!Ur(n,e)){const i="must be one of: "+Wr(eo(n,a=>typeof a=="string"?`'${a}'`:ao(a)),", ");throw new Ye(t,e,i)}});function $r(e,t){if(typeof e!="boolean")throw new ne(t,"boolean",e)}function Ht(e,t,n){return e==null||!oo(e,t)?n:e[t]}const Ao=se((e,t,n=null)=>{const r=Ht(n,"allowArray",!1),i=Ht(n,"allowFunction",!1);if(!Ht(n,"nullable",!1)&&e===null||!r&&_n(e)||typeof e!="object"&&(!i||typeof e!="function"))throw new ne(t,"Object",e)}),Ro=se((e,t)=>{if(e!=null&&typeof e!="object"&&typeof e!="function")throw new ne(t,"a dictionary",e)}),Sn=se((e,t,n=0)=>{if(!_n(e))throw new ne(t,"Array",e);if(e.length<n){const r=`must be longer than ${n}`;throw new Ye(t,e,r)}});function To(e,t){Sn(e,t);for(let n=0;n<e.length;n++)mn(e[n],`${t}[${n}]`)}function Io(e,t){Sn(e,t);for(let n=0;n<e.length;n++)$r(e[n],`${t}[${n}]`)}function Co(e,t="signal"){if(mn(e,t),Bn[e]===void 0)throw Bn[so(e)]!==void 0?new xn(e+" (signals must use all capital letters)"):new xn(e)}const vo=se((e,t="buffer")=>{if(!ho(e))throw new ne(t,["Buffer","TypedArray","DataView"],e)});function Do(e,t){const n=fo(t),r=e.length;if(n==="hex"&&r%2!==0)throw new Ye("encoding",t,`is invalid for data of length ${r}`)}function No(e,t="Port",n=!0){if(typeof e!="number"&&typeof e!="string"||typeof e=="string"&&lo(e).length===0||+e!==+e>>>0||e>65535||e===0&&!n)throw new uo(t,e,n);return e|0}const Mo=se((e,t)=>{if(e!==void 0&&(e===null||typeof e!="object"||!("aborted"in e)))throw new ne(t,"AbortSignal",e)}),Po=se((e,t)=>{if(typeof e!="function")throw new ne(t,"Function",e)}),Oo=se((e,t)=>{if(typeof e!="function"||co(e))throw new ne(t,"Function",e)}),Lo=se((e,t)=>{if(e!==void 0)throw new ne(t,"undefined",e)});function ko(e,t,n){if(!Ur(n,e))throw new ne(t,`('${Wr(n,"|")}')`,e)}const Uo=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function $n(e,t){if(typeof e>"u"||!xr(Uo,e))throw new Ye(t,e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function Wo(e){if(typeof e=="string")return $n(e,"hints"),e;if(_n(e)){const t=e.length;let n="";if(t===0)return n;for(let r=0;r<t;r++){const i=e[r];$n(i,"hints"),n+=i,r!==t-1&&(n+=", ")}return n}throw new Ye("hints",e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var St={isInt32:po,isUint32:bo,parseFileMode:_o,validateArray:Sn,validateStringArray:To,validateBooleanArray:Io,validateBoolean:$r,validateBuffer:vo,validateDictionary:Ro,validateEncoding:Do,validateFunction:Po,validateInt32:mo,validateInteger:wo,validateNumber:So,validateObject:Ao,validateOneOf:Eo,validatePlainFunction:Oo,validatePort:No,validateSignalName:Co,validateString:mn,validateUint32:Br,validateUndefined:Lo,validateUnion:ko,validateAbortSignal:Mo,validateLinkHeaderValue:Wo},En={exports:{}};const{Symbol:Et,SymbolAsyncIterator:Hn,SymbolIterator:Fn,SymbolFor:Hr}=z,Fr=Et("kDestroyed"),Vr=Et("kIsErrored"),an=Et("kIsReadable"),jr=Et("kIsDisturbed"),xo=Hr("nodejs.webstream.isClosedPromise"),Bo=Hr("nodejs.webstream.controllerErrorFunction");function At(e,t=!1){var n;return!!(e&&typeof e.pipe=="function"&&typeof e.on=="function"&&(!t||typeof e.pause=="function"&&typeof e.resume=="function")&&(!e._writableState||((n=e._readableState)===null||n===void 0?void 0:n.readable)!==!1)&&(!e._writableState||e._readableState))}function Rt(e){var t;return!!(e&&typeof e.write=="function"&&typeof e.on=="function"&&(!e._readableState||((t=e._writableState)===null||t===void 0?void 0:t.writable)!==!1))}function $o(e){return!!(e&&typeof e.pipe=="function"&&e._readableState&&typeof e.on=="function"&&typeof e.write=="function")}function be(e){return e&&(e._readableState||e._writableState||typeof e.write=="function"&&typeof e.on=="function"||typeof e.pipe=="function"&&typeof e.on=="function")}function Kr(e){return!!(e&&!be(e)&&typeof e.pipeThrough=="function"&&typeof e.getReader=="function"&&typeof e.cancel=="function")}function Gr(e){return!!(e&&!be(e)&&typeof e.getWriter=="function"&&typeof e.abort=="function")}function qr(e){return!!(e&&!be(e)&&typeof e.readable=="object"&&typeof e.writable=="object")}function Ho(e){return Kr(e)||Gr(e)||qr(e)}function Fo(e,t){return e==null?!1:t===!0?typeof e[Hn]=="function":t===!1?typeof e[Fn]=="function":typeof e[Hn]=="function"||typeof e[Fn]=="function"}function Tt(e){if(!be(e))return null;const t=e._writableState,n=e._readableState,r=t||n;return!!(e.destroyed||e[Fr]||r!=null&&r.destroyed)}function Yr(e){if(!Rt(e))return null;if(e.writableEnded===!0)return!0;const t=e._writableState;return t!=null&&t.errored?!1:typeof(t==null?void 0:t.ended)!="boolean"?null:t.ended}function Vo(e,t){if(!Rt(e))return null;if(e.writableFinished===!0)return!0;const n=e._writableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.finished)!="boolean"?null:!!(n.finished||t===!1&&n.ended===!0&&n.length===0)}function jo(e){if(!At(e))return null;if(e.readableEnded===!0)return!0;const t=e._readableState;return!t||t.errored?!1:typeof(t==null?void 0:t.ended)!="boolean"?null:t.ended}function Xr(e,t){if(!At(e))return null;const n=e._readableState;return n!=null&&n.errored?!1:typeof(n==null?void 0:n.endEmitted)!="boolean"?null:!!(n.endEmitted||t===!1&&n.ended===!0&&n.length===0)}function zr(e){return e&&e[an]!=null?e[an]:typeof(e==null?void 0:e.readable)!="boolean"?null:Tt(e)?!1:At(e)&&e.readable&&!Xr(e)}function Zr(e){return typeof(e==null?void 0:e.writable)!="boolean"?null:Tt(e)?!1:Rt(e)&&e.writable&&!Yr(e)}function Ko(e,t){return be(e)?Tt(e)?!0:!((t==null?void 0:t.readable)!==!1&&zr(e)||(t==null?void 0:t.writable)!==!1&&Zr(e)):null}function Go(e){var t,n;return be(e)?e.writableErrored?e.writableErrored:(t=(n=e._writableState)===null||n===void 0?void 0:n.errored)!==null&&t!==void 0?t:null:null}function qo(e){var t,n;return be(e)?e.readableErrored?e.readableErrored:(t=(n=e._readableState)===null||n===void 0?void 0:n.errored)!==null&&t!==void 0?t:null:null}function Yo(e){if(!be(e))return null;if(typeof e.closed=="boolean")return e.closed;const t=e._writableState,n=e._readableState;return typeof(t==null?void 0:t.closed)=="boolean"||typeof(n==null?void 0:n.closed)=="boolean"?(t==null?void 0:t.closed)||(n==null?void 0:n.closed):typeof e._closed=="boolean"&&Jr(e)?e._closed:null}function Jr(e){return typeof e._closed=="boolean"&&typeof e._defaultKeepAlive=="boolean"&&typeof e._removedConnection=="boolean"&&typeof e._removedContLen=="boolean"}function Qr(e){return typeof e._sent100=="boolean"&&Jr(e)}function Xo(e){var t;return typeof e._consuming=="boolean"&&typeof e._dumped=="boolean"&&((t=e.req)===null||t===void 0?void 0:t.upgradeOrConnect)===void 0}function zo(e){if(!be(e))return null;const t=e._writableState,n=e._readableState,r=t||n;return!r&&Qr(e)||!!(r&&r.autoDestroy&&r.emitClose&&r.closed===!1)}function Zo(e){var t;return!!(e&&((t=e[jr])!==null&&t!==void 0?t:e.readableDidRead||e.readableAborted))}function Jo(e){var t,n,r,i,a,l,u,f,d,c;return!!(e&&((t=(n=(r=(i=(a=(l=e[Vr])!==null&&l!==void 0?l:e.readableErrored)!==null&&a!==void 0?a:e.writableErrored)!==null&&i!==void 0?i:(u=e._readableState)===null||u===void 0?void 0:u.errorEmitted)!==null&&r!==void 0?r:(f=e._writableState)===null||f===void 0?void 0:f.errorEmitted)!==null&&n!==void 0?n:(d=e._readableState)===null||d===void 0?void 0:d.errored)!==null&&t!==void 0?t:!((c=e._writableState)===null||c===void 0)&&c.errored))}var Ae={kDestroyed:Fr,isDisturbed:Zo,kIsDisturbed:jr,isErrored:Jo,kIsErrored:Vr,isReadable:zr,kIsReadable:an,kIsClosedPromise:xo,kControllerErrorFunction:Bo,isClosed:Yo,isDestroyed:Tt,isDuplexNodeStream:$o,isFinished:Ko,isIterable:Fo,isReadableNodeStream:At,isReadableStream:Kr,isReadableEnded:jo,isReadableFinished:Xr,isReadableErrored:qo,isNodeStream:be,isWebStream:Ho,isWritable:Zr,isWritableNodeStream:Rt,isWritableStream:Gr,isWritableEnded:Yr,isWritableFinished:Vo,isWritableErrored:Go,isServerRequest:Xo,isServerResponse:Qr,willEmitClose:zo,isTransformStream:qr};const Te=Be,{AbortError:ei,codes:Qo}=ie,{ERR_INVALID_ARG_TYPE:ea,ERR_STREAM_PREMATURE_CLOSE:Vn}=Qo,{kEmptyObject:sn,once:ln}=Ee,{validateAbortSignal:ta,validateFunction:na,validateObject:ra,validateBoolean:ia}=St,{Promise:oa,PromisePrototypeThen:aa}=z,{isClosed:sa,isReadable:jn,isReadableNodeStream:Ft,isReadableStream:la,isReadableFinished:Kn,isReadableErrored:Gn,isWritable:qn,isWritableNodeStream:Yn,isWritableStream:da,isWritableFinished:Xn,isWritableErrored:zn,isNodeStream:ua,willEmitClose:fa,kIsClosedPromise:ca}=Ae;function ha(e){return e.setHeader&&typeof e.abort=="function"}const dn=()=>{};function ti(e,t,n){var r,i;if(arguments.length===2?(n=t,t=sn):t==null?t=sn:ra(t,"options"),na(n,"callback"),ta(t.signal,"options.signal"),n=ln(n),la(e)||da(e))return pa(e,t,n);if(!ua(e))throw new ea("stream",["ReadableStream","WritableStream","Stream"],e);const a=(r=t.readable)!==null&&r!==void 0?r:Ft(e),l=(i=t.writable)!==null&&i!==void 0?i:Yn(e),u=e._writableState,f=e._readableState,d=()=>{e.writable||A()};let c=fa(e)&&Ft(e)===a&&Yn(e)===l,_=Xn(e,!1);const A=()=>{_=!0,e.destroyed&&(c=!1),!(c&&(!e.readable||a))&&(!a||g)&&n.call(e)};let g=Kn(e,!1);const b=()=>{g=!0,e.destroyed&&(c=!1),!(c&&(!e.writable||l))&&(!l||_)&&n.call(e)},P=O=>{n.call(e,O)};let N=sa(e);const I=()=>{N=!0;const O=zn(e)||Gn(e);if(O&&typeof O!="boolean")return n.call(e,O);if(a&&!g&&Ft(e,!0)&&!Kn(e,!1))return n.call(e,new Vn);if(l&&!_&&!Xn(e,!1))return n.call(e,new Vn);n.call(e)},w=()=>{N=!0;const O=zn(e)||Gn(e);if(O&&typeof O!="boolean")return n.call(e,O);n.call(e)},L=()=>{e.req.on("finish",A)};ha(e)?(e.on("complete",A),c||e.on("abort",I),e.req?L():e.on("request",L)):l&&!u&&(e.on("end",d),e.on("close",d)),!c&&typeof e.aborted=="boolean"&&e.on("aborted",I),e.on("end",b),e.on("finish",A),t.error!==!1&&e.on("error",P),e.on("close",I),N?Te.nextTick(I):u!=null&&u.errorEmitted||f!=null&&f.errorEmitted?c||Te.nextTick(w):(!a&&(!c||jn(e))&&(_||qn(e)===!1)||!l&&(!c||qn(e))&&(g||jn(e)===!1)||f&&e.req&&e.aborted)&&Te.nextTick(w);const $=()=>{n=dn,e.removeListener("aborted",I),e.removeListener("complete",A),e.removeListener("abort",I),e.removeListener("request",L),e.req&&e.req.removeListener("finish",A),e.removeListener("end",d),e.removeListener("close",d),e.removeListener("finish",A),e.removeListener("end",b),e.removeListener("error",P),e.removeListener("close",I)};if(t.signal&&!N){const O=()=>{const Y=n;$(),Y.call(e,new ei(void 0,{cause:t.signal.reason}))};if(t.signal.aborted)Te.nextTick(O);else{const Y=n;n=ln((...F)=>{t.signal.removeEventListener("abort",O),Y.apply(e,F)}),t.signal.addEventListener("abort",O)}}return $}function pa(e,t,n){let r=!1,i=dn;if(t.signal)if(i=()=>{r=!0,n.call(e,new ei(void 0,{cause:t.signal.reason}))},t.signal.aborted)Te.nextTick(i);else{const l=n;n=ln((...u)=>{t.signal.removeEventListener("abort",i),l.apply(e,u)}),t.signal.addEventListener("abort",i)}const a=(...l)=>{r||Te.nextTick(()=>n.apply(e,l))};return aa(e[ca].promise,a,a),dn}function ba(e,t){var n;let r=!1;return t===null&&(t=sn),(n=t)!==null&&n!==void 0&&n.cleanup&&(ia(t.cleanup,"cleanup"),r=t.cleanup),new oa((i,a)=>{const l=ti(e,t,u=>{r&&l(),u?a(u):i()})})}En.exports=ti;En.exports.finished=ba;var Ce=En.exports;const he=Be,{aggregateTwoErrors:ga,codes:{ERR_MULTIPLE_CALLBACK:ya},AbortError:_a}=ie,{Symbol:ni}=z,{kDestroyed:wa,isDestroyed:ma,isFinished:Sa,isServerRequest:Ea}=Ae,ri=ni("kDestroy"),un=ni("kConstruct");function ii(e,t,n){e&&(e.stack,t&&!t.errored&&(t.errored=e),n&&!n.errored&&(n.errored=e))}function Aa(e,t){const n=this._readableState,r=this._writableState,i=r||n;return r!=null&&r.destroyed||n!=null&&n.destroyed?(typeof t=="function"&&t(),this):(ii(e,r,n),r&&(r.destroyed=!0),n&&(n.destroyed=!0),i.constructed?Zn(this,e,t):this.once(ri,function(a){Zn(this,ga(a,e),t)}),this)}function Zn(e,t,n){let r=!1;function i(a){if(r)return;r=!0;const l=e._readableState,u=e._writableState;ii(a,u,l),u&&(u.closed=!0),l&&(l.closed=!0),typeof n=="function"&&n(a),a?he.nextTick(Ra,e,a):he.nextTick(oi,e)}try{e._destroy(t||null,i)}catch(a){i(a)}}function Ra(e,t){fn(e,t),oi(e)}function oi(e){const t=e._readableState,n=e._writableState;n&&(n.closeEmitted=!0),t&&(t.closeEmitted=!0),(n!=null&&n.emitClose||t!=null&&t.emitClose)&&e.emit("close")}function fn(e,t){const n=e._readableState,r=e._writableState;r!=null&&r.errorEmitted||n!=null&&n.errorEmitted||(r&&(r.errorEmitted=!0),n&&(n.errorEmitted=!0),e.emit("error",t))}function Ta(){const e=this._readableState,t=this._writableState;e&&(e.constructed=!0,e.closed=!1,e.closeEmitted=!1,e.destroyed=!1,e.errored=null,e.errorEmitted=!1,e.reading=!1,e.ended=e.readable===!1,e.endEmitted=e.readable===!1),t&&(t.constructed=!0,t.destroyed=!1,t.closed=!1,t.closeEmitted=!1,t.errored=null,t.errorEmitted=!1,t.finalCalled=!1,t.prefinished=!1,t.ended=t.writable===!1,t.ending=t.writable===!1,t.finished=t.writable===!1)}function cn(e,t,n){const r=e._readableState,i=e._writableState;if(i!=null&&i.destroyed||r!=null&&r.destroyed)return this;r!=null&&r.autoDestroy||i!=null&&i.autoDestroy?e.destroy(t):t&&(t.stack,i&&!i.errored&&(i.errored=t),r&&!r.errored&&(r.errored=t),n?he.nextTick(fn,e,t):fn(e,t))}function Ia(e,t){if(typeof e._construct!="function")return;const n=e._readableState,r=e._writableState;n&&(n.constructed=!1),r&&(r.constructed=!1),e.once(un,t),!(e.listenerCount(un)>1)&&he.nextTick(Ca,e)}function Ca(e){let t=!1;function n(r){if(t){cn(e,r??new ya);return}t=!0;const i=e._readableState,a=e._writableState,l=a||i;i&&(i.constructed=!0),a&&(a.constructed=!0),l.destroyed?e.emit(ri,r):r?cn(e,r,!0):he.nextTick(va,e)}try{e._construct(r=>{he.nextTick(n,r)})}catch(r){he.nextTick(n,r)}}function va(e){e.emit(un)}function Jn(e){return(e==null?void 0:e.setHeader)&&typeof e.abort=="function"}function ai(e){e.emit("close")}function Da(e,t){e.emit("error",t),he.nextTick(ai,e)}function Na(e,t){!e||ma(e)||(!t&&!Sa(e)&&(t=new _a),Ea(e)?(e.socket=null,e.destroy(t)):Jn(e)?e.abort():Jn(e.req)?e.req.abort():typeof e.destroy=="function"?e.destroy(t):typeof e.close=="function"?e.close():t?he.nextTick(Da,e,t):he.nextTick(ai,e),e.destroyed||(e[wa]=!0))}var Xe={construct:Ia,destroyer:Na,destroy:Aa,undestroy:Ta,errorOrDestroy:cn};const{ArrayIsArray:Ma,ObjectSetPrototypeOf:si}=z,{EventEmitter:It}=wt;function Ct(e){It.call(this,e)}si(Ct.prototype,It.prototype);si(Ct,It);Ct.prototype.pipe=function(e,t){const n=this;function r(c){e.writable&&e.write(c)===!1&&n.pause&&n.pause()}n.on("data",r);function i(){n.readable&&n.resume&&n.resume()}e.on("drain",i),!e._isStdio&&(!t||t.end!==!1)&&(n.on("end",l),n.on("close",u));let a=!1;function l(){a||(a=!0,e.end())}function u(){a||(a=!0,typeof e.destroy=="function"&&e.destroy())}function f(c){d(),It.listenerCount(this,"error")===0&&this.emit("error",c)}hn(n,"error",f),hn(e,"error",f);function d(){n.removeListener("data",r),e.removeListener("drain",i),n.removeListener("end",l),n.removeListener("close",u),n.removeListener("error",f),e.removeListener("error",f),n.removeListener("end",d),n.removeListener("close",d),e.removeListener("close",d)}return n.on("end",d),n.on("close",d),e.on("close",d),e.emit("pipe",n),e};function hn(e,t,n){if(typeof e.prependListener=="function")return e.prependListener(t,n);!e._events||!e._events[t]?e.on(t,n):Ma(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]}var An={Stream:Ct,prependListener:hn},li={exports:{}};(function(e){const{AbortError:t,codes:n}=ie,{isNodeStream:r,isWebStream:i,kControllerErrorFunction:a}=Ae,l=Ce,{ERR_INVALID_ARG_TYPE:u}=n,f=(d,c)=>{if(typeof d!="object"||!("aborted"in d))throw new u(c,"AbortSignal",d)};e.exports.addAbortSignal=function(c,_){if(f(c,"signal"),!r(_)&&!i(_))throw new u("stream",["ReadableStream","WritableStream","Stream"],_);return e.exports.addAbortSignalNoValidate(c,_)},e.exports.addAbortSignalNoValidate=function(d,c){if(typeof d!="object"||!("aborted"in d))return c;const _=r(c)?()=>{c.destroy(new t(void 0,{cause:d.reason}))}:()=>{c[a](new t(void 0,{cause:d.reason}))};return d.aborted?_():(d.addEventListener("abort",_),l(c,()=>d.removeEventListener("abort",_))),c}})(li);var vt=li.exports;const{StringPrototypeSlice:Qn,SymbolIterator:Pa,TypedArrayPrototypeSet:ut,Uint8Array:Oa}=z,{Buffer:Vt}=xe,{inspect:La}=Ee;var ka=class{constructor(){this.head=null,this.tail=null,this.length=0}push(t){const n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}unshift(t){const n={data:t,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}shift(){if(this.length===0)return;const t=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,t}clear(){this.head=this.tail=null,this.length=0}join(t){if(this.length===0)return"";let n=this.head,r=""+n.data;for(;(n=n.next)!==null;)r+=t+n.data;return r}concat(t){if(this.length===0)return Vt.alloc(0);const n=Vt.allocUnsafe(t>>>0);let r=this.head,i=0;for(;r;)ut(n,r.data,i),i+=r.data.length,r=r.next;return n}consume(t,n){const r=this.head.data;if(t<r.length){const i=r.slice(0,t);return this.head.data=r.slice(t),i}return t===r.length?this.shift():n?this._getString(t):this._getBuffer(t)}first(){return this.head.data}*[Pa](){for(let t=this.head;t;t=t.next)yield t.data}_getString(t){let n="",r=this.head,i=0;do{const a=r.data;if(t>a.length)n+=a,t-=a.length;else{t===a.length?(n+=a,++i,r.next?this.head=r.next:this.head=this.tail=null):(n+=Qn(a,0,t),this.head=r,r.data=Qn(a,t));break}++i}while((r=r.next)!==null);return this.length-=i,n}_getBuffer(t){const n=Vt.allocUnsafe(t),r=t;let i=this.head,a=0;do{const l=i.data;if(t>l.length)ut(n,l,r-t),t-=l.length;else{t===l.length?(ut(n,l,r-t),++a,i.next?this.head=i.next:this.head=this.tail=null):(ut(n,new Oa(l.buffer,l.byteOffset,t),r-t),this.head=i,i.data=l.slice(t));break}++a}while((i=i.next)!==null);return this.length-=a,n}[Symbol.for("nodejs.util.inspect.custom")](t,n){return La(this,{...n,depth:0,customInspect:!1})}};const{MathFloor:Ua,NumberIsInteger:Wa}=z,{ERR_INVALID_ARG_VALUE:xa}=ie.codes;function Ba(e,t,n){return e.highWaterMark!=null?e.highWaterMark:t?e[n]:null}function di(e){return e?16:16*1024}function $a(e,t,n,r){const i=Ba(t,r,n);if(i!=null){if(!Wa(i)||i<0){const a=r?`options.${n}`:"options.highWaterMark";throw new xa(a,i)}return Ua(i)}return di(e.objectMode)}var Rn={getHighWaterMark:$a,getDefaultHighWaterMark:di};const er=Be,{PromisePrototypeThen:Ha,SymbolAsyncIterator:tr,SymbolIterator:nr}=z,{Buffer:Fa}=xe,{ERR_INVALID_ARG_TYPE:Va,ERR_STREAM_NULL_VALUES:ja}=ie.codes;function Ka(e,t,n){let r;if(typeof t=="string"||t instanceof Fa)return new e({objectMode:!0,...n,read(){this.push(t),this.push(null)}});let i;if(t&&t[tr])i=!0,r=t[tr]();else if(t&&t[nr])i=!1,r=t[nr]();else throw new Va("iterable",["Iterable"],t);const a=new e({objectMode:!0,highWaterMark:1,...n});let l=!1;a._read=function(){l||(l=!0,f())},a._destroy=function(d,c){Ha(u(d),()=>er.nextTick(c,d),_=>er.nextTick(c,_||d))};async function u(d){const c=d!=null,_=typeof r.throw=="function";if(c&&_){const{value:A,done:g}=await r.throw(d);if(await A,g)return}if(typeof r.return=="function"){const{value:A}=await r.return();await A}}async function f(){for(;;){try{const{value:d,done:c}=i?await r.next():r.next();if(c)a.push(null);else{const _=d&&typeof d.then=="function"?await d:d;if(_===null)throw l=!1,new ja;if(a.push(_))continue;l=!1}}catch(d){a.destroy(d)}break}}return a}var ui=Ka,jt,rr;function Dt(){if(rr)return jt;rr=1;const e=Be,{ArrayPrototypeIndexOf:t,NumberIsInteger:n,NumberIsNaN:r,NumberParseInt:i,ObjectDefineProperties:a,ObjectKeys:l,ObjectSetPrototypeOf:u,Promise:f,SafeSet:d,SymbolAsyncIterator:c,Symbol:_}=z;jt=S,S.ReadableState=le;const{EventEmitter:A}=wt,{Stream:g,prependListener:b}=An,{Buffer:P}=xe,{addAbortSignal:N}=vt,I=Ce;let w=Ee.debuglog("stream",o=>{w=o});const L=ka,$=Xe,{getHighWaterMark:O,getDefaultHighWaterMark:Y}=Rn,{aggregateTwoErrors:F,codes:{ERR_INVALID_ARG_TYPE:q,ERR_METHOD_NOT_IMPLEMENTED:K,ERR_OUT_OF_RANGE:m,ERR_STREAM_PUSH_AFTER_EOF:k,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:Z}}=ie,{validateObject:U}=St,W=_("kPaused"),{StringDecoder:M}=Di,X=ui;u(S.prototype,g.prototype),u(S,g);const J=()=>{},{errorOrDestroy:B}=$;function le(o,s,E){typeof E!="boolean"&&(E=s instanceof me()),this.objectMode=!!(o&&o.objectMode),E&&(this.objectMode=this.objectMode||!!(o&&o.readableObjectMode)),this.highWaterMark=o?O(this,o,"readableHighWaterMark",E):Y(!1),this.buffer=new L,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[W]=null,this.errorEmitted=!1,this.emitClose=!o||o.emitClose!==!1,this.autoDestroy=!o||o.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=o&&o.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,o&&o.encoding&&(this.decoder=new M(o.encoding),this.encoding=o.encoding)}function S(o){if(!(this instanceof S))return new S(o);const s=this instanceof me();this._readableState=new le(o,this,s),o&&(typeof o.read=="function"&&(this._read=o.read),typeof o.destroy=="function"&&(this._destroy=o.destroy),typeof o.construct=="function"&&(this._construct=o.construct),o.signal&&!s&&N(o.signal,this)),g.call(this,o),$.construct(this,()=>{this._readableState.needReadable&&Re(this,this._readableState)})}S.prototype.destroy=$.destroy,S.prototype._undestroy=$.undestroy,S.prototype._destroy=function(o,s){s(o)},S.prototype[A.captureRejectionSymbol]=function(o){this.destroy(o)},S.prototype.push=function(o,s){return re(this,o,s,!1)},S.prototype.unshift=function(o,s){return re(this,o,s,!0)};function re(o,s,E,R){w("readableAddChunk",s);const C=o._readableState;let ee;if(C.objectMode||(typeof s=="string"?(E=E||C.defaultEncoding,C.encoding!==E&&(R&&C.encoding?s=P.from(s,E).toString(C.encoding):(s=P.from(s,E),E=""))):s instanceof P?E="":g._isUint8Array(s)?(s=g._uint8ArrayToBuffer(s),E=""):s!=null&&(ee=new q("chunk",["string","Buffer","Uint8Array"],s))),ee)B(o,ee);else if(s===null)C.reading=!1,Ot(o,C);else if(C.objectMode||s&&s.length>0)if(R)if(C.endEmitted)B(o,new Z);else{if(C.destroyed||C.errored)return!1;ge(o,C,s,!0)}else if(C.ended)B(o,new k);else{if(C.destroyed||C.errored)return!1;C.reading=!1,C.decoder&&!E?(s=C.decoder.write(s),C.objectMode||s.length!==0?ge(o,C,s,!1):Re(o,C)):ge(o,C,s,!1)}else R||(C.reading=!1,Re(o,C));return!C.ended&&(C.length<C.highWaterMark||C.length===0)}function ge(o,s,E,R){s.flowing&&s.length===0&&!s.sync&&o.listenerCount("data")>0?(s.multiAwaitDrain?s.awaitDrainWriters.clear():s.awaitDrainWriters=null,s.dataEmitted=!0,o.emit("data",E)):(s.length+=s.objectMode?1:E.length,R?s.buffer.unshift(E):s.buffer.push(E),s.needReadable&&Fe(o)),Re(o,s)}S.prototype.isPaused=function(){const o=this._readableState;return o[W]===!0||o.flowing===!1},S.prototype.setEncoding=function(o){const s=new M(o);this._readableState.decoder=s,this._readableState.encoding=this._readableState.decoder.encoding;const E=this._readableState.buffer;let R="";for(const C of E)R+=s.write(C);return E.clear(),R!==""&&E.push(R),this._readableState.length=R.length,this};const ze=1073741824;function Ze(o){if(o>ze)throw new m("size","<= 1GiB",o);return o--,o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,o|=o>>>16,o++,o}function ve(o,s){return o<=0||s.length===0&&s.ended?0:s.objectMode?1:r(o)?s.flowing&&s.length?s.buffer.first().length:s.length:o<=s.length?o:s.ended?s.length:0}S.prototype.read=function(o){w("read",o),o===void 0?o=NaN:n(o)||(o=i(o,10));const s=this._readableState,E=o;if(o>s.highWaterMark&&(s.highWaterMark=Ze(o)),o!==0&&(s.emittedReadable=!1),o===0&&s.needReadable&&((s.highWaterMark!==0?s.length>=s.highWaterMark:s.length>0)||s.ended))return w("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?ue(this):Fe(this),null;if(o=ve(o,s),o===0&&s.ended)return s.length===0&&ue(this),null;let R=s.needReadable;if(w("need readable",R),(s.length===0||s.length-o<s.highWaterMark)&&(R=!0,w("length less than watermark",R)),s.ended||s.reading||s.destroyed||s.errored||!s.constructed)R=!1,w("reading, ended or constructing",R);else if(R){w("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0);try{this._read(s.highWaterMark)}catch(ee){B(this,ee)}s.sync=!1,s.reading||(o=ve(E,s))}let C;return o>0?C=V(o,s):C=null,C===null?(s.needReadable=s.length<=s.highWaterMark,o=0):(s.length-=o,s.multiAwaitDrain?s.awaitDrainWriters.clear():s.awaitDrainWriters=null),s.length===0&&(s.ended||(s.needReadable=!0),E!==o&&s.ended&&ue(this)),C!==null&&!s.errorEmitted&&!s.closeEmitted&&(s.dataEmitted=!0,this.emit("data",C)),C};function Ot(o,s){if(w("onEofChunk"),!s.ended){if(s.decoder){const E=s.decoder.end();E&&E.length&&(s.buffer.push(E),s.length+=s.objectMode?1:E.length)}s.ended=!0,s.sync?Fe(o):(s.needReadable=!1,s.emittedReadable=!0,Ve(o))}}function Fe(o){const s=o._readableState;w("emitReadable",s.needReadable,s.emittedReadable),s.needReadable=!1,s.emittedReadable||(w("emitReadable",s.flowing),s.emittedReadable=!0,e.nextTick(Ve,o))}function Ve(o){const s=o._readableState;w("emitReadable_",s.destroyed,s.length,s.ended),!s.destroyed&&!s.errored&&(s.length||s.ended)&&(o.emit("readable"),s.emittedReadable=!1),s.needReadable=!s.flowing&&!s.ended&&s.length<=s.highWaterMark,v(o)}function Re(o,s){!s.readingMore&&s.constructed&&(s.readingMore=!0,e.nextTick(Lt,o,s))}function Lt(o,s){for(;!s.reading&&!s.ended&&(s.length<s.highWaterMark||s.flowing&&s.length===0);){const E=s.length;if(w("maybeReadMore read 0"),o.read(0),E===s.length)break}s.readingMore=!1}S.prototype._read=function(o){throw new K("_read()")},S.prototype.pipe=function(o,s){const E=this,R=this._readableState;R.pipes.length===1&&(R.multiAwaitDrain||(R.multiAwaitDrain=!0,R.awaitDrainWriters=new d(R.awaitDrainWriters?[R.awaitDrainWriters]:[]))),R.pipes.push(o),w("pipe count=%d opts=%j",R.pipes.length,s);const ee=(!s||s.end!==!1)&&o!==e.stdout&&o!==e.stderr?Nn:tt;R.endEmitted?e.nextTick(ee):E.once("end",ee),o.on("unpipe",oe);function oe(Ne,_e){w("onunpipe"),Ne===E&&_e&&_e.hasUnpiped===!1&&(_e.hasUnpiped=!0,vi())}function Nn(){w("onend"),o.end()}let De,Mn=!1;function vi(){w("cleanup"),o.removeListener("close",Ut),o.removeListener("finish",Wt),De&&o.removeListener("drain",De),o.removeListener("error",kt),o.removeListener("unpipe",oe),E.removeListener("end",Nn),E.removeListener("end",tt),E.removeListener("data",On),Mn=!0,De&&R.awaitDrainWriters&&(!o._writableState||o._writableState.needDrain)&&De()}function Pn(){Mn||(R.pipes.length===1&&R.pipes[0]===o?(w("false write response, pause",0),R.awaitDrainWriters=o,R.multiAwaitDrain=!1):R.pipes.length>1&&R.pipes.includes(o)&&(w("false write response, pause",R.awaitDrainWriters.size),R.awaitDrainWriters.add(o)),E.pause()),De||(De=Je(E,o),o.on("drain",De))}E.on("data",On);function On(Ne){w("ondata");const _e=o.write(Ne);w("dest.write",_e),_e===!1&&Pn()}function kt(Ne){if(w("onerror",Ne),tt(),o.removeListener("error",kt),o.listenerCount("error")===0){const _e=o._writableState||o._readableState;_e&&!_e.errorEmitted?B(o,Ne):o.emit("error",Ne)}}b(o,"error",kt);function Ut(){o.removeListener("finish",Wt),tt()}o.once("close",Ut);function Wt(){w("onfinish"),o.removeListener("close",Ut),tt()}o.once("finish",Wt);function tt(){w("unpipe"),E.unpipe(o)}return o.emit("pipe",E),o.writableNeedDrain===!0?R.flowing&&Pn():R.flowing||(w("pipe resume"),E.resume()),o};function Je(o,s){return function(){const R=o._readableState;R.awaitDrainWriters===s?(w("pipeOnDrain",1),R.awaitDrainWriters=null):R.multiAwaitDrain&&(w("pipeOnDrain",R.awaitDrainWriters.size),R.awaitDrainWriters.delete(s)),(!R.awaitDrainWriters||R.awaitDrainWriters.size===0)&&o.listenerCount("data")&&o.resume()}}S.prototype.unpipe=function(o){const s=this._readableState,E={hasUnpiped:!1};if(s.pipes.length===0)return this;if(!o){const C=s.pipes;s.pipes=[],this.pause();for(let ee=0;ee<C.length;ee++)C[ee].emit("unpipe",this,{hasUnpiped:!1});return this}const R=t(s.pipes,o);return R===-1?this:(s.pipes.splice(R,1),s.pipes.length===0&&this.pause(),o.emit("unpipe",this,E),this)},S.prototype.on=function(o,s){const E=g.prototype.on.call(this,o,s),R=this._readableState;return o==="data"?(R.readableListening=this.listenerCount("readable")>0,R.flowing!==!1&&this.resume()):o==="readable"&&!R.endEmitted&&!R.readableListening&&(R.readableListening=R.needReadable=!0,R.flowing=!1,R.emittedReadable=!1,w("on readable",R.length,R.reading),R.length?Fe(this):R.reading||e.nextTick(h,this)),E},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(o,s){const E=g.prototype.removeListener.call(this,o,s);return o==="readable"&&e.nextTick(Qe,this),E},S.prototype.off=S.prototype.removeListener,S.prototype.removeAllListeners=function(o){const s=g.prototype.removeAllListeners.apply(this,arguments);return(o==="readable"||o===void 0)&&e.nextTick(Qe,this),s};function Qe(o){const s=o._readableState;s.readableListening=o.listenerCount("readable")>0,s.resumeScheduled&&s[W]===!1?s.flowing=!0:o.listenerCount("data")>0?o.resume():s.readableListening||(s.flowing=null)}function h(o){w("readable nexttick read 0"),o.read(0)}S.prototype.resume=function(){const o=this._readableState;return o.flowing||(w("resume"),o.flowing=!o.readableListening,p(this,o)),o[W]=!1,this};function p(o,s){s.resumeScheduled||(s.resumeScheduled=!0,e.nextTick(y,o,s))}function y(o,s){w("resume",s.reading),s.reading||o.read(0),s.resumeScheduled=!1,o.emit("resume"),v(o),s.flowing&&!s.reading&&o.read(0)}S.prototype.pause=function(){return w("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(w("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[W]=!0,this};function v(o){const s=o._readableState;for(w("flow",s.flowing);s.flowing&&o.read()!==null;);}S.prototype.wrap=function(o){let s=!1;o.on("data",R=>{!this.push(R)&&o.pause&&(s=!0,o.pause())}),o.on("end",()=>{this.push(null)}),o.on("error",R=>{B(this,R)}),o.on("close",()=>{this.destroy()}),o.on("destroy",()=>{this.destroy()}),this._read=()=>{s&&o.resume&&(s=!1,o.resume())};const E=l(o);for(let R=1;R<E.length;R++){const C=E[R];this[C]===void 0&&typeof o[C]=="function"&&(this[C]=o[C].bind(o))}return this},S.prototype[c]=function(){return D(this)},S.prototype.iterator=function(o){return o!==void 0&&U(o,"options"),D(this,o)};function D(o,s){typeof o.read!="function"&&(o=S.wrap(o,{objectMode:!0}));const E=H(o,s);return E.stream=o,E}async function*H(o,s){let E=J;function R(oe){this===o?(E(),E=J):E=oe}o.on("readable",R);let C;const ee=I(o,{writable:!1},oe=>{C=oe?F(C,oe):null,E(),E=J});try{for(;;){const oe=o.destroyed?null:o.read();if(oe!==null)yield oe;else{if(C)throw C;if(C===null)return;await new f(R)}}}catch(oe){throw C=F(C,oe),C}finally{(C||(s==null?void 0:s.destroyOnReturn)!==!1)&&(C===void 0||o._readableState.autoDestroy)?$.destroyer(o,null):(o.off("readable",R),ee())}}a(S.prototype,{readable:{__proto__:null,get(){const o=this._readableState;return!!o&&o.readable!==!1&&!o.destroyed&&!o.errorEmitted&&!o.endEmitted},set(o){this._readableState&&(this._readableState.readable=!!o)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(o){this._readableState&&(this._readableState.flowing=o)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(o){this._readableState&&(this._readableState.destroyed=o)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),a(le.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[W]!==!1},set(o){this[W]=!!o}}}),S._fromList=V;function V(o,s){if(s.length===0)return null;let E;return s.objectMode?E=s.buffer.shift():!o||o>=s.length?(s.decoder?E=s.buffer.join(""):s.buffer.length===1?E=s.buffer.first():E=s.buffer.concat(s.length),s.buffer.clear()):E=s.buffer.consume(o,s.decoder),E}function ue(o){const s=o._readableState;w("endReadable",s.endEmitted),s.endEmitted||(s.ended=!0,e.nextTick(je,s,o))}function je(o,s){if(w("endReadableNT",o.endEmitted,o.length),!o.errored&&!o.closeEmitted&&!o.endEmitted&&o.length===0){if(o.endEmitted=!0,s.emit("end"),s.writable&&s.allowHalfOpen===!1)e.nextTick(et,s);else if(o.autoDestroy){const E=s._writableState;(!E||E.autoDestroy&&(E.finished||E.writable===!1))&&s.destroy()}}}function et(o){o.writable&&!o.writableEnded&&!o.destroyed&&o.end()}S.from=function(o,s){return X(S,o,s)};let ye;function Dn(){return ye===void 0&&(ye={}),ye}return S.fromWeb=function(o,s){return Dn().newStreamReadableFromReadableStream(o,s)},S.toWeb=function(o,s){return Dn().newReadableStreamFromStreamReadable(o,s)},S.wrap=function(o,s){var E,R;return new S({objectMode:(E=(R=o.readableObjectMode)!==null&&R!==void 0?R:o.objectMode)!==null&&E!==void 0?E:!0,...s,destroy(C,ee){$.destroyer(o,C),ee(C)}}).wrap(o)},jt}var Kt,ir;function fi(){if(ir)return Kt;ir=1;const e=Be,{ArrayPrototypeSlice:t,Error:n,FunctionPrototypeSymbolHasInstance:r,ObjectDefineProperty:i,ObjectDefineProperties:a,ObjectSetPrototypeOf:l,StringPrototypeToLowerCase:u,Symbol:f,SymbolHasInstance:d}=z;Kt=M,M.WritableState=U;const{EventEmitter:c}=wt,_=An.Stream,{Buffer:A}=xe,g=Xe,{addAbortSignal:b}=vt,{getHighWaterMark:P,getDefaultHighWaterMark:N}=Rn,{ERR_INVALID_ARG_TYPE:I,ERR_METHOD_NOT_IMPLEMENTED:w,ERR_MULTIPLE_CALLBACK:L,ERR_STREAM_CANNOT_PIPE:$,ERR_STREAM_DESTROYED:O,ERR_STREAM_ALREADY_FINISHED:Y,ERR_STREAM_NULL_VALUES:F,ERR_STREAM_WRITE_AFTER_END:q,ERR_UNKNOWN_ENCODING:K}=ie.codes,{errorOrDestroy:m}=g;l(M.prototype,_.prototype),l(M,_);function k(){}const Z=f("kOnFinished");function U(h,p,y){typeof y!="boolean"&&(y=p instanceof me()),this.objectMode=!!(h&&h.objectMode),y&&(this.objectMode=this.objectMode||!!(h&&h.writableObjectMode)),this.highWaterMark=h?P(this,h,"writableHighWaterMark",y):N(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const v=!!(h&&h.decodeStrings===!1);this.decodeStrings=!v,this.defaultEncoding=h&&h.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=S.bind(void 0,p),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,W(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!h||h.emitClose!==!1,this.autoDestroy=!h||h.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[Z]=[]}function W(h){h.buffered=[],h.bufferedIndex=0,h.allBuffers=!0,h.allNoop=!0}U.prototype.getBuffer=function(){return t(this.buffered,this.bufferedIndex)},i(U.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function M(h){const p=this instanceof me();if(!p&&!r(M,this))return new M(h);this._writableState=new U(h,this,p),h&&(typeof h.write=="function"&&(this._write=h.write),typeof h.writev=="function"&&(this._writev=h.writev),typeof h.destroy=="function"&&(this._destroy=h.destroy),typeof h.final=="function"&&(this._final=h.final),typeof h.construct=="function"&&(this._construct=h.construct),h.signal&&b(h.signal,this)),_.call(this,h),g.construct(this,()=>{const y=this._writableState;y.writing||Ze(this,y),Ve(this,y)})}i(M,d,{__proto__:null,value:function(h){return r(this,h)?!0:this!==M?!1:h&&h._writableState instanceof U}}),M.prototype.pipe=function(){m(this,new $)};function X(h,p,y,v){const D=h._writableState;if(typeof y=="function")v=y,y=D.defaultEncoding;else{if(!y)y=D.defaultEncoding;else if(y!=="buffer"&&!A.isEncoding(y))throw new K(y);typeof v!="function"&&(v=k)}if(p===null)throw new F;if(!D.objectMode)if(typeof p=="string")D.decodeStrings!==!1&&(p=A.from(p,y),y="buffer");else if(p instanceof A)y="buffer";else if(_._isUint8Array(p))p=_._uint8ArrayToBuffer(p),y="buffer";else throw new I("chunk",["string","Buffer","Uint8Array"],p);let H;return D.ending?H=new q:D.destroyed&&(H=new O("write")),H?(e.nextTick(v,H),m(h,H,!0),H):(D.pendingcb++,J(h,D,p,y,v))}M.prototype.write=function(h,p,y){return X(this,h,p,y)===!0},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){const h=this._writableState;h.corked&&(h.corked--,h.writing||Ze(this,h))},M.prototype.setDefaultEncoding=function(p){if(typeof p=="string"&&(p=u(p)),!A.isEncoding(p))throw new K(p);return this._writableState.defaultEncoding=p,this};function J(h,p,y,v,D){const H=p.objectMode?1:y.length;p.length+=H;const V=p.length<p.highWaterMark;return V||(p.needDrain=!0),p.writing||p.corked||p.errored||!p.constructed?(p.buffered.push({chunk:y,encoding:v,callback:D}),p.allBuffers&&v!=="buffer"&&(p.allBuffers=!1),p.allNoop&&D!==k&&(p.allNoop=!1)):(p.writelen=H,p.writecb=D,p.writing=!0,p.sync=!0,h._write(y,v,p.onwrite),p.sync=!1),V&&!p.errored&&!p.destroyed}function B(h,p,y,v,D,H,V){p.writelen=v,p.writecb=V,p.writing=!0,p.sync=!0,p.destroyed?p.onwrite(new O("write")):y?h._writev(D,p.onwrite):h._write(D,H,p.onwrite),p.sync=!1}function le(h,p,y,v){--p.pendingcb,v(y),ze(p),m(h,y)}function S(h,p){const y=h._writableState,v=y.sync,D=y.writecb;if(typeof D!="function"){m(h,new L);return}y.writing=!1,y.writecb=null,y.length-=y.writelen,y.writelen=0,p?(p.stack,y.errored||(y.errored=p),h._readableState&&!h._readableState.errored&&(h._readableState.errored=p),v?e.nextTick(le,h,y,p,D):le(h,y,p,D)):(y.buffered.length>y.bufferedIndex&&Ze(h,y),v?y.afterWriteTickInfo!==null&&y.afterWriteTickInfo.cb===D?y.afterWriteTickInfo.count++:(y.afterWriteTickInfo={count:1,cb:D,stream:h,state:y},e.nextTick(re,y.afterWriteTickInfo)):ge(h,y,1,D))}function re({stream:h,state:p,count:y,cb:v}){return p.afterWriteTickInfo=null,ge(h,p,y,v)}function ge(h,p,y,v){for(!p.ending&&!h.destroyed&&p.length===0&&p.needDrain&&(p.needDrain=!1,h.emit("drain"));y-- >0;)p.pendingcb--,v();p.destroyed&&ze(p),Ve(h,p)}function ze(h){if(h.writing)return;for(let D=h.bufferedIndex;D<h.buffered.length;++D){var p;const{chunk:H,callback:V}=h.buffered[D],ue=h.objectMode?1:H.length;h.length-=ue,V((p=h.errored)!==null&&p!==void 0?p:new O("write"))}const y=h[Z].splice(0);for(let D=0;D<y.length;D++){var v;y[D]((v=h.errored)!==null&&v!==void 0?v:new O("end"))}W(h)}function Ze(h,p){if(p.corked||p.bufferProcessing||p.destroyed||!p.constructed)return;const{buffered:y,bufferedIndex:v,objectMode:D}=p,H=y.length-v;if(!H)return;let V=v;if(p.bufferProcessing=!0,H>1&&h._writev){p.pendingcb-=H-1;const ue=p.allNoop?k:et=>{for(let ye=V;ye<y.length;++ye)y[ye].callback(et)},je=p.allNoop&&V===0?y:t(y,V);je.allBuffers=p.allBuffers,B(h,p,!0,p.length,je,"",ue),W(p)}else{do{const{chunk:ue,encoding:je,callback:et}=y[V];y[V++]=null;const ye=D?1:ue.length;B(h,p,!1,ye,ue,je,et)}while(V<y.length&&!p.writing);V===y.length?W(p):V>256?(y.splice(0,V),p.bufferedIndex=0):p.bufferedIndex=V}p.bufferProcessing=!1}M.prototype._write=function(h,p,y){if(this._writev)this._writev([{chunk:h,encoding:p}],y);else throw new w("_write()")},M.prototype._writev=null,M.prototype.end=function(h,p,y){const v=this._writableState;typeof h=="function"?(y=h,h=null,p=null):typeof p=="function"&&(y=p,p=null);let D;if(h!=null){const H=X(this,h,p);H instanceof n&&(D=H)}return v.corked&&(v.corked=1,this.uncork()),D||(!v.errored&&!v.ending?(v.ending=!0,Ve(this,v,!0),v.ended=!0):v.finished?D=new Y("end"):v.destroyed&&(D=new O("end"))),typeof y=="function"&&(D||v.finished?e.nextTick(y,D):v[Z].push(y)),this};function ve(h){return h.ending&&!h.destroyed&&h.constructed&&h.length===0&&!h.errored&&h.buffered.length===0&&!h.finished&&!h.writing&&!h.errorEmitted&&!h.closeEmitted}function Ot(h,p){let y=!1;function v(D){if(y){m(h,D??L());return}if(y=!0,p.pendingcb--,D){const H=p[Z].splice(0);for(let V=0;V<H.length;V++)H[V](D);m(h,D,p.sync)}else ve(p)&&(p.prefinished=!0,h.emit("prefinish"),p.pendingcb++,e.nextTick(Re,h,p))}p.sync=!0,p.pendingcb++;try{h._final(v)}catch(D){v(D)}p.sync=!1}function Fe(h,p){!p.prefinished&&!p.finalCalled&&(typeof h._final=="function"&&!p.destroyed?(p.finalCalled=!0,Ot(h,p)):(p.prefinished=!0,h.emit("prefinish")))}function Ve(h,p,y){ve(p)&&(Fe(h,p),p.pendingcb===0&&(y?(p.pendingcb++,e.nextTick((v,D)=>{ve(D)?Re(v,D):D.pendingcb--},h,p)):ve(p)&&(p.pendingcb++,Re(h,p))))}function Re(h,p){p.pendingcb--,p.finished=!0;const y=p[Z].splice(0);for(let v=0;v<y.length;v++)y[v]();if(h.emit("finish"),p.autoDestroy){const v=h._readableState;(!v||v.autoDestroy&&(v.endEmitted||v.readable===!1))&&h.destroy()}}a(M.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(h){this._writableState&&(this._writableState.destroyed=h)}},writable:{__proto__:null,get(){const h=this._writableState;return!!h&&h.writable!==!1&&!h.destroyed&&!h.errored&&!h.ending&&!h.ended},set(h){this._writableState&&(this._writableState.writable=!!h)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const h=this._writableState;return h?!h.destroyed&&!h.ending&&h.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Lt=g.destroy;M.prototype.destroy=function(h,p){const y=this._writableState;return!y.destroyed&&(y.bufferedIndex<y.buffered.length||y[Z].length)&&e.nextTick(ze,y),Lt.call(this,h,p),this},M.prototype._undestroy=g.undestroy,M.prototype._destroy=function(h,p){p(h)},M.prototype[c.captureRejectionSymbol]=function(h){this.destroy(h)};let Je;function Qe(){return Je===void 0&&(Je={}),Je}return M.fromWeb=function(h,p){return Qe().newStreamWritableFromWritableStream(h,p)},M.toWeb=function(h){return Qe().newWritableStreamFromStreamWritable(h)},Kt}var Gt,or;function Ga(){if(or)return Gt;or=1;const e=Be,t=xe,{isReadable:n,isWritable:r,isIterable:i,isNodeStream:a,isReadableNodeStream:l,isWritableNodeStream:u,isDuplexNodeStream:f}=Ae,d=Ce,{AbortError:c,codes:{ERR_INVALID_ARG_TYPE:_,ERR_INVALID_RETURN_VALUE:A}}=ie,{destroyer:g}=Xe,b=me(),P=Dt(),{createDeferredPromise:N}=Ee,I=ui,w=globalThis.Blob||t.Blob,L=typeof w<"u"?function(m){return m instanceof w}:function(m){return!1},$=globalThis.AbortController||gn().AbortController,{FunctionPrototypeCall:O}=z;class Y extends b{constructor(m){super(m),(m==null?void 0:m.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(m==null?void 0:m.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}Gt=function K(m,k){if(f(m))return m;if(l(m))return q({readable:m});if(u(m))return q({writable:m});if(a(m))return q({writable:!1,readable:!1});if(typeof m=="function"){const{value:U,write:W,final:M,destroy:X}=F(m);if(i(U))return I(Y,U,{objectMode:!0,write:W,final:M,destroy:X});const J=U==null?void 0:U.then;if(typeof J=="function"){let B;const le=O(J,U,S=>{if(S!=null)throw new A("nully","body",S)},S=>{g(B,S)});return B=new Y({objectMode:!0,readable:!1,write:W,final(S){M(async()=>{try{await le,e.nextTick(S,null)}catch(re){e.nextTick(S,re)}})},destroy:X})}throw new A("Iterable, AsyncIterable or AsyncFunction",k,U)}if(L(m))return K(m.arrayBuffer());if(i(m))return I(Y,m,{objectMode:!0,writable:!1});if(typeof(m==null?void 0:m.writable)=="object"||typeof(m==null?void 0:m.readable)=="object"){const U=m!=null&&m.readable?l(m==null?void 0:m.readable)?m==null?void 0:m.readable:K(m.readable):void 0,W=m!=null&&m.writable?u(m==null?void 0:m.writable)?m==null?void 0:m.writable:K(m.writable):void 0;return q({readable:U,writable:W})}const Z=m==null?void 0:m.then;if(typeof Z=="function"){let U;return O(Z,m,W=>{W!=null&&U.push(W),U.push(null)},W=>{g(U,W)}),U=new Y({objectMode:!0,writable:!1,read(){}})}throw new _(k,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],m)};function F(K){let{promise:m,resolve:k}=N();const Z=new $,U=Z.signal;return{value:K(async function*(){for(;;){const M=m;m=null;const{chunk:X,done:J,cb:B}=await M;if(e.nextTick(B),J)return;if(U.aborted)throw new c(void 0,{cause:U.reason});({promise:m,resolve:k}=N()),yield X}}(),{signal:U}),write(M,X,J){const B=k;k=null,B({chunk:M,done:!1,cb:J})},final(M){const X=k;k=null,X({done:!0,cb:M})},destroy(M,X){Z.abort(),X(M)}}}function q(K){const m=K.readable&&typeof K.readable.read!="function"?P.wrap(K.readable):K.readable,k=K.writable;let Z=!!n(m),U=!!r(k),W,M,X,J,B;function le(S){const re=J;J=null,re?re(S):S&&B.destroy(S)}return B=new Y({readableObjectMode:!!(m!=null&&m.readableObjectMode),writableObjectMode:!!(k!=null&&k.writableObjectMode),readable:Z,writable:U}),U&&(d(k,S=>{U=!1,S&&g(m,S),le(S)}),B._write=function(S,re,ge){k.write(S,re)?ge():W=ge},B._final=function(S){k.end(),M=S},k.on("drain",function(){if(W){const S=W;W=null,S()}}),k.on("finish",function(){if(M){const S=M;M=null,S()}})),Z&&(d(m,S=>{Z=!1,S&&g(m,S),le(S)}),m.on("readable",function(){if(X){const S=X;X=null,S()}}),m.on("end",function(){B.push(null)}),B._read=function(){for(;;){const S=m.read();if(S===null){X=B._read;return}if(!B.push(S))return}}),B._destroy=function(S,re){!S&&J!==null&&(S=new c),X=null,W=null,M=null,J===null?re(S):(J=re,g(k,S),g(m,S))},B}return Gt}var qt,ar;function me(){if(ar)return qt;ar=1;const{ObjectDefineProperties:e,ObjectGetOwnPropertyDescriptor:t,ObjectKeys:n,ObjectSetPrototypeOf:r}=z;qt=l;const i=Dt(),a=fi();r(l.prototype,i.prototype),r(l,i);{const c=n(a.prototype);for(let _=0;_<c.length;_++){const A=c[_];l.prototype[A]||(l.prototype[A]=a.prototype[A])}}function l(c){if(!(this instanceof l))return new l(c);i.call(this,c),a.call(this,c),c?(this.allowHalfOpen=c.allowHalfOpen!==!1,c.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),c.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}e(l.prototype,{writable:{__proto__:null,...t(a.prototype,"writable")},writableHighWaterMark:{__proto__:null,...t(a.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...t(a.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...t(a.prototype,"writableBuffer")},writableLength:{__proto__:null,...t(a.prototype,"writableLength")},writableFinished:{__proto__:null,...t(a.prototype,"writableFinished")},writableCorked:{__proto__:null,...t(a.prototype,"writableCorked")},writableEnded:{__proto__:null,...t(a.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...t(a.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(c){this._readableState&&this._writableState&&(this._readableState.destroyed=c,this._writableState.destroyed=c)}}});let u;function f(){return u===void 0&&(u={}),u}l.fromWeb=function(c,_){return f().newStreamDuplexFromReadableWritablePair(c,_)},l.toWeb=function(c){return f().newReadableWritablePairFromDuplex(c)};let d;return l.from=function(c){return d||(d=Ga()),d(c,"body")},qt}const{ObjectSetPrototypeOf:ci,Symbol:qa}=z;var hi=Se;const{ERR_METHOD_NOT_IMPLEMENTED:Ya}=ie.codes,Tn=me(),{getHighWaterMark:Xa}=Rn;ci(Se.prototype,Tn.prototype);ci(Se,Tn);const ot=qa("kCallback");function Se(e){if(!(this instanceof Se))return new Se(e);const t=e?Xa(this,e,"readableHighWaterMark",!0):null;t===0&&(e={...e,highWaterMark:null,readableHighWaterMark:t,writableHighWaterMark:e.writableHighWaterMark||0}),Tn.call(this,e),this._readableState.sync=!1,this[ot]=null,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",za)}function pn(e){typeof this._flush=="function"&&!this.destroyed?this._flush((t,n)=>{if(t){e?e(t):this.destroy(t);return}n!=null&&this.push(n),this.push(null),e&&e()}):(this.push(null),e&&e())}function za(){this._final!==pn&&pn.call(this)}Se.prototype._final=pn;Se.prototype._transform=function(e,t,n){throw new Ya("_transform()")};Se.prototype._write=function(e,t,n){const r=this._readableState,i=this._writableState,a=r.length;this._transform(e,t,(l,u)=>{if(l){n(l);return}u!=null&&this.push(u),i.ended||a===r.length||r.length<r.highWaterMark?n():this[ot]=n})};Se.prototype._read=function(){if(this[ot]){const e=this[ot];this[ot]=null,e()}};const{ObjectSetPrototypeOf:pi}=z;var bi=qe;const In=hi;pi(qe.prototype,In.prototype);pi(qe,In);function qe(e){if(!(this instanceof qe))return new qe(e);In.call(this,e)}qe.prototype._transform=function(e,t,n){n(null,e)};const it=Be,{ArrayIsArray:Za,Promise:Ja,SymbolAsyncIterator:Qa}=z,yt=Ce,{once:es}=Ee,ts=Xe,sr=me(),{aggregateTwoErrors:ns,codes:{ERR_INVALID_ARG_TYPE:bn,ERR_INVALID_RETURN_VALUE:Yt,ERR_MISSING_ARGS:rs,ERR_STREAM_DESTROYED:is,ERR_STREAM_PREMATURE_CLOSE:os},AbortError:as}=ie,{validateFunction:ss,validateAbortSignal:ls}=St,{isIterable:Oe,isReadable:Xt,isReadableNodeStream:bt,isNodeStream:lr,isTransformStream:Ge,isWebStream:ds,isReadableStream:zt,isReadableEnded:us}=Ae,fs=globalThis.AbortController||gn().AbortController;let Zt,Jt;function dr(e,t,n){let r=!1;e.on("close",()=>{r=!0});const i=yt(e,{readable:t,writable:n},a=>{r=!a});return{destroy:a=>{r||(r=!0,ts.destroyer(e,a||new is("pipe")))},cleanup:i}}function cs(e){return ss(e[e.length-1],"streams[stream.length - 1]"),e.pop()}function Qt(e){if(Oe(e))return e;if(bt(e))return hs(e);throw new bn("val",["Readable","Iterable","AsyncIterable"],e)}async function*hs(e){Jt||(Jt=Dt()),yield*Jt.prototype[Qa].call(e)}async function ft(e,t,n,{end:r}){let i,a=null;const l=d=>{if(d&&(i=d),a){const c=a;a=null,c()}},u=()=>new Ja((d,c)=>{i?c(i):a=()=>{i?c(i):d()}});t.on("drain",l);const f=yt(t,{readable:!1},l);try{t.writableNeedDrain&&await u();for await(const d of e)t.write(d)||await u();r&&t.end(),await u(),n()}catch(d){n(i!==d?ns(i,d):d)}finally{f(),t.off("drain",l)}}async function en(e,t,n,{end:r}){Ge(t)&&(t=t.writable);const i=t.getWriter();try{for await(const a of e)await i.ready,i.write(a).catch(()=>{});await i.ready,r&&await i.close(),n()}catch(a){try{await i.abort(a),n(a)}catch(l){n(l)}}}function ps(...e){return gi(e,es(cs(e)))}function gi(e,t,n){if(e.length===1&&Za(e[0])&&(e=e[0]),e.length<2)throw new rs("streams");const r=new fs,i=r.signal,a=n==null?void 0:n.signal,l=[];ls(a,"options.signal");function u(){g(new as)}a==null||a.addEventListener("abort",u);let f,d;const c=[];let _=0;function A(I){g(I,--_===0)}function g(I,w){if(I&&(!f||f.code==="ERR_STREAM_PREMATURE_CLOSE")&&(f=I),!(!f&&!w)){for(;c.length;)c.shift()(f);a==null||a.removeEventListener("abort",u),r.abort(),w&&(f||l.forEach(L=>L()),it.nextTick(t,f,d))}}let b;for(let I=0;I<e.length;I++){const w=e[I],L=I<e.length-1,$=I>0,O=L||(n==null?void 0:n.end)!==!1,Y=I===e.length-1;if(lr(w)){let F=function(q){q&&q.name!=="AbortError"&&q.code!=="ERR_STREAM_PREMATURE_CLOSE"&&A(q)};if(O){const{destroy:q,cleanup:K}=dr(w,L,$);c.push(q),Xt(w)&&Y&&l.push(K)}w.on("error",F),Xt(w)&&Y&&l.push(()=>{w.removeListener("error",F)})}if(I===0)if(typeof w=="function"){if(b=w({signal:i}),!Oe(b))throw new Yt("Iterable, AsyncIterable or Stream","source",b)}else Oe(w)||bt(w)||Ge(w)?b=w:b=sr.from(w);else if(typeof w=="function"){if(Ge(b)){var P;b=Qt((P=b)===null||P===void 0?void 0:P.readable)}else b=Qt(b);if(b=w(b,{signal:i}),L){if(!Oe(b,!0))throw new Yt("AsyncIterable",`transform[${I-1}]`,b)}else{var N;Zt||(Zt=bi);const F=new Zt({objectMode:!0}),q=(N=b)===null||N===void 0?void 0:N.then;if(typeof q=="function")_++,q.call(b,k=>{d=k,k!=null&&F.write(k),O&&F.end(),it.nextTick(A)},k=>{F.destroy(k),it.nextTick(A,k)});else if(Oe(b,!0))_++,ft(b,F,A,{end:O});else if(zt(b)||Ge(b)){const k=b.readable||b;_++,ft(k,F,A,{end:O})}else throw new Yt("AsyncIterable or Promise","destination",b);b=F;const{destroy:K,cleanup:m}=dr(b,!1,!0);c.push(K),Y&&l.push(m)}}else if(lr(w)){if(bt(b)){_+=2;const F=bs(b,w,A,{end:O});Xt(w)&&Y&&l.push(F)}else if(Ge(b)||zt(b)){const F=b.readable||b;_++,ft(F,w,A,{end:O})}else if(Oe(b))_++,ft(b,w,A,{end:O});else throw new bn("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],b);b=w}else if(ds(w)){if(bt(b))_++,en(Qt(b),w,A,{end:O});else if(zt(b)||Oe(b))_++,en(b,w,A,{end:O});else if(Ge(b))_++,en(b.readable,w,A,{end:O});else throw new bn("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],b);b=w}else b=sr.from(w)}return(i!=null&&i.aborted||a!=null&&a.aborted)&&it.nextTick(u),b}function bs(e,t,n,{end:r}){let i=!1;if(t.on("close",()=>{i||n(new os)}),e.pipe(t,{end:!1}),r){let a=function(){i=!0,t.end()};us(e)?it.nextTick(a):e.once("end",a)}else n();return yt(e,{readable:!0,writable:!1},a=>{const l=e._readableState;a&&a.code==="ERR_STREAM_PREMATURE_CLOSE"&&l&&l.ended&&!l.errored&&!l.errorEmitted?e.once("end",n).once("error",n):n(a)}),yt(t,{readable:!1,writable:!0},n)}var Cn={pipelineImpl:gi,pipeline:ps};const{pipeline:gs}=Cn,ct=me(),{destroyer:ys}=Xe,{isNodeStream:ht,isReadable:ur,isWritable:fr,isWebStream:tn,isTransformStream:Me,isWritableStream:cr,isReadableStream:hr}=Ae,{AbortError:_s,codes:{ERR_INVALID_ARG_VALUE:pr,ERR_MISSING_ARGS:ws}}=ie,ms=Ce;var yi=function(...t){if(t.length===0)throw new ws("streams");if(t.length===1)return ct.from(t[0]);const n=[...t];if(typeof t[0]=="function"&&(t[0]=ct.from(t[0])),typeof t[t.length-1]=="function"){const g=t.length-1;t[g]=ct.from(t[g])}for(let g=0;g<t.length;++g)if(!(!ht(t[g])&&!tn(t[g]))){if(g<t.length-1&&!(ur(t[g])||hr(t[g])||Me(t[g])))throw new pr(`streams[${g}]`,n[g],"must be readable");if(g>0&&!(fr(t[g])||cr(t[g])||Me(t[g])))throw new pr(`streams[${g}]`,n[g],"must be writable")}let r,i,a,l,u;function f(g){const b=l;l=null,b?b(g):g?u.destroy(g):!A&&!_&&u.destroy()}const d=t[0],c=gs(t,f),_=!!(fr(d)||cr(d)||Me(d)),A=!!(ur(c)||hr(c)||Me(c));if(u=new ct({writableObjectMode:!!(d!=null&&d.writableObjectMode),readableObjectMode:!!(c!=null&&c.writableObjectMode),writable:_,readable:A}),_){if(ht(d))u._write=function(b,P,N){d.write(b,P)?N():r=N},u._final=function(b){d.end(),i=b},d.on("drain",function(){if(r){const b=r;r=null,b()}});else if(tn(d)){const P=(Me(d)?d.writable:d).getWriter();u._write=async function(N,I,w){try{await P.ready,P.write(N).catch(()=>{}),w()}catch(L){w(L)}},u._final=async function(N){try{await P.ready,P.close().catch(()=>{}),i=N}catch(I){N(I)}}}const g=Me(c)?c.readable:c;ms(g,()=>{if(i){const b=i;i=null,b()}})}if(A){if(ht(c))c.on("readable",function(){if(a){const g=a;a=null,g()}}),c.on("end",function(){u.push(null)}),u._read=function(){for(;;){const g=c.read();if(g===null){a=u._read;return}if(!u.push(g))return}};else if(tn(c)){const b=(Me(c)?c.readable:c).getReader();u._read=async function(){for(;;)try{const{value:P,done:N}=await b.read();if(!u.push(P))return;if(N){u.push(null);return}}catch{return}}}}return u._destroy=function(g,b){!g&&l!==null&&(g=new _s),a=null,r=null,i=null,l===null?b(g):(l=b,ht(c)&&ys(c,g))},u};const _i=globalThis.AbortController||gn().AbortController,{codes:{ERR_INVALID_ARG_VALUE:Ss,ERR_INVALID_ARG_TYPE:at,ERR_MISSING_ARGS:Es,ERR_OUT_OF_RANGE:As},AbortError:pe}=ie,{validateAbortSignal:$e,validateInteger:Rs,validateObject:He}=St,Ts=z.Symbol("kWeak"),{finished:Is}=Ce,Cs=yi,{addAbortSignalNoValidate:vs}=vt,{isWritable:Ds,isNodeStream:Ns}=Ae,{ArrayPrototypePush:Ms,MathFloor:Ps,Number:Os,NumberIsNaN:Ls,Promise:br,PromiseReject:gr,PromisePrototypeThen:ks,Symbol:wi}=z,_t=wi("kEmpty"),yr=wi("kEof");function Us(e,t){if(t!=null&&He(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal"),Ns(e)&&!Ds(e))throw new Ss("stream",e,"must be writable");const n=Cs(this,e);return t!=null&&t.signal&&vs(t.signal,n),n}function Nt(e,t){if(typeof e!="function")throw new at("fn",["Function","AsyncFunction"],e);t!=null&&He(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal");let n=1;return(t==null?void 0:t.concurrency)!=null&&(n=Ps(t.concurrency)),Rs(n,"concurrency",1),(async function*(){var i,a;const l=new _i,u=this,f=[],d=l.signal,c={signal:d},_=()=>l.abort();t!=null&&(i=t.signal)!==null&&i!==void 0&&i.aborted&&_(),t==null||(a=t.signal)===null||a===void 0||a.addEventListener("abort",_);let A,g,b=!1;function P(){b=!0}async function N(){try{for await(let L of u){var I;if(b)return;if(d.aborted)throw new pe;try{L=e(L,c)}catch($){L=gr($)}L!==_t&&(typeof((I=L)===null||I===void 0?void 0:I.catch)=="function"&&L.catch(P),f.push(L),A&&(A(),A=null),!b&&f.length&&f.length>=n&&await new br($=>{g=$}))}f.push(yr)}catch(L){const $=gr(L);ks($,void 0,P),f.push($)}finally{var w;b=!0,A&&(A(),A=null),t==null||(w=t.signal)===null||w===void 0||w.removeEventListener("abort",_)}}N();try{for(;;){for(;f.length>0;){const I=await f[0];if(I===yr)return;if(d.aborted)throw new pe;I!==_t&&(yield I),f.shift(),g&&(g(),g=null)}await new br(I=>{A=I})}}finally{l.abort(),b=!0,g&&(g(),g=null)}}).call(this)}function Ws(e=void 0){return e!=null&&He(e,"options"),(e==null?void 0:e.signal)!=null&&$e(e.signal,"options.signal"),(async function*(){let n=0;for await(const i of this){var r;if(e!=null&&(r=e.signal)!==null&&r!==void 0&&r.aborted)throw new pe({cause:e.signal.reason});yield[n++,i]}}).call(this)}async function mi(e,t=void 0){for await(const n of vn.call(this,e,t))return!0;return!1}async function xs(e,t=void 0){if(typeof e!="function")throw new at("fn",["Function","AsyncFunction"],e);return!await mi.call(this,async(...n)=>!await e(...n),t)}async function Bs(e,t){for await(const n of vn.call(this,e,t))return n}async function $s(e,t){if(typeof e!="function")throw new at("fn",["Function","AsyncFunction"],e);async function n(r,i){return await e(r,i),_t}for await(const r of Nt.call(this,n,t));}function vn(e,t){if(typeof e!="function")throw new at("fn",["Function","AsyncFunction"],e);async function n(r,i){return await e(r,i)?r:_t}return Nt.call(this,n,t)}class Hs extends Es{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function Fs(e,t,n){var r;if(typeof e!="function")throw new at("reducer",["Function","AsyncFunction"],e);n!=null&&He(n,"options"),(n==null?void 0:n.signal)!=null&&$e(n.signal,"options.signal");let i=arguments.length>1;if(n!=null&&(r=n.signal)!==null&&r!==void 0&&r.aborted){const d=new pe(void 0,{cause:n.signal.reason});throw this.once("error",()=>{}),await Is(this.destroy(d)),d}const a=new _i,l=a.signal;if(n!=null&&n.signal){const d={once:!0,[Ts]:this};n.signal.addEventListener("abort",()=>a.abort(),d)}let u=!1;try{for await(const d of this){var f;if(u=!0,n!=null&&(f=n.signal)!==null&&f!==void 0&&f.aborted)throw new pe;i?t=await e(t,d,{signal:l}):(t=d,i=!0)}if(!u&&!i)throw new Hs}finally{a.abort()}return t}async function Vs(e){e!=null&&He(e,"options"),(e==null?void 0:e.signal)!=null&&$e(e.signal,"options.signal");const t=[];for await(const r of this){var n;if(e!=null&&(n=e.signal)!==null&&n!==void 0&&n.aborted)throw new pe(void 0,{cause:e.signal.reason});Ms(t,r)}return t}function js(e,t){const n=Nt.call(this,e,t);return(async function*(){for await(const i of n)yield*i}).call(this)}function Si(e){if(e=Os(e),Ls(e))return 0;if(e<0)throw new As("number",">= 0",e);return e}function Ks(e,t=void 0){return t!=null&&He(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal"),e=Si(e),(async function*(){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new pe;for await(const a of this){var i;if(t!=null&&(i=t.signal)!==null&&i!==void 0&&i.aborted)throw new pe;e--<=0&&(yield a)}}).call(this)}function Gs(e,t=void 0){return t!=null&&He(t,"options"),(t==null?void 0:t.signal)!=null&&$e(t.signal,"options.signal"),e=Si(e),(async function*(){var r;if(t!=null&&(r=t.signal)!==null&&r!==void 0&&r.aborted)throw new pe;for await(const a of this){var i;if(t!=null&&(i=t.signal)!==null&&i!==void 0&&i.aborted)throw new pe;if(e-- >0)yield a;else return}}).call(this)}yn.streamReturningOperators={asIndexedPairs:Ws,drop:Ks,filter:vn,flatMap:js,map:Nt,take:Gs,compose:Us};yn.promiseReturningOperators={every:xs,forEach:$s,reduce:Fs,toArray:Vs,some:mi,find:Bs};var nn,_r;function Ei(){if(_r)return nn;_r=1;const{ArrayPrototypePop:e,Promise:t}=z,{isIterable:n,isNodeStream:r,isWebStream:i}=Ae,{pipelineImpl:a}=Cn,{finished:l}=Ce;Ai();function u(...f){return new t((d,c)=>{let _,A;const g=f[f.length-1];if(g&&typeof g=="object"&&!r(g)&&!n(g)&&!i(g)){const b=e(f);_=b.signal,A=b.end}a(f,(b,P)=>{b?c(b):d(P)},{signal:_,end:A})})}return nn={finished:l,pipeline:u},nn}var wr;function Ai(){if(wr)return $t.exports;wr=1;const{Buffer:e}=xe,{ObjectDefineProperty:t,ObjectKeys:n,ReflectApply:r}=z,{promisify:{custom:i}}=Ee,{streamReturningOperators:a,promiseReturningOperators:l}=yn,{codes:{ERR_ILLEGAL_CONSTRUCTOR:u}}=ie,f=yi,{pipeline:d}=Cn,{destroyer:c}=Xe,_=Ce,A=Ei(),g=Ae,b=$t.exports=An.Stream;b.isDisturbed=g.isDisturbed,b.isErrored=g.isErrored,b.isReadable=g.isReadable,b.Readable=Dt();for(const N of n(a)){let w=function(...L){if(new.target)throw u();return b.Readable.from(r(I,this,L))};const I=a[N];t(w,"name",{__proto__:null,value:I.name}),t(w,"length",{__proto__:null,value:I.length}),t(b.Readable.prototype,N,{__proto__:null,value:w,enumerable:!1,configurable:!0,writable:!0})}for(const N of n(l)){let w=function(...L){if(new.target)throw u();return r(I,this,L)};const I=l[N];t(w,"name",{__proto__:null,value:I.name}),t(w,"length",{__proto__:null,value:I.length}),t(b.Readable.prototype,N,{__proto__:null,value:w,enumerable:!1,configurable:!0,writable:!0})}b.Writable=fi(),b.Duplex=me(),b.Transform=hi,b.PassThrough=bi,b.pipeline=d;const{addAbortSignal:P}=vt;return b.addAbortSignal=P,b.finished=_,b.destroy=c,b.compose=f,t(b,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return A}}),t(d,i,{__proto__:null,enumerable:!0,get(){return A.pipeline}}),t(_,i,{__proto__:null,enumerable:!0,get(){return A.finished}}),b.Stream=b,b._isUint8Array=function(I){return I instanceof Uint8Array},b._uint8ArrayToBuffer=function(I){return e.from(I.buffer,I.byteOffset,I.byteLength)},$t.exports}(function(e){const t=Ai(),n=Ei(),r=t.Readable.destroy;e.exports=t.Readable,e.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,e.exports._isUint8Array=t._isUint8Array,e.exports.isDisturbed=t.isDisturbed,e.exports.isErrored=t.isErrored,e.exports.isReadable=t.isReadable,e.exports.Readable=t.Readable,e.exports.Writable=t.Writable,e.exports.Duplex=t.Duplex,e.exports.Transform=t.Transform,e.exports.PassThrough=t.PassThrough,e.exports.addAbortSignal=t.addAbortSignal,e.exports.finished=t.finished,e.exports.destroy=t.destroy,e.exports.destroy=r,e.exports.pipeline=t.pipeline,e.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return n}}),e.exports.Stream=t.Stream,e.exports.default=e.exports})(Lr);var Mt=Lr.exports;function pt(){}const mr="SYN",rn="ACK",Sr="BRK";class Er extends Mt.Duplex{constructor(t){let{name:n,target:r,targetWindow:i=window,targetOrigin:a="*"}=t;if(super({objectMode:!0}),T(this,"_init",void 0),T(this,"_haveSyn",void 0),T(this,"_name",void 0),T(this,"_target",void 0),T(this,"_targetWindow",void 0),T(this,"_targetOrigin",void 0),T(this,"_onMessage",void 0),T(this,"_synIntervalId",void 0),!n||!r)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=n,this._target=r,this._targetWindow=i,this._targetOrigin=a,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(Sr,null,pt),this._haveSyn=!1,this._init=!1}_handShake(){this._write(mr,null,pt),this.cork()}_onData(t){if(!this._init)t===mr?(this._haveSyn=!0,this._write(rn,null,pt)):t===rn&&(this._init=!0,this._haveSyn||this._write(rn,null,pt),this.uncork());else if(t===Sr)this._break();else try{this.push(t)}catch(n){this.emit("error",n)}}_postMessage(t){const n=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:t},n)}onMessage(t){const n=t.data;this._targetOrigin!=="*"&&t.origin!==this._targetOrigin||t.source!==this._targetWindow||typeof n!="object"||n.target!==this._name||!n.data||this._onData(n.data)}_read(){}_write(t,n,r){this._postMessage(t),r()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}function Ar(e,t,n){try{Reflect.apply(e,t,n)}catch(r){setTimeout(()=>{throw r})}}function qs(e){const t=e.length,n=new Array(t);for(let r=0;r<t;r+=1)n[r]=e[r];return n}class st extends wt.EventEmitter{emit(t){let n=t==="error";const r=this._events;if(r!==void 0)n=n&&r.error===void 0;else if(!n)return!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),l=1;l<i;l++)a[l-1]=arguments[l];if(n){let f;if(a.length>0&&([f]=a),f instanceof Error)throw f;const d=new Error(`Unhandled error.${f?` (${f.message})`:""}`);throw d.context=f,d}const u=r[t];if(u===void 0)return!1;if(typeof u=="function")Ar(u,this,a);else{const f=u.length,d=qs(u);for(let c=0;c<f;c+=1)Ar(d[c],this,a)}return!0}}class nt extends Error{constructor(t){let{code:n,message:r,data:i}=t;if(!Number.isInteger(n))throw new Error("code must be an integer");if(!r||typeof r!="string")throw new Error("message must be string");super(r),T(this,"code",void 0),T(this,"data",void 0),this.code=n,i!==void 0&&(this.data=i)}toString(){return Mi({code:this.code,message:this.message,data:this.data,stack:this.stack})}}function Ys(){const e={};function t(){return!1}const n=new st;function r(f){const d=e[f.id];if(!d)throw new Error(`StreamMiddleware - Unknown response id "${f.id}"`);delete e[f.id],Object.assign(d.res,f),setTimeout(d.end)}function i(f){n.emit("notification",f)}function a(f,d,c){let _;try{!f.id?i(f):r(f)}catch(A){_=A}c(_)}const l=new Mt.Duplex({objectMode:!0,read:t,write:a});return{events:n,middleware:(f,d,c,_)=>{l.push(f),e[f.id]={req:f,res:d,next:c,end:_}},stream:l}}function Xs(){return(e,t,n,r)=>{const i=e.id,a=Math.random().toString(36).slice(2);e.id=a,t.id=a,n(l=>{e.id=i,t.id=i,l()})}}class we extends st{constructor(){super(),T(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(t,n,r){const i=[];let a=null,l=!1;for(const u of r)if([a,l]=await we._runMiddleware(t,n,u,i),l)break;return[a,l,i.reverse()]}static _runMiddleware(t,n,r,i){return new Promise(a=>{const l=f=>{const d=f||n.error;d&&(n.error=Ie.serializeError(d)),a([d,!0])},u=f=>{n.error?l(n.error):(f&&(typeof f!="function"&&l(new nt({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),i.push(f)),a([null,!1]))};try{r(t,n,u,l)}catch(f){l(f)}})}static async _runReturnHandlers(t){for(const n of t)await new Promise((r,i)=>{n(a=>a?i(a):r())})}static _checkForCompletion(t,n,r){if(!("result"in n)&&!("error"in n))throw new nt({code:-32603,message:"Response has no error or result for request"});if(!r)throw new nt({code:-32603,message:"Nothing ended request"})}push(t){this._middleware.push(t)}handle(t,n){if(n&&typeof n!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(t)?n?this._handleBatch(t,n):this._handleBatch(t):n?this._handle(t,n):this._promiseHandle(t)}asMiddleware(){return async(t,n,r,i)=>{try{const[a,l,u]=await we._runAllMiddleware(t,n,this._middleware);return l?(await we._runReturnHandlers(u),i(a)):r(async f=>{try{await we._runReturnHandlers(u)}catch(d){return f(d)}return f()})}catch(a){return i(a)}}}async _handleBatch(t,n){try{const r=await Promise.all(t.map(this._promiseHandle.bind(this)));return n?n(null,r):r}catch(r){if(n)return n(r);throw r}}_promiseHandle(t){return new Promise(n=>{this._handle(t,(r,i)=>{n(i)})})}async _handle(t,n){if(!t||Array.isArray(t)||typeof t!="object"){const l=new nt({code:-32603,message:"request must be plain object"});return n(l,{id:void 0,jsonrpc:"2.0",error:l})}if(typeof t.method!="string"){const l=new nt({code:-32603,message:"method must be string"});return n(l,{id:t.id,jsonrpc:"2.0",error:l})}const r=te({},t),i={id:r.id,jsonrpc:r.jsonrpc};let a=null;try{await this._processRequest(r,i)}catch(l){a=l}return a&&(delete i.result,i.error||(i.error=Ie.serializeError(a))),n(a,i)}async _processRequest(t,n){const[r,i,a]=await we._runAllMiddleware(t,n,this._middleware);if(we._checkForCompletion(t,n,i),await we._runReturnHandlers(a),r)throw r}}class zs extends Mt.Duplex{constructor(t){let{parent:n,name:r}=t;super({objectMode:!0}),T(this,"_parent",void 0),T(this,"_name",void 0),this._parent=n,this._name=r}_read(){}_write(t,n,r){this._parent.push({name:this._name,data:t}),r()}}const Rr=Symbol("IGNORE_SUBSTREAM");class Ri extends Mt.Duplex{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(te(te({},t),{},{objectMode:!0})),T(this,"_substreams",void 0),T(this,"getStream",void 0),this._substreams={}}createStream(t){if(!t)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[t])throw new Error(`ObjectMultiplex - Substream for name "${t}" already exists`);const n=new zs({parent:this,name:t});return this._substreams[t]=n,Zs(this,r=>n.destroy(r||void 0)),n}ignoreStream(t){if(!t)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[t])throw new Error(`ObjectMultiplex - Substream for name "${t}" already exists`);this._substreams[t]=Rr}_read(){}_write(t,n,r){const{name:i,data:a}=t;if(!i)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${t}"`),r();const l=this._substreams[i];return l?(l!==Rr&&l.push(a),r()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${i}"`),r())}}function Zs(e,t){const n=Ni(t);Ln(e,{readable:!1},n),Ln(e,{writable:!1},n)}function Js(e){const t=new Ri;return t.getStream=function(r){return this._substreams[r]?this._substreams[r]:this.createStream(r)},on(e,t,e,n=>{n&&window.console.error(n)}),t}const Le={GOOGLE:"google",FACEBOOK:"facebook",TWITCH:"twitch",REDDIT:"reddit",DISCORD:"discord",EMAIL_PASSWORDLESS:"torus-auth0-email-passwordless"},Tr={[Le.GOOGLE]:"tkey-google",[Le.FACEBOOK]:"tkey-facebook",[Le.TWITCH]:"tkey-twitch",[Le.REDDIT]:"tkey-reddit",[Le.DISCORD]:"tkey-discord",[Le.EMAIL_PASSWORDLESS]:"tkey-auth0-email-passwordless"},G={MOONPAY:"moonpay",WYRE:"wyre",RAMPNETWORK:"rampnetwork",XANPOOL:"xanpool",MERCURYO:"mercuryo",TRANSAK:"transak",BANXA:"banxa"},x={MAINNET:"mainnet",MATIC:"matic",BSC_MAINNET:"bsc_mainnet",AVALANCHE_MAINNET:"avalanche_mainnet",XDAI:"xdai",ARBITRUM_MAINNET:"arbitrum_mainnet",OPTIMISM_MAINNET:"optimism_mainnet"},Qs={PRODUCTION:"production",DEVELOPMENT:"development",BINANCE:"binance",TESTING:"testing",LRC:"lrc",BETA:"beta",BNB:"bnb",POLYGON:"polygon",ALPHA:"alpha"},Ke={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"},el=["ETH","USDT","USDC","TUSD","EOSDT","USD","DAI","GUSD","DKKT","PAX","ILS","RUB","BYN","EUR","GBP","JPY","KRW","PLN","MXN","AUD","BRL","CAD","CHF","KPW","LAK","LBP","LKR","XOF","CNHT","DOGE","UAH","TRY","HKD","XJP","SGD","USC","NZD","NGN","RUR","COP","GHS","EGP","IDR","BHD","CRC","PEN","AED","DOP","PKR","HUF","VND","XAR","LTC","RON","OMR","MYR","DKK","UGX","ZMW","SAR","SEK","GEL","RWF","IRR","TZS","CNY","VEF","BDT","HRK","CLP","THB","XAF","ARS","UYU","SZL","KZT","NOK","KES","PAB","INR","CZK","MAD","TWD","PHP","ZAR","BOB","CDF","DASH","VES","ISK","MWK","BAM","TTD","XRP","JOD","RSD","HNL","BGN","GTQ","BWP","XMR","MMK","QAR","AOA","KWD","MUR","WUSD","WEUR","WAVES","WTRY","LRD","LSL","LYD","AWG","MDL","BTO","EURS","CHFT","MKD","MNT","MOP","MRO","MVR","VOLLAR","CKUSD","KHR","VUV","BITCNY","QC","BBD","NAD","NPR","PGK","PYG","BIF","BMD","BND","XLM","BNB","SCR","BAT","CRO","HT","KCS","LEO","LINK","MKR","NPXS","OMG","REP","ZB","ZIL","ZRX","BCH","BZD","CUP","CVE","DJF","DZD","ERN","ETB","FJD","FKP","BUSD","ANCT","ALL","AMD","ANG","CNYX","IQD","UZS","TND","GGP","XAU","KGS","GIP","JMD","ZEC","USDP","BSV","EMC2","SNT","GTO","POWR","EUSD","EURT","BCY","BTS","ATM","BLOCKPAY","ARDR","AMP","B2X","BITGOLD","BITEUR","ATB","BITUSD","AGRS","DFXT","HIKEN","BIX","KNC","EOS","COB","COSS","BMH","NANO","BDG","BNT","XVG","LKK1Y","LKK","USDK","EURN","NZDT","JSE","GMD","GNF","GYD","YER","XPF","HTG","SLL","SOS","WST","SVC","SYP","NEO","KMF","JUMP","AYA","BLAST","WGR","BCN","BTG","URALS","INN","USDQ","CNH","HUSD","BKRW","NZDX","EURX","CADX","USDEX","JPYX","AUDX","VNDC","EON","GBPX","CHFX","USDJ","IDRT","USDS","USDN","BIDR","IDK","BSD","BTN","KYD","NIO","SBD","SDG","SHP","TOP","XCD","XCHF","CNYT","GYEN","ZUSD","GOLD","TRX","TRYB","PLATC","STRAX","UST","GLM","VAI","BRZ","DDRST","XAUT","MIM"],tl={[G.MOONPAY]:["AUD","BGN","BRL","CAD","CHF","CNY","COP","CZK","DKK","DOP","EGP","EUR","GBP","HKD","HRK","IDR","ILS","JPY","JOD","KES","KRW","KWD","LKR","MAD","MXN","MYR","NGN","NOK","NZD","OMR","PEN","PKR","PLN","RON","RUB","SEK","SGD","THB","TRY","TWD","USD","VND","ZAR"],[G.WYRE]:["USD","EUR","GBP","AUD","CAD","NZD","CNY","ARS","BRL","CHF","CLP","COP","CZK","DKK","HKD","ILS","INR","ISK","JPY","KRW","MXN","MYR","NOK","PHP","PLN","SEK","SGD","THB","VND","ZAR"],[G.RAMPNETWORK]:["USD","EUR","GBP","BMD","BAM","BWP","BRL","BGN","COP","CRC","CZK","DKK","DOP","GEL","GTQ","HNL","HUF","ISK","INR","ILS","KZT","KES","KWD","LAK","MKD","MYR","MXN","MDL","MZN","NZD","NGN","PYG","PEN","PLN","RON","RSD","SGD","ZAR","LKR","SEK","CHF","TJS","THB","UYU"],[G.XANPOOL]:["SGD","HKD","THB","PHP","INR","IDR","MYR","AUD","NZD","KRW"],[G.MERCURYO]:["EUR","USD","GBP","TRY","JPY","BRL","NGN","VND","MXN","KRW","PLN","SEK","CHF","CAD","CZK","DKK","BGN","HKD","AUD","INR"],[G.TRANSAK]:["ARS","AUD","BBD","BGN","BMD","BRL","CAD","CHF","CLP","CRC","CZK","DKK","DOP","EUR","FJD","FKP","GBP","GIP","HRK","HUF","IDR","ILS","ISK","JMD","JPY","KES","KRW","MDL","MXN","MYR","NOK","NZD","PEN","PHP","PLN","PYG","RON","SEK","SGD","THB","TRY","TZS","USD","ZAR"],[G.BANXA]:["AUD","CAD","CZK","DKK","EUR","GBP","HKD","JPY","NOK","NZD","NZD","PLN","RUB","SEK","SGD","TRY","USD"]},nl=new Set(el);function Pe(e){return tl[e].filter(n=>nl.has(n))}const rl={[G.MOONPAY]:{line1:"Credit/ Debit Card/ Apple Pay",line2:"4.5% or 5 USD",line3:"2,000/day, 10,000/mo",supportPage:"https://help.moonpay.io/en/",minOrderValue:24.99,maxOrderValue:5e4,validCurrencies:Pe(G.MOONPAY),validCryptoCurrenciesByChain:{[x.MAINNET]:[{value:"aave",display:"AAVE"},{value:"bat",display:"BAT"},{value:"dai",display:"DAI"},{value:"eth",display:"ETH"},{value:"mkr",display:"MKR"},{value:"matic",display:"MATIC"},{value:"usdt",display:"USDT"},{value:"uni",display:"UNI"},{value:"usdc",display:"USDC"},{value:"weth",display:"WETH"}],[x.MATIC]:[{value:"eth_polygon",display:"ETH"},{value:"matic_polygon",display:"MATIC"},{value:"usdc_polygon",display:"USDC"},{value:"usdt_polygon",display:"USDT"}],[x.BSC_MAINNET]:[{value:"bnb_bsc",display:"BNB"},{value:"busd_bsc",display:"BUSD"}],[x.AVALANCHE_MAINNET]:[{value:"avax_cchain",display:"AVAX"},{value:"usdc_cchain",display:"USDC"}],[x.ARBITRUM_MAINNET]:[{value:"eth_arbitrum",display:"ETH"},{value:"usdc_arbitrum",display:"USDC"}],[x.OPTIMISM_MAINNET]:[{value:"eth_optimism",display:"ETH"},{value:"usdc_optimism",display:"USDC"}]},includeFees:!0,api:!0,enforceMax:!1},[G.WYRE]:{line1:"Apple Pay/ Debit/ Credit Card",line2:"4.9% + 30 or 5 USD",line3:"$250/day",supportPage:"https://support.sendwyre.com/en/",minOrderValue:5,maxOrderValue:500,validCurrencies:Pe(G.WYRE),validCryptoCurrenciesByChain:{[x.MAINNET]:[{value:"AAVE",display:"AAVE"},{value:"COMP",display:"COMP"},{value:"BAT",display:"BAT"},{value:"BUSD",display:"BUSD"},{value:"DAI",display:"DAI"},{value:"ETH",display:"ETH"},{value:"WBTC",display:"WBTC"},{value:"MKR",display:"MKR"},{value:"UNI",display:"UNI"},{value:"WETH",display:"WETH"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[x.MATIC]:[{value:"mUSDC",display:"USDC"},{value:"MATIC",display:"MATIC"},{value:"MWETH",display:"WETH"}],[x.AVALANCHE_MAINNET]:[{value:"AVAXC",display:"AVAX"},{value:"AVAXCUSDC",display:"USDC"}],[x.BSC_MAINNET]:[{value:"BNB",display:"BNB"},{value:"BBUSD",display:"BUSD"}]},includeFees:!1,api:!0,enforceMax:!1},[G.RAMPNETWORK]:{line1:"Debit Card/ <br>Apple Pay/ Bank transfer",line2:"0.49% - 2.9%",line3:"5,000/purchase, 20,000/mo",supportPage:"https://instant.ramp.network/",minOrderValue:50,maxOrderValue:2e4,validCurrencies:Pe(G.RAMPNETWORK),validCryptoCurrenciesByChain:{[x.MAINNET]:[{value:"ETH",display:"ETH"},{value:"DAI",display:"DAI"},{value:"BAT",display:"BAT"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[x.MATIC]:[{value:"MATIC_BAT",display:"BAT"},{value:"MATIC_DAI",display:"DAI"},{value:"MATIC_MATIC",display:"MATIC"},{value:"MATIC_USDC",display:"USDC"},{value:"MATIC_USDT",display:"USDT"}],[x.AVALANCHE_MAINNET]:[{value:"AVAX_AVAX",display:"AVAX"},{value:"AVAX_USDC",display:"USDC"},{value:"AVAX_USDT",display:"USDT"}],[x.ARBITRUM_MAINNET]:[{value:"ARBITRUM_ETH",display:"ETH"},{value:"ARBITRUM_USDC.e	",display:"USDC"},{value:"ARBITRUM_USDT",display:"USDT"}],[x.OPTIMISM_MAINNET]:[{value:"OPTIMISM_DAI",display:"DAI"},{value:"OPTIMISM_OPTIMISM",display:"OPTIMISM"},{value:"OPTIMISM_USDC",display:"USDC"},{value:"OPTIMISM_USDT",display:"USDT"}],[x.BSC_MAINNET]:[{value:"BSC_BNB",display:"BNB"},{value:"BSC_BUSD",display:"BUSD"}]},includeFees:!0,api:!0,receiveHint:"walletTopUp.receiveHintRamp",enforceMax:!1},[G.XANPOOL]:{line1:"PayNow/ InstaPay/ FPS/ GoJekPay/ UPI/ PromptPay/ <br>ViettelPay/ DuitNow",line2:"2.5% buying, 3% selling",line3:"$2,500 / day",supportPage:"mailto:support@xanpool.com",minOrderValue:100,maxOrderValue:2500,validCurrencies:Pe(G.XANPOOL),validCryptoCurrenciesByChain:{[x.MAINNET]:[{value:"ETH",display:"ETH"},{value:"USDT",display:"USDT"},{value:"USDC",display:"USDC"}]},includeFees:!0,api:!0,sell:!0,enforceMax:!1},[G.MERCURYO]:{line1:"Credit/ Debit Card/ Apple Pay",line2:"3.95% or 4 USD",line3:"10,000/day, 25,000/mo",supportPage:"mailto:support@mercuryo.io",minOrderValue:30,maxOrderValue:5e3,validCurrencies:Pe(G.MERCURYO),validCryptoCurrenciesByChain:{[x.MAINNET]:[{value:"ETH",display:"ETH"},{value:"BAT",display:"BAT"},{value:"USDT",display:"USDT"},{value:"DAI",display:"DAI"}],[x.BSC_MAINNET]:[{value:"BNB",display:"BNB"},{value:"BUSD",display:"BUSD"},{value:"1INCH",display:"1INCH"}],[x.AVALANCHE_MAINNET]:[{value:"AVAX",display:"AVAX"}],[x.MATIC]:[{value:"MATIC",display:"MATIC"}]},includeFees:!0,api:!0,enforceMax:!1},[G.TRANSAK]:{line1:"Apple & Google Pay / Credit/Debit Card<br/>Bangkok Bank Mobile & iPay<br/>Bank Transfer (sepa/gbp) / SCB Mobile & Easy",line2:"0.99% - 5.5% or 5 USD",line3:"$5,000/day, $28,000/mo",supportPage:"https://support.transak.com/hc/en-US",minOrderValue:30,maxOrderValue:500,validCurrencies:Pe(G.TRANSAK),validCryptoCurrenciesByChain:{[x.MAINNET]:[{value:"1INCH",display:"1INCH"},{value:"BAT",display:"BAT"},{value:"AAVE",display:"AAVE"},{value:"DAI",display:"DAI"},{value:"ETH",display:"ETH"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[x.MATIC]:[{value:"BAT",display:"BAT"},{value:"AAVE",display:"AAVE"},{value:"DAI",display:"DAI"},{value:"MATIC",display:"MATIC"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"},{value:"WETH",display:"WETH"}],[x.BSC_MAINNET]:[{value:"BAT",display:"BAT"},{value:"BNB",display:"BNB"},{value:"BUSD",display:"BUSD"}],[x.AVALANCHE_MAINNET]:[{value:"AVAX",display:"AVAX"}],[x.OPTIMISM_MAINNET]:[{value:"ETH",display:"ETH"},{value:"USDC",display:"USDC"}],[x.ARBITRUM_MAINNET]:[{value:"USDC",display:"USDC"},{value:"ETH",display:"ETH"}]},includeFees:!0,enforceMax:!0},[G.BANXA]:{line1:"Debit Card/ <br>Apple Pay/ Bank transfer",line2:"0.49% - 2.9%",line3:"5,000/purchase, 20,000/mo",supportPage:"https://support.banxa.com",minOrderValue:20,maxOrderValue:15e3,validCurrencies:Pe(G.BANXA),validCryptoCurrenciesByChain:{[x.MAINNET]:[{value:"ETH",display:"ETH"},{value:"DAI",display:"DAI"},{value:"MKR",display:"MKR"},{value:"USDT",display:"USDT"},{value:"BUSD",display:"BUSD"},{value:"USDC",display:"USDC"},{value:"BAT",display:"BAT"},{value:"AAVE",display:"AAVE"},{value:"COMP",display:"COMP"},{value:"UNI",display:"UNI"}],[x.MATIC]:[{value:"MATIC",display:"MATIC"}]},includeFees:!0,enforceMax:!0}},il={en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies bentigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"",actionRequired:"",pendingAction:"",cookiesRequired:"",enableCookies:"TorusCookie",clickHere:""}},ko:{embed:{continue:"",actionRequired:" ",pendingAction:"    .",cookiesRequired:" ",enableCookies:"     Torus .",clickHere:"  "}},zh:{embed:{continue:"",actionRequired:"",pendingAction:"",cookiesRequired:"Cookie",enableCookies:"cookieTorus",clickHere:""}}};var ce={supportedVerifierList:Object.values(Le),paymentProviders:rl,api:"https://api.tor.us",translations:il,prodTorusUrl:"",localStorageKeyPrefix:"torus-"};const rt=e=>{const t=window.document.createElement("template"),n=e.trim();return t.innerHTML=n,t.content.firstChild},fe=(e,t,n)=>{const r=i=>{n(i),e.removeListener(t,r)};e.on(t,r)};function Ti(e){return e!==null&&typeof e=="object"&&typeof e.pipe=="function"}function ol(e){return Ti(e)&&e.writable!==!1&&typeof e._write=="function"&&typeof e._writableState=="object"}function al(e){return Ti(e)&&e.readable!==!1&&typeof e._read=="function"&&typeof e._readableState=="object"}function sl(e){return ol(e)&&al(e)}var j=Pi.getLogger("torus-embed"),ae={errors:{disconnected:()=>"Torus: Lost connection to Torus.",permanentlyDisconnected:()=>"Torus: Disconnected from iframe. Page reload required.",sendSiteMetadata:()=>"Torus: Failed to send site metadata. This is an internal error, please report this bug.",unsupportedSync:e=>`Torus: The Torus Ethereum provider does not support synchronous methods like ${e} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:(e,t)=>`Invalid options. Received: { maxEventListeners: ${e}, shouldSendMetadata: ${t} }`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:e=>`'args.logger' must include required method '${e}'.`},info:{connected:e=>`Torus: Connected to chain with ID "${e}".`},warnings:{enableDeprecation:'Torus: ""ethereum.enable()" is deprecated and may be removed in the future. Please use "ethereum.send("eth_requestAccounts")" instead. For more information, see: https://eips.ethereum.org/EIPS/eip-1102',sendDeprecation:`Torus: "ethereum.send(...)" is deprecated and may be removed in the future. Please use "ethereum.sendAsync(...)" or "ethereum.request(...)" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`}};const{paymentProviders:Ir}=ce,ll=(e,t)=>{const n={};if(!e)return{errors:n,isValid:!0};if(e&&!Ir[e])return n.provider="Invalid Provider",{errors:n,isValid:Object.keys(n).length===0};const r=Ir[e],i=t||{};if(i.fiatValue){const a=+parseFloat(i.fiatValue.toString())||0;a<r.minOrderValue&&(n.fiatValue="Requested amount is lower than supported"),a>r.maxOrderValue&&r.enforceMax&&(n.fiatValue="Requested amount is higher than supported")}if(i.selectedCurrency&&!r.validCurrencies.includes(i.selectedCurrency)&&(n.selectedCurrency="Unsupported currency"),i.selectedCryptoCurrency){const a=Object.values(r.validCryptoCurrenciesByChain).flat().map(u=>u.value),l=e===G.MOONPAY?i.selectedCryptoCurrency.toLowerCase():i.selectedCryptoCurrency;a&&!a.includes(l)&&(n.selectedCryptoCurrency="Unsupported cryptoCurrency")}return{errors:n,isValid:Object.keys(n).length===0}};function dl(){return(e,t,n)=>{(typeof e.method!="string"||!e.method)&&(t.error=Ie.rpcErrors.invalidRequest({message:"The request 'method' must be a non-empty string.",data:te(te({},e||{}),{},{cause:"The request 'method' must be a non-empty string."})})),n(r=>{const{error:i}=t;return i&&j.error(`MetaMask - RPC Error: ${i.message}`,i),r()})}}function ul(e,t,n){let r=`MetaMask: Lost connection to "${e}".`;t!=null&&t.stack&&(r+=`
${t.stack}`),j.warn(r),n&&n.listenerCount("error")>0&&n.emit("error",r)}const ke=()=>Math.random().toString(36).slice(2),Ii=async(e,t)=>{let n,r;const i="4.0.8";let a=t.version||i;try{if((e==="binance"||e==="production")&&!t.version){let l;ce.prodTorusUrl?l={data:ce.prodTorusUrl}:l=await Or(`${ce.api}/latestversion?name=@toruslabs/torus-embed&version=${i}`,{},{useAPIKey:!0}),a=l.data,ce.prodTorusUrl=l.data}}catch(l){j.error(l,"unable to fetch latest version")}switch(j.info("version used: ",a),e){case"binance":n=`https://binance.tor.us/v${a}`,r="info";break;case"testing":n="https://testing.tor.us",r="debug";break;case"bnb":n="https://bnb.tor.us",r="error";break;case"polygon":n="https://polygon.tor.us",r="error";break;case"lrc":n="https://lrc.tor.us",r="debug";break;case"beta":n="https://beta.tor.us",r="debug";break;case"development":n="http://localhost:4050",r="debug";break;case"alpha":n="https://alpha.tor.us",r="debug";break;default:n=`https://app.tor.us/v${a}`,r="error";break}return{torusUrl:n,logLevel:r}},Cr=()=>{let e=window.navigator.language||"en-US";const t=e.split("-");return e=Object.prototype.hasOwnProperty.call(ce.translations,t[0])?t[0]:"en",e},fl=["eth_subscription"],Ci=()=>{},vr="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=660,width=375",cl="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=740,width=1315",Dr="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=450";function hl(){const e=window.screenLeft!==void 0?window.screenLeft:window.screenX,t=window.screenTop!==void 0?window.screenTop:window.screenY,n=1200,r=700,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,l=1,u=Math.abs((i-n)/2/l+e),f=Math.abs((a-r)/2/l+t);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${r/l},width=${n/l},top=${f},left=${u}`}st.defaultMaxListeners=100;const Nr=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(r,i)=>r||i.error?t(r||i.error):!n||Array.isArray(i)?e(i):e(i.result)};class Pt extends st{constructor(t){let{maxEventListeners:n=100,shouldSendMetadata:r=!0,jsonRpcStreamName:i="provider"}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(super(),T(this,"chainId",void 0),T(this,"selectedAddress",void 0),T(this,"_rpcEngine",void 0),T(this,"networkVersion",void 0),T(this,"shouldSendMetadata",void 0),T(this,"isTorus",void 0),T(this,"tryPreopenHandle",void 0),T(this,"enable",void 0),T(this,"_state",void 0),T(this,"_jsonRpcConnection",void 0),!sl(t))throw new Error(ae.errors.invalidDuplexStream());this.isTorus=!0,this.setMaxListeners(n),this._state=te({},Pt._defaultState),this.selectedAddress=null,this.networkVersion=null,this.chainId=null,this.shouldSendMetadata=r,this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this._handleConnect=this._handleConnect.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this),this._sendSync=this._sendSync.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this._initializeState=this._initializeState.bind(this),this.request=this.request.bind(this),this.send=this.send.bind(this),this.sendAsync=this.sendAsync.bind(this);const a=new Ri;on(t,a,t,this._handleStreamDisconnect.bind(this,"MetaMask")),a.ignoreStream("phishing"),this.on("connect",()=>{this._state.isConnected=!0});const l=Ys();on(l.stream,a.createStream(i),l.stream,this._handleStreamDisconnect.bind(this,"MetaMask RpcProvider"));const u=new we;u.push(Xs()),u.push(dl()),u.push(l.middleware),this._rpcEngine=u,l.events.on("notification",f=>{const{method:d,params:c}=f;d==="wallet_accountsChanged"?this._handleAccountsChanged(c):d==="wallet_unlockStateChanged"?this._handleUnlockStateChanged(c):d==="wallet_chainChanged"?this._handleChainChanged(c):fl.includes(f.method)&&(this.emit("data",f),this.emit("notification",c.result),this.emit("message",{type:d,data:c}))})}isConnected(){return this._state.isConnected}async request(t){if(!t||typeof t!="object"||Array.isArray(t))throw Ie.rpcErrors.invalidRequest({message:ae.errors.invalidRequestArgs(),data:te(te({},t||{}),{},{cause:ae.errors.invalidRequestArgs()})});const{method:n,params:r}=t;if(typeof n!="string"||n.length===0)throw Ie.rpcErrors.invalidRequest({message:ae.errors.invalidRequestMethod(),data:te(te({},t||{}),{},{cause:ae.errors.invalidRequestArgs()})});if(r!==void 0&&!Array.isArray(r)&&(typeof r!="object"||r===null))throw Ie.rpcErrors.invalidRequest({message:ae.errors.invalidRequestParams(),data:te(te({},t||{}),{},{cause:ae.errors.invalidRequestArgs()})});return new Promise((i,a)=>{this._rpcRequest({method:n,params:r},Nr(i,a))})}sendAsync(t,n){this._rpcRequest(t,n)}async _initializeState(){try{const{accounts:t,chainId:n,isUnlocked:r,networkVersion:i}=await this.request({method:"wallet_getProviderState"});this.emit("connect",{chainId:n}),this._handleChainChanged({chainId:n,networkVersion:i}),this._handleUnlockStateChanged({accounts:t,isUnlocked:r}),this._handleAccountsChanged(t)}catch(t){j.error("MetaMask: Failed to get initial state. Please report this bug.",t)}finally{j.info("initialized state"),this._state.initialized=!0,this.emit("_initialized")}}_rpcRequest(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=n;const a=t;if(!Array.isArray(a)){if(a.jsonrpc||(a.jsonrpc="2.0"),a.method==="eth_accounts"||a.method==="eth_requestAccounts")i=(l,u)=>{this._handleAccountsChanged(u.result||[],a.method==="eth_accounts",r),n(l,u)};else if(a.method==="wallet_getProviderState"){this._rpcEngine.handle(t,i);return}}this.tryPreopenHandle(a,i)}send(t,n){return typeof t=="string"&&(!n||Array.isArray(n))?new Promise((r,i)=>{try{this._rpcRequest({method:t,params:n},Nr(r,i,!1))}catch(a){i(a)}}):t&&typeof t=="object"&&typeof n=="function"?this._rpcRequest(t,n):this._sendSync(t)}_sendSync(t){let n;switch(t.method){case"eth_accounts":n=this.selectedAddress?[this.selectedAddress]:[];break;case"eth_coinbase":n=this.selectedAddress||null;break;case"eth_uninstallFilter":this._rpcRequest(t,Ci),n=!0;break;case"net_version":n=this.networkVersion||null;break;default:throw new Error(ae.errors.unsupportedSync(t.method))}return{id:t.id,jsonrpc:t.jsonrpc,result:n}}_handleConnect(t){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:t}),j.debug(ae.info.connected(t)))}_handleDisconnect(t,n){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!t){this._state.isConnected=!1;let r;t?(r=new Ie.EthereumProviderError(1013,n||ae.errors.disconnected()),j.debug(r)):(r=new Ie.EthereumProviderError(1011,n||ae.errors.permanentlyDisconnected()),j.error(r),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r)}}_handleStreamDisconnect(t,n){ul(t,n,this),this._handleDisconnect(!1,n?n.message:void 0)}_handleAccountsChanged(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=t;Array.isArray(i)||(j.error("MetaMask: Received non-array accounts parameter. Please report this bug.",i),i=[]);for(const a of t)if(typeof a!="string"){j.error("MetaMask: Received non-string account. Please report this bug.",t),i=[];break}$i(this._state.accounts,i)||(n&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!r&&j.error('MetaMask: "eth_accounts" unexpectedly updated accounts. Please report this bug.',i),this._state.accounts=i,this.emit("accountsChanged",i)),this.selectedAddress!==i[0]&&(this.selectedAddress=i[0]||null)}_handleChainChanged(){let{chainId:t,networkVersion:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!t||!n){j.error("MetaMask: Received invalid network parameters. Please report this bug.",{chainId:t,networkVersion:n});return}n==="loading"?this._handleDisconnect(!0):(this._handleConnect(t),t!==this.chainId&&(this.chainId=t,this._state.initialized&&this.emit("chainChanged",this.chainId)))}_handleUnlockStateChanged(){let{accounts:t,isUnlocked:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(typeof n!="boolean"){j.error("MetaMask: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:n});return}n!==this._state.isUnlocked&&(this._state.isUnlocked=n,this._handleAccountsChanged(t||[]))}}T(Pt,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});class Mr extends st{constructor(t){let{url:n,target:r,features:i,timeout:a=3e4}=t;super(),T(this,"url",void 0),T(this,"target",void 0),T(this,"features",void 0),T(this,"window",void 0),T(this,"windowTimer",void 0),T(this,"iClosedWindow",void 0),T(this,"timeout",void 0),this.url=n,this.target=r||"_blank",this.features=i||hl(),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=a,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var t;this.window=window.open(this.url.href,this.target,this.features),(t=this.window)!==null&&t!==void 0&&t.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(t){t?window.location.replace(this.url.href):window.location.href=this.url.href}}function Pr(e){return new Promise((t,n)=>{try{const r=document.createElement("img");r.onload=()=>t(!0),r.onerror=()=>t(!1),r.src=e}catch(r){n(r)}})}const pl=e=>{const{document:t}=e,n=t.querySelector('head > meta[property="og:site_name"]');if(n)return n.content;const r=t.querySelector('head > meta[name="title"]');return r?r.content:t.title&&t.title.length>0?t.title:e.location.hostname};async function bl(e){const{document:t}=e;let n=t.querySelector('head > link[rel="shortcut icon"]');return n&&await Pr(n.href)||(n=Array.from(t.querySelectorAll('head > link[rel="icon"]')).find(r=>!!r.href),n&&await Pr(n.href))?n.href:null}const gl=async()=>({name:pl(window),icon:await bl(window)});async function yl(e){try{const t=await gl();e.handle({jsonrpc:"2.0",id:ke(),method:"wallet_sendDomainMetadata",params:t},Ci)}catch(t){j.error({message:ae.errors.sendSiteMetadata(),originalError:t})}}const _l=["host","chainId","networkName"],wl=["eth_sendTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","eth_getEncryptionPublicKey","eth_decrypt","wallet_addEthereumChain","wallet_switchEthereumChain"];(async function(){try{if(typeof document>"u")return;const t=document.createElement("link"),{torusUrl:n}=await Ii("production",{version:""});t.href=`${n}/popup`,t.crossOrigin="anonymous",t.type="text/html",t.rel="prefetch",t.relList&&t.relList.supports&&t.relList.supports("prefetch")&&document.head.appendChild(t)}catch(t){j.warn(t)}})();class ml{constructor(){let{buttonPosition:t=Ke.BOTTOM_LEFT,buttonSize:n=56,modalZIndex:r=99999,apiKey:i="torus-default"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};T(this,"buttonPosition",Ke.BOTTOM_LEFT),T(this,"buttonSize",void 0),T(this,"torusUrl",void 0),T(this,"torusIframe",void 0),T(this,"styleLink",void 0),T(this,"isLoggedIn",void 0),T(this,"isInitialized",void 0),T(this,"torusWidgetVisibility",void 0),T(this,"torusAlert",void 0),T(this,"apiKey",void 0),T(this,"modalZIndex",void 0),T(this,"alertZIndex",void 0),T(this,"torusAlertContainer",void 0),T(this,"isIframeFullScreen",void 0),T(this,"whiteLabel",void 0),T(this,"requestedVerifier",void 0),T(this,"currentVerifier",void 0),T(this,"embedTranslations",void 0),T(this,"ethereum",void 0),T(this,"provider",void 0),T(this,"communicationMux",void 0),T(this,"isLoginCallback",void 0),T(this,"paymentProviders",ce.paymentProviders),T(this,"loginHint",""),T(this,"useWalletConnect",void 0),T(this,"isCustomLogin",!1),this.buttonPosition=t,this.buttonSize=n,this.torusUrl="",this.isLoggedIn=!1,this.isInitialized=!1,this.torusWidgetVisibility=!0,this.requestedVerifier="",this.currentVerifier="",this.apiKey=i,Li(i),this.modalZIndex=r,this.alertZIndex=r+1e3,this.isIframeFullScreen=!1}async init(){let{buildEnv:t=Qs.PRODUCTION,enableLogging:n=!1,network:r={host:"mainnet",chainId:null,networkName:"",blockExplorer:"",ticker:"",tickerName:""},loginConfig:i={},showTorusButton:a=!0,integrity:l={version:""},whiteLabel:u,useWalletConnect:f=!1,mfaLevel:d="default"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.isInitialized)throw new Error("Already initialized");const{torusUrl:c,logLevel:_}=await Ii(t,l);j.info(c,"url loaded"),this.torusUrl=c,this.whiteLabel=u,this.useWalletConnect=f,this.isCustomLogin=!!(i&&Object.keys(i).length>0)||!!(u&&Object.keys(u).length>0),j.setDefaultLevel(_),n?j.enableAll():j.disableAll(),this.torusWidgetVisibility=a;const A=new URL(c);A.pathname.endsWith("/")?A.pathname+="popup":A.pathname+="/popup",A.hash=`#isCustomLogin=${this.isCustomLogin}`,this.torusIframe=rt(`<iframe
        id="torusIframe"
        allow=${f?"camera":""}
        class="torusIframe"
        src="${A.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%; color-scheme: none;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex}"
      ></iframe>`),this.torusAlertContainer=rt('<div id="torusAlertContainer"></div>'),this.torusAlertContainer.style.display="none",this.torusAlertContainer.style.setProperty("z-index",this.alertZIndex.toString());const g=window.document.createElement("link");g.setAttribute("rel","stylesheet"),g.setAttribute("type","text/css"),g.setAttribute("href",`${c}/css/widget.css`),this.styleLink=g;const{defaultLanguage:b=Cr(),customTranslations:P={}}=this.whiteLabel||{},I=Oi(ce.translations,P)[b]||ce.translations[Cr()];return this.embedTranslations=I.embed,new Promise((w,L)=>{this.torusIframe.onload=async()=>{this._setupWeb3();const $=this.communicationMux.getStream("init_stream");$.on("data",O=>{const{name:Y,data:F,error:q}=O;Y==="init_complete"&&F.success?(this.isInitialized=!0,this._displayIframe(this.isIframeFullScreen),w(void 0)):q&&L(new Error(q))}),$.write({name:"init_stream",data:{loginConfig:i,whiteLabel:this.whiteLabel,buttonPosition:this.buttonPosition,buttonSize:this.buttonSize,torusWidgetVisibility:this.torusWidgetVisibility,apiKey:this.apiKey,network:r,mfaLevel:d}})},window.document.head.appendChild(this.styleLink),window.document.body.appendChild(this.torusIframe),window.document.body.appendChild(this.torusAlertContainer)})}login(){let{verifier:t="",login_hint:n=""}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.isInitialized)throw new Error("Call init() first");return this.requestedVerifier=t,this.loginHint=n,this.ethereum.enable()}logout(){return new Promise((t,n)=>{if(!this.isLoggedIn){n(new Error("User has not logged in yet"));return}this.communicationMux.getStream("logout").write({name:"logOut"});const i=this.communicationMux.getStream("status");fe(i,"data",l=>{l.loggedIn?n(new Error("Some Error Occured")):(this.isLoggedIn=!1,this.currentVerifier="",this.requestedVerifier="",t())})})}async cleanUp(){this.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function t(n){return n instanceof Element||n instanceof HTMLDocument}t(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),t(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),t(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}hideTorusButton(){this.torusWidgetVisibility=!1,this._sendWidgetVisibilityStatus(!1),this._displayIframe()}showTorusButton(){this.torusWidgetVisibility=!0,this._sendWidgetVisibilityStatus(!0),this._displayIframe()}setProvider(t){let{host:n="mainnet",chainId:r=null,networkName:i=""}=t,a=Vi(t,_l);return new Promise((l,u)=>{const f=this.communicationMux.getStream("provider_change");fe(f,"data",_=>{const A=_,{err:g,success:b}=A.data;j.info(A),g?u(g):b?l():u(new Error("some error occurred"))});const c=ke();this._handleWindow(c,{target:"_blank",features:vr}),f.write({name:"show_provider_change",data:{network:te({host:n,chainId:r,networkName:i},a),preopenInstanceId:c,override:!1}})})}showWallet(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.communicationMux.getStream("show_wallet"),i=t?`/${t}`:"";r.write({name:"show_wallet",data:{path:i}}),fe(r,"data",l=>{const u=l;if(u.name==="show_wallet_instance"){const{instanceId:f}=u.data,d=new URL(`${this.torusUrl}/wallet${i}`);d.searchParams.append("integrity","true"),d.searchParams.append("instanceId",f),Object.keys(n).forEach(_=>{d.searchParams.append(_,n[_])}),d.hash=`#isCustomLogin=${this.isCustomLogin}`,new Mr({url:d,features:cl}).open()}})}async getPublicAddress(t){let{verifier:n,verifierId:r,isExtended:i=!1}=t;if(!ce.supportedVerifierList.includes(n)||!Tr[n])throw new Error("Unsupported verifier");const a=n,l=Tr[n],u=new URL("https://api.tor.us/lookup/torus");return u.searchParams.append("verifier",l),u.searchParams.append("verifierId",r),u.searchParams.append("walletVerifier",a),u.searchParams.append("network","mainnet"),u.searchParams.append("isExtended",i.toString()),Or(u.href,{headers:{"Content-Type":"application/json; charset=utf-8"}},{useAPIKey:!0})}getUserInfo(t){return new Promise((n,r)=>{if(this.isLoggedIn){const i=this.communicationMux.getStream("user_info_access");i.write({name:"user_info_access_request"}),fe(i,"data",l=>{const u=l,{name:f,data:{approved:d,payload:c,rejected:_,newRequest:A}}=u;if(f==="user_info_access_response"){if(d)n(c);else if(_)r(new Error("User rejected the request"));else if(A){const g=this.communicationMux.getStream("user_info");fe(g,"data",N=>{const I=N;I.name==="user_info_response"&&(I.data.approved?n(I.data.payload):r(new Error("User rejected the request")))});const P=ke();this._handleWindow(P,{target:"_blank",features:vr}),g.write({name:"user_info_request",data:{message:t,preopenInstanceId:P}})}}})}else r(new Error("User has not logged in yet"))})}initiateTopup(t,n){return new Promise((r,i)=>{if(this.isInitialized){const{errors:a,isValid:l}=ll(t,n);if(!l){i(new Error(JSON.stringify(a)));return}const u=this.communicationMux.getStream("topup");fe(u,"data",c=>{const _=c;_.name==="topup_response"&&(_.data.success?r(_.data.success):i(new Error(_.data.error)))});const d=ke();this._handleWindow(d),u.write({name:"topup_request",data:{provider:t,params:n,preopenInstanceId:d}})}else i(new Error("Torus is not initialized yet"))})}async loginWithPrivateKey(t){const{privateKey:n,userInfo:r}=t;return new Promise((i,a)=>{if(this.isInitialized){if(Bi.Buffer.from(n,"hex").length!==32){a(new Error("Invalid private key, Please provide a 32 byte valid secp25k1 private key"));return}const l=this.communicationMux.getStream("login_with_private_key");fe(l,"data",f=>{const d=f;d.name==="login_with_private_key_response"&&(d.data.success?i(d.data.success):a(new Error(d.data.error)))}),l.write({name:"login_with_private_key_request",data:{privateKey:n,userInfo:r}})}else a(new Error("Torus is not initialized yet"))})}async showWalletConnectScanner(){if(!this.useWalletConnect)throw new Error("Set `useWalletConnect` as true in init function options to use wallet connect scanner");return new Promise((t,n)=>{if(this.isLoggedIn){const r=this.communicationMux.getStream("wallet_connect_stream");fe(r,"data",a=>{const l=a;l.name==="wallet_connect_stream_res"&&(l.data.success?t(l.data.success):n(new Error(l.data.error)),this._displayIframe())}),r.write({name:"wallet_connect_stream_req"}),this._displayIframe(!0)}else n(new Error("User has not logged in yet"))})}_handleWindow(t){let{url:n,target:r,features:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t){const a=this.communicationMux.getStream("window"),l=new URL(n||`${this.torusUrl}/redirect?preopenInstanceId=${t}`);l.hash?l.hash+=`&isCustomLogin=${this.isCustomLogin}`:l.hash=`#isCustomLogin=${this.isCustomLogin}`;const u=new Mr({url:l,target:r,features:i});if(u.open(),!u.window){this._createPopupBlockAlert(t,l.href);return}a.write({name:"opened_window",data:{preopenInstanceId:t}});const f=d=>{let{preopenInstanceId:c,close:_}=d;c===t&&_&&(u.close(),a.removeListener("data",f))};a.on("data",f),u.once("close",()=>{a.write({data:{preopenInstanceId:t,closed:!0}}),a.removeListener("data",f)})}}_setEmbedWhiteLabel(t){const{theme:n}=this.whiteLabel||{};if(n){const{isDark:r=!1,colors:i={}}=n;r&&t.classList.add("torus-dark"),i.torusBrand1&&t.style.setProperty("--torus-brand-1",i.torusBrand1),i.torusGray2&&t.style.setProperty("--torus-gray-2",i.torusGray2)}}_getLogoUrl(){var t;let n=`${this.torusUrl}/images/torus_icon-blue.svg`;if((t=this.whiteLabel)!==null&&t!==void 0&&(t=t.theme)!==null&&t!==void 0&&t.isDark){var r;n=((r=this.whiteLabel)===null||r===void 0?void 0:r.logoLight)||n}else{var i;n=((i=this.whiteLabel)===null||i===void 0?void 0:i.logoDark)||n}return n}_sendWidgetVisibilityStatus(t){this.communicationMux.getStream("torus-widget-visibility").write({data:t})}_displayIframe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const n={},r=this.buttonSize+14;if(t)n.display="block",n.width="100%",n.height="100%",n.top="0px",n.right="0px",n.left="0px",n.bottom="0px";else switch(n.display=this.torusWidgetVisibility?"block":"none",n.height=`${r}px`,n.width=`${r}px`,this.buttonPosition){case Ke.TOP_LEFT:n.top="0px",n.left="0px",n.right="auto",n.bottom="auto";break;case Ke.TOP_RIGHT:n.top="0px",n.right="0px",n.left="auto",n.bottom="auto";break;case Ke.BOTTOM_RIGHT:n.bottom="0px",n.right="0px",n.top="auto",n.left="auto";break;case Ke.BOTTOM_LEFT:default:n.bottom="0px",n.left="0px",n.top="auto",n.right="auto";break}Object.assign(this.torusIframe.style,n),this.isIframeFullScreen=t}_setupWeb3(){j.info("setupWeb3 running");const t=new Er({name:"embed_metamask",target:"iframe_metamask",targetWindow:this.torusIframe.contentWindow,targetOrigin:new URL(this.torusUrl).origin}),n=new Er({name:"embed_comm",target:"iframe_comm",targetWindow:this.torusIframe.contentWindow,targetOrigin:new URL(this.torusUrl).origin}),r=new Pt(t),i=c=>{const _=r[c];r[c]=function(g){if(g&&g==="eth_requestAccounts")return r.enable();for(var b=arguments.length,P=new Array(b>1?b-1:0),N=1;N<b;N++)P[N-1]=arguments[N];return _.apply(this,[g,...P])}};i("send"),i("sendAsync"),r.enable=()=>new Promise((c,_)=>{r.sendAsync({jsonrpc:"2.0",id:ke(),method:"eth_requestAccounts",params:[]},(A,g)=>{const{result:b}=g||{};if(A)setTimeout(()=>{_(A)},50);else if(Array.isArray(b)&&b.length>0){const P=()=>{if(this.requestedVerifier!==""&&this.currentVerifier!==this.requestedVerifier){const{requestedVerifier:N}=this;this.logout().then(I=>{this.requestedVerifier=N,this._showLoginPopup(!0,c,_)}).catch(I=>_(I))}else c(b)};this.isLoggedIn?P():this.isLoginCallback=P}else this._showLoginPopup(!0,c,_)})}),r.tryPreopenHandle=(c,_)=>{const A=c;if(!Array.isArray(A)&&wl.includes(A.method)){const g=ke();this._handleWindow(g,{target:"_blank",features:Dr}),A.preopenInstanceId=g}r._rpcEngine.handle(A,_)};const a=new Proxy(r,{deleteProperty:()=>!0});this.ethereum=a;const l=Js(n);this.communicationMux=l,l.getStream("window").on("data",c=>{c.name==="create_window"&&this._createPopupBlockAlert(c.data.preopenInstanceId,c.data.url)}),l.getStream("widget").on("data",c=>{const{data:_}=c;this._displayIframe(_)}),l.getStream("status").on("data",c=>{c.loggedIn?(this.isLoggedIn=c.loggedIn,this.currentVerifier=c.verifier):this._displayIframe(),this.isLoginCallback&&(this.isLoginCallback(),delete this.isLoginCallback)}),this.provider=a,this.provider.shouldSendMetadata&&yl(this.provider._rpcEngine),r._initializeState(),j.debug("Torus - injected provider")}_showLoginPopup(t,n,r){const i=l=>{const u=l,{err:f,selectedAddress:d}=u;f?(j.error(f),r&&r(f)):n&&n([d]),this.isIframeFullScreen&&this._displayIframe()},a=this.communicationMux.getStream("oauth");if(!this.requestedVerifier)this._displayIframe(!0),fe(a,"data",i),a.write({name:"oauth_modal",data:{calledFromEmbed:t}});else{fe(a,"data",i);const l=ke();this._handleWindow(l),a.write({name:"oauth",data:{calledFromEmbed:t,verifier:this.requestedVerifier,preopenInstanceId:l,login_hint:this.loginHint}})}}_createPopupBlockAlert(t,n){const r=this._getLogoUrl(),i=rt(`<div id="torusAlert" class="torus-alert--v2"><div id="torusAlert__logo"><img src="${r}" /></div><div><h1 id="torusAlert__title">${this.embedTranslations.actionRequired}</h1><p id="torusAlert__desc">${this.embedTranslations.pendingAction}</p></div></div>`),a=rt(`<div><a id="torusAlert__btn">${this.embedTranslations.continue}</a></div>`),l=rt('<div id="torusAlert__btn-container"></div>');l.appendChild(a),i.appendChild(l),this._setEmbedWhiteLabel(i),this.torusAlertContainer.style.display="block",this.torusAlertContainer.appendChild(i),a.addEventListener("click",()=>{this._handleWindow(t,{url:n,target:"_blank",features:Dr}),i.remove(),this.torusAlertContainer.children.length===0&&(this.torusAlertContainer.style.display="none")})}}class Cl extends Hi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),T(this,"name",lt.TORUS_EVM),T(this,"adapterNamespace",ki.EIP155),T(this,"currentChainNamespace",Ui.EIP155),T(this,"type",Wi.EXTERNAL),T(this,"status",de.NOT_READY),T(this,"torusInstance",null),T(this,"torusWalletOptions",void 0),T(this,"initParams",void 0),T(this,"loginSettings",{}),this.torusWalletOptions=t.adapterSettings||{},this.initParams=t.initParams||{},this.loginSettings=t.loginSettings||{}}get provider(){return this.status!==de.NOT_READY&&this.torusInstance?this.torusInstance.provider:null}set provider(t){throw new Error("Not implemented")}async init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};await super.init(t),super.checkInitializationRequirements();const{chainId:n,blockExplorer:r,displayName:i,rpcTarget:a,ticker:l,tickerName:u}=this.chainConfig,f={chainId:Number.parseInt(n,16),host:a,blockExplorer:r,networkName:i,ticker:l,tickerName:u};this.torusInstance=new ml(this.torusWalletOptions),xt.debug("initializing torus evm adapter init"),await this.torusInstance.init(te(te({showTorusButton:!1},this.initParams),{},{network:f})),this.status=de.READY,this.emit(Bt.READY,lt.TORUS_EVM);try{xt.debug("initializing torus evm adapter"),t.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(d){xt.error("Failed to connect with torus evm provider",d),this.emit(Bt.ERRORED,d)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance)throw dt.notReady("Torus wallet is not initialized");this.status=de.CONNECTING,this.emit(Bt.CONNECTING,{adapter:lt.TORUS_EVM});try{await this.torusInstance.login(this.loginSettings);const t=await this.torusInstance.provider.request({method:"eth_chainId"});if(t&&parseInt(t)!==parseInt(this.chainConfig.chainId,16)){const{chainId:n,blockExplorer:r,displayName:i,rpcTarget:a,ticker:l,tickerName:u}=this.chainConfig,f={chainId:Number.parseInt(n,16),host:a,blockExplorer:r,networkName:i,tickerName:u,ticker:l};await this.torusInstance.setProvider(te({},f));const d=await this.torusInstance.ethereum.request({method:"eth_chainId"});if(d&&parseInt(d)!==parseInt(this.chainConfig.chainId,16))throw dt.fromCode(5e3,`Not connected to correct chainId. Expected: ${this.chainConfig.chainId}, Current: ${d}`)}return this.status=de.CONNECTED,this.torusInstance.showTorusButton(),this.emit(de.CONNECTED,{adapter:lt.TORUS_EVM,reconnected:this.rehydrated}),this.provider}catch(t){throw this.status=de.READY,this.rehydrated=!1,this.emit(de.ERRORED,t),t instanceof xi?t:kn.connectionError("Failed to login with torus wallet")}}async disconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};if(await super.disconnectSession(),!this.torusInstance)throw dt.notReady("Torus wallet is not initialized");await this.torusInstance.logout(),this.torusInstance.hideTorusButton(),t.cleanup?(this.status=de.NOT_READY,this.torusInstance=null):this.status=de.READY,await super.disconnect()}async getUserInfo(){if(this.status!==de.CONNECTED)throw kn.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw dt.notReady("Torus wallet is not initialized");return await this.torusInstance.getUserInfo("")}async addChain(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(t,n),this.addChainConfig(t)}async switchChain(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(t,r);const i=this.getChainConfig(t.chainId);await((n=this.torusInstance)===null||n===void 0?void 0:n.setProvider({host:i.rpcTarget,chainId:parseInt(i.chainId,16),networkName:i.displayName,blockExplorer:i.blockExplorer,ticker:i.ticker,tickerName:i.tickerName})),this.setAdapterSettings({chainConfig:this.getChainConfig(t.chainId)})}}export{Cl as TorusWalletAdapter};
